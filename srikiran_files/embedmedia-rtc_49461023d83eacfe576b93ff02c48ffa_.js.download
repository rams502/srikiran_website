!function(){function D(e){try{return JSON.parse(e)}catch(e){}return i(e)?e:{}}function R(e){try{return JSON.stringify(e)}catch(e){}return""}function c(e){return"function"==typeof e}function i(e){return"object"==typeof e}function s(t){return i(t)?Object.keys(t).map(function(e){return(encodeURIComponent(e)+"="+encodeURIComponent(t[e])).replace(/%2C/g,",").replace(/%2F/g,"/")}).filter(Boolean).join("&").replace(/%20/g,"+"):encodeURIComponent(t)}function t(){}function a(l,p,e){var a,t=Object.assign({},{aspectRatio:1.6,widthRange:{min:370,max:(p?window.parent:window).innerWidth},heightRange:{min:200,max:(p?window.parent:window).innerHeight}},e),u=1!==t.aspectRatio,i={},h={},n={},o=0,s=0,r=!1,m={},c="",d=D(localStorage.getItem("siqmedia_ss_playersize")),e=d?d.width:"",d=d?d.height:"";e&&(l.style.width=e+"px"),d&&(l.style.height=d+"px");function _(e,t,i){return Math.min(Math.max(e,t),i)}function f(e){e=e?1:-1;return{width:_(h.width+e*i.x,t.widthRange.min,t.widthRange.max),height:_(h.height+e*i.y,t.heightRange.min,t.heightRange.max),aspectRatioWidth:_(h.width+i.y*(e*t.aspectRatio),t.widthRange.min,t.widthRange.max),aspectRatioHeigth:_(h.height+i.x/(e*t.aspectRatio),t.heightRange.min,t.heightRange.max)}}function y(e,t,i,a){var n,o,s,r,c,d;a+t<=(p?window.parent:window).innerHeight&&i+e<=(p?window.parent:window).innerWidth&&(r=s=o=n="",a===m.top?n=m.top:o=m.bottom,i===m.left?s=m.left:r=m.right,a=e.toString(),i=t.toString(),e=n.toString(),t=o.toString(),n=s.toString(),o=r.toString(),localStorage.setItem("siqmedia_ss_playersize",R({width:a,height:i})),a&&(l.style.width=a+"px"),i&&(l.style.height=i+"px"),e&&o?(s=i-h.height,r=a-h.width,l.style.top=e+"px",l.style.right=o+"px",l.style.left=u?m.left-r+"px":m.left+"px",l.style.bottom=u?m.bottom-s+"px":m.bottom+"px"):e&&n?(c=i-h.height,d=a-h.width,l.style.top=e+"px",l.style.left=n+"px",l.style.bottom=u?m.bottom-c+"px":m.bottom+"px",l.style.right=u?m.right-d+"px":m.right+"px"):n&&t?(c=i-h.height,d=a-h.width,l.style.left=n+"px",l.style.bottom=t+"px",l.style.top=u?m.top-c+"px":m.top+"px",l.style.right=u?m.right-d+"px":m.right+"px"):t&&o&&(i=i-h.height,a=a-h.width,l.style.bottom=t+"px",l.style.right=o+"px",l.style.top=u?m.top-i+"px":m.top+"px",l.style.left=u?m.left-a+"px":m.left+"px"))}var g={top_left_corner:function(){var e=f(!1);y(e.aspectRatioWidth,e.height,m.right,m.bottom)},top_border:function(){var e=f(!1);y(u?e.aspectRatioWidth:h.width,e.height,m.right,m.bottom)},top_right_corner:function(){var e=f(!0);y(e.width,e.aspectRatioHeigth,m.left,m.bottom)},right_border:function(){var e=f(!0);y(e.width,u?e.aspectRatioHeigth:h.height,m.left,m.bottom)},bottom_right_corner:function(){var e=f(!0);y(e.aspectRatioWidth,e.height,m.left,m.top)},bottom_border:function(){var e=f(!0);y(u?e.aspectRatioWidth:h.width,e.height,m.left,m.top)},bottom_left_corner:function(){var e=f(!1);y(e.width,e.aspectRatioHeigth,m.right,m.top)},left_border:function(){var e=f(!1);y(e.width,u?e.aspectRatioHeigth:h.height,m.right,m.top)}},C=function(e){e.preventDefault(),i={x:e.pageX-n.x,y:e.pageY-n.y},g[c](e)},v=function(e){(p?window.parent:window).removeEventListener("mousemove",C)},S=function(e){!0===r&&(r=!1,(p?window.parent:window).removeEventListener("mousemove",I))},I=function(e){A(e),e.preventDefault();var t=parseInt(getComputedStyle(l,null).getPropertyValue("left").replace("px","")),i=parseInt(getComputedStyle(l,null).getPropertyValue("top").replace("px",""));if(t<0||i<0)return t<0&&(l.style.left="0px"),i<0&&(l.style.top="0px"),r=!1,void(p?window.parent:window).removeEventListener("mousemove",I);var a=parseInt(getComputedStyle(l,null).getPropertyValue("right").replace("px","")),n=parseInt(getComputedStyle(l,null).getPropertyValue("bottom").replace("px",""));if(a<0||n<0){e.pageX,e.pageY;return a<0&&(l.style.left=t+a+"px"),n<0&&(l.style.top=i+n+"px"),a<0&&(l.style.right="0px"),n<0&&(l.style.bottom="0px"),r=!1,void(p?window.parent:window).removeEventListener("mousemove",I)}l.style.left=e.pageX-o+"px",l.style.top=e.pageY-s+"px",l.style.right=(p?window.parent:window).innerWidth-h.width-(e.pageX-o)+"px",l.style.bottom=(p?window.parent:window).innerHeight-h.height-(e.pageY-s)+"px"};function A(e){e.stopPropagation(),e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1}l.addEventListener("mousedown",function(e){var t,i;A(e),e.preventDefault(),h={width:parseInt(getComputedStyle(l,null).getPropertyValue("width").replace("px","")),height:parseInt(getComputedStyle(l,null).getPropertyValue("height").replace("px",""))},n={x:e.pageX,y:e.pageY},a=l.getBoundingClientRect(),m={right:(p?window.parent:window).innerWidth-a.left-h.width,bottom:(p?window.parent:window).innerHeight-a.top-h.height,left:a.left,top:a.top},(c=e.target.getAttribute("position"))?((p?window.parent:window).addEventListener("mousemove",C),(p?window.parent:window).addEventListener("mouseup",v)):(e.preventDefault(),r=!0,t=parseInt(getComputedStyle(l,null).getPropertyValue("left").replace("px","")),i=parseInt(getComputedStyle(l,null).getPropertyValue("top").replace("px","")),o=e.pageX-t,s=e.pageY-i,(p?window.parent:window).addEventListener("mousemove",I),(p?window.parent:window).addEventListener("mouseup",S))})}t.prototype.request=function(e){var t=e.url,i=e.type,a=e.data,n=e.rest,o=new XMLHttpRequest;o.open(i,this.processUrl(t,i,a),!0),o.onreadystatechange=this.handleStateChange(e),this.beforeSend(o,e),o.send(function(e,t,i){if(-1!=["POST","PUT"].indexOf(e))return i?JSON.stringify(t):s(t);["GET","DELETE"].indexOf(e)}(i,a,n))},t.prototype.processUrl=function(e,t,i){return-1!=["GET","DELETE"].indexOf(t)&&i&&"object"==typeof i&&0<Object.keys({}).length?e+"?"+s(i):e},t.prototype.handleStateChange=function(a){return function(){var e,t,i="2"===this.status.toString()[0]?a.success:a.error;4===this.readyState&&(e=i,i=D(this.response),void 0===t&&(t=!1),c(e)&&(t?e.call(t,i):e(i)))}},t.prototype.beforeSend=function(e,t){var i=t.rest?"application/json":"application/x-www-form-urlencoded",a=SiqAVRouter.container.detailsHandler.isembed;a||e.setRequestHeader("X-reqsrc","ajax"),-1!=["POST","PUT","DELETE"].indexOf(t.type)&&(a||e.setRequestHeader("X-ZCSRF-TOKEN","zls_csrparam="+function(e){if(2==(e=("; "+document.cookie).split("; "+e+"=")).length)return e.pop().split(";").shift()}("LS_CSRF_TOKEN")),e.setRequestHeader("Content-Type",i))};function n(e,t){this.container=t,this._statsObjects={},this._statsGatheringInterval=void 0,this._statsGatheringIntervalTime=1e3,this.statsConstants={connectedTransportKeyIncludes:"RTCTransport_",candidateKeyIncludes:"RTCIceCandidate",hostCandidateTypeValue:"host",candidatePairType:"candidate-pair",candidatePairSelectedState:"succeeded",localCandidateType:"local-candidate",remoteCandidateType:"remote-candidate"},this.statValidKeysMapping={RTCLiveIceCandidatePair:{bytesSent:"bytessent",bytesReceived:"bytesreceived",availableOutgoingBitrate:"availablebitrate",availableIncomingBitrate:"recvbitrate",totalRoundTripTime:"totalrtt",currentRoundTripTime:"rtt"},RTCOutboundRTPVideoStream_:{pliCount:"videoplisrecv",nackCount:"videonacksrecv"},RTCInboundRTPAudioStream_:{packetsLost:"recvaudiopacketlost"},RTCInboundRTPVideoStream_:{pliCount:"videoplissent",nackCount:"videonackssent",packetsLost:"recvvideopacketlost"}},this._initiateGathering(e)}var b={WAITING_TIME:6e4,RINGTONE_DURATION:65e3,WAITING_TIME_SECS:60,audio:"audio",video:"video",screen_share:"screen_share",screen_view:"screen_view",request_screen:"request_screen",audio_unified_mix:"audio_unified_mix",audio_smart:"audio_smart",screen_share_smart:"screen_share_smart",screen_view_smart:"screen_view_smart",data_channel:"data_channel",isAlreadySharing:"isAlreadySharing",0:"audio",2:"video",1:"screen_share",connecting:"connecting",connected:"connected",cancelled:"cancelled",sharing:"sharing",viewing:"viewing",facebookUrl:"https://facebook.com/pages",negotiation:"negotiation",offer:"offer",answer:"answer",height:"200",width:"370",reinit:"reinit",accept:"accept",miss:"miss",reject:"reject",end:"end",failed:"failed",request:"request",restart:"restart",candidates:"candidates",candidate:"candidate",screenshare:"screenshare",voicemessage:"voicemessage",upstream:"upstream",downstream:"downstream",incoming:"incoming",outgoing:"outgoing",ringing:"ringing",missed:"missed",rejected:"rejected",reconnecting:"reconnecting",requested:"requested",invited:"invited",ended:"ended",cancel:"cancel",visitor:"visitor",stopscreen:"stopscreen",click:"click",keyup:"keyup",stopsharing:"stopsharing",Zoho_SalesIQ:"Zoho_SalesIQ",window:"window",screen:"screen",Entire_Screen:"Entire Screen",desktop:"desktop",function:"function",call_initiate:"call_initiate",call_cancel:"call_cancel",call_miss:"call_miss",call_failed:"call_failed",invite:"invite",setCredential:"setCredential",handleInvitation:"handleInvitation",handleCallAccept:"handleCallAccept",handleCallReject:"handleCallReject",handleCandidates:"handleCandidates",handleCallAnswer:"handleCallAnswer",handleCallEnd:"handleCallEnd",handleCallOffer:"handleCallOffer",handleCallCancel:"handleCallCancel",handleCallMissed:"handleCallMissed",handleCallInvite:"handleCallInvite",handleCallRequest:"handleCallRequest",handleCallFailed:"handleCallFailed",audiocall:"audiocall",outgoingcall:"outgoingcall",incomingcall:"incomingcall",siq_directcall:"siq_directcall",siq_unifiedMedia:"siq_unifiedMedia",status:"status",is_refreshed:"is_refreshed",media_inv:"media_inv",https:"https",User_Agent:"User-Agent",disable:"disable",show:"show",hide:"hide",media_active:"media_active",requestCancelled:"requestCancelled",requestRejected:"requestRejected",requestMissed:"requestMissed",mediaCallDetails:"mediaCallDetails",mediaDetailsKeys:{wmsPushData:"wmsPushData",apiData:"apiData",callStatus:"callStatus",isCallInitiatedFromOldUI:"isCallInitiatedFromOldUI",isMobileOperator:"isMobileOperator"},activity:{MEDIA_AUDIO_INITIATE:101,MEDIA_AUDIO_ACCEPT:102,MEDIA_AUDIO_OFFER:103,MEDIA_AUDIO_ANSWER:104,MEDIA_AUDIO_CONNECT:105,MEDIA_AUDIO_REJECT:106,MEDIA_AUDIO_CANCEL:107,MEDIA_AUDIO_END:108,MEDIA_AUDIO_MISS:109,MEDIA_AUDIO_UI_SHOWN:131,MEDIA_AUDIO_UI_CLEARED:132,MEDIA_AUDIO_INVITATION_SHOWN:133,MEDIA_AUDIO_INVITATION_CLEARED:134,MEDIA_AUDIO_OUTGOING_UI_SHOWN:135,MEDIA_AUDIO_OUTGOING_UI_CLEARED:136,MEDIA_AUDIO_INCOMING_SOUND_START:146,MEDIA_AUDIO_OUTGOING_SOUND_START:147,MEDIA_AUDIO_SOUND_STOP:148,MEDIA_AUDIO_MIC_PERMISSION_ALLOWED:149,MEDIA_AUDIO_MIC_PERMISSION_BLOCKED:150,MEDIA_AUDIO_INPUT_DEVICE_CHANGED:151,MEDIA_AUDIO_OUTPUT_DEVICE_CHANGED:152,MEDIA_AUDIO_MUTE:161,MEDIA_AUDIO_UNMUTE:162,MEDIA_AUDIO_VOICE:163,MEDIA_AUDIO_START:164,MEDIA_AUDIO_RECONNECT_STATE:165,MEDIA_AUDIO_RENEGOTIATION_INITIATE:171,MEDIA_AUDIO_RENEGOTIATION_ACCEPT:172,MEDIA_AUDIO_RENEGOTIATION_CANCEL:173,MEDIA_AUDIO_RENEGOTIATION_REJECT:174,MEDIA_AUDIO_RENEGOTIATION_MISS:175,MEDIA_AUDIO_RENEGOTIATION_TRACKADDED:176,MEDIA_AUDIO_RENEGOTIATION_TRACKREMOVED:177,MEDIA_SCREENSHARE_INITIATE:201,MEDIA_SCREENSHARE_ACCEPT:202,MEDIA_SCREENSHARE_OFFER:203,MEDIA_SCREENSHARE_ANSWER:204,MEDIA_SCREENSHARE_CONNECT:205,MEDIA_SCREENSHARE_REJECT:206,MEDIA_SCREENSHARE_CANCEL:207,MEDIA_SCREENSHARE_END:208,MEDIA_SCREENSHARE_MISS:209,MEDIA_SCREENSHARE_UI_SHOWN:231,MEDIA_SCREENSHARE_UI_CLEARED:232,MEDIA_SCREENSHARE_CONFIRMBOX_SHOWN:233,MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED:234,MEDIA_SCREENSHARE_POPUP_SHOWN:235,MEDIA_SCREENSHARE_POPUP_CLEARED:236,MEDIA_SCREENSHARE_PLAYER_SHOWN:237,MEDIA_SCREENSHARE_PLAYER_CLEARED:238,MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED:246,MEDIA_SCREENSHARE_SCREEN_PERMISSION_BLOCKED:247,MEDIA_SCREENSHARE_SHARESCREEN:261,MEDIA_SCREENSHARE_REQUESTSCREEN:262,MEDIA_SCREENSHARE_RECONNECT_STATE:263,MEDIA_SCREENSHARE_SWAP:264,MEDIA_SCREENSHARE_RENEGOTIATION_REQUEST:271,MEDIA_SCREENSHARE_RENEGOTIATION_ACCEPT:272,MEDIA_SCREENSHARE_RENEGOTIATION_CANCEL:273,MEDIA_SCREENSHARE_RENEGOTIATION_REJECT:274,MEDIA_SCREENSHARE_RENEGOTIATION_MISS:275,MEDIA_SCREENSHARE_RENEGOTIATION_TRACKADDED:276,MEDIA_SCREENSHARE_RENEGOTIATION_TRACKREMOVED:277},TURN_URL:["geo","primary","secondary","default"],error_code:{AUDIO_CALL_NOT_ALLOWED:5001,UNABLE_TO_INTIATE_CALL:5004,ALREADY_CLOSE_CONVERSATION:6104},iceConnectionStates:{CONNECTED:"connected",COMPLETED:"completed",FAILED:"failed",DISCONNECTED:"disconnected",CLOSED:"closed"},callMode:{P2P:"visitor",O2O:"operator",UNIFIED_P2P:"unifiedVisitor"},audioCallAllowedBrowserVersions:{chrome:23,firefox:22,opera:18,safari:11},screenShareAllowedBrowserVersions:{chrome:72,firefox:66,opera:60,safari:13}};function o(e,t){var a=this;this.container=t,this._id=e.mediaID,this._connection=e.connection,this._timeVsStats={},this._networkInfo={},this._networkInfoCallBack=e.networkInfoCallBack,this._updateStatsCallBack=e.updateStatsCallBack,this._hasSentNetworkInfo=!1,this._statsObjectMaxSize=30,o.prototype.setNetworkInfo=function(e,t,i){a._networkInfo={network_type:e,private_ip:t,public_ip:i}},o.prototype.getId=function(){return this._id},o.prototype.getConnection=function(){return this._connection},o.prototype.isConnectionActive=function(){var e=this.getConnection().iceConnectionState;return e===b.iceConnectionStates.CONNECTED||e===b.iceConnectionStates.COMPLETED},o.prototype.isConnectionClosed=function(){return this.getConnection().iceConnectionState===b.iceConnectionStates.CLOSED},o.prototype.hasSentNetworkInfo=function(){return this._hasSentNetworkInfo},o.prototype.sendNetworkInfo=function(){"function"==typeof this._networkInfoCallBack&&this._networkInfoCallBack(this._id,this._networkInfo),this._hasSentNetworkInfo=!0},o.prototype.updateAndSendStats=function(e,t){this._timeVsStats[e]=t,Object.keys(this._timeVsStats).length===this._statsObjectMaxSize&&this._sendStats()},o.prototype._sendStats=function(){this._updateStatsCallBack(this._id,this._timeVsStats),this._timeVsStats={}}}n.prototype._isHostCandidate=function(e){return(this._isLocalCandidate(e)||this._isRemoteCandidate(e))&&e.candidateType===this.statsConstants.hostCandidateTypeValue},n.prototype._isLocalCandidate=function(e){return void 0!==e&&e.type===this.statsConstants.localCandidateType},n.prototype._isRemoteCandidate=function(e){return void 0!==e&&e.type===this.statsConstants.remoteCandidateType},n.prototype._isCandidatePair=function(e){return void 0!==e&&e.type===this.statsConstants.candidatePairType},n.prototype._isCandidatePairSelected=function(e){return this._isCandidatePair(e)&&e.state===this.statsConstants.candidatePairSelectedState},n.prototype._getSelectedCandidatePair=function(e){var t=void 0,i=e.values(),a=void 0;do{var n=(a=i.next()).value;if(this._isCandidatePairSelected(n)){t=n.id;break}}while(!a.done);return t},n.prototype._getValidStatKey=function(e){for(var t in this.statValidKeysMapping)if(-1!==e.indexOf(t)||e.toUpperCase()===t.toUpperCase())return t},n.prototype._redefineStats=function(e,t){var i={},e=this._getValidStatKey(e);if(e){var a,n=this.statValidKeysMapping[e];for(a in n)i[n[a]]=t[a]}return i},n.prototype._findHostCandidate=function(e,i){var a,n=this;return e.forEach(function(e,t){n._isHostCandidate(e)&&e.networkType===i&&(a=e)}),a},n.prototype._updateAndSendNetworkInfo=function(e,t,i){var a=t.get(i.localCandidateId),n=a.networkType,o=a.ip||a.address,s=void 0,i=void 0;void 0!==(i=this._isHostCandidate(a)?a:this._findHostCandidate(t,n))&&(s=i.ip||i.address),e.setNetworkInfo(n,s,o),e.sendNetworkInfo()},n.prototype._updateStatsData=function(a){var n=this,e=a.getConnection();a.isConnectionClosed()?this._stopGathering(a.getId()):a.isConnectionActive()&&e.getStats().then(function(e){var i,t=n._getSelectedCandidatePair(e);void 0!==t&&(t=e.get(t),a.hasSentNetworkInfo()||n._updateAndSendNetworkInfo(a,e,t),i=n._redefineStats("RTCLiveIceCandidatePair",t),e.forEach(function(e,t){i=Object.assign({},i,n._redefineStats(t,e))}),a.updateAndSendStats((new Date).getTime(),i))})},n.prototype._initiateGathering=function(e){var t,i=this,a=e.mediaID;this.container.MediaDetails.checkBrowserSupportedForStats()&&((t=this._statsObjects[a]||{})[a]=new o(e,this.container),this._statsObjects=t,void 0===this._statsGatheringInterval&&(this._statsGatheringInterval=setInterval(function(){i._gatherStats()},this._statsGatheringIntervalTime)))},n.prototype._gatherStats=function(){for(var e in this._statsObjects){e=this._statsObjects[e];try{this._updateStatsData(e)}catch(e){}}},n.prototype._stopGathering=function(e){var t=this._statsObjects[e];t&&t._sendStats(),delete this._statsObjects[e],0===Object.keys(this._statsObjects).length&&(clearInterval(this._statsGatheringInterval),this._statsGatheringInterval=void 0)};function C(e,t){this.container=t,this.sdpConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!1},this.audio="audio",this.screen_share="screen_share",this.video="video",this.curr_connection={audio:!1,screen_share:!1,video:!1},this.init(e)}C.prototype.init=function(e){this.chid=e.chatid,this.mid=e.id,this.type=e.type,this.localDescription="",this.remoteDescription="",this.localStream="",this.remoteStream="",this.localIceCandidates=[],this.remoteIceCandidates=[],this.iceRestart=e.iceRestart,this.isUpStream=e.isUpStream,this.connectionStatus="",this.rtcConnection="",this.isReconnecting=!1,this.remoteCandidatePushed=!1,this.mediaRequest=e.mediaRequest,this.reconnectInterval=null,this.statsObj=null,this.reconnectEndTimer=null,this.audioStream=null,this.screenStream=null,this.remoteStream=[],this.remoteAudioStream=null,this.remoteScreenStream=null,this.screenRtpSenders=null,this.audioRtpSenders=null,this.videoRtpSenders=null,this.isOfferer=!1,this.remoteTracksId=null,this.isNegotiation=!1,this.negotiationType=null,this.streamType={audio:"audioStream",screen_share:"screenStream",video:"videoStream",screen_view:"screenStream"},this.streamData={audio:"audioRtpSenders",screen_share:"screenRtpSenders",screen_view:"screenRtpSenders",video:"videoRtpSenders"},this.currentPerfectRenegotiation=this.container.MediaDetails.getClientSupport().perfect_renegotiation,this.remotePerfectRenegotiation=e.perfectReNegotiation||!0,this.isFirstOfferer=!1,this.istransceiverAdded=!1,this.isCallConnected=!1,this.intRTCConn()},C.prototype.intRTCConn=function(){try{this.rtcConnection=new RTCPeerConnection(this.getCredentail()),this.getStream(),this.isUpStream&&(!this.iceRestart&&this[this.streamType[this.type]]&&this.addStream(),this.isFirstOfferer=!0,this.createOffer(),this[this.curr_connection[this.type]]=!0),this.getRemoteStream(),this.rtcConnectionStatus()}catch(e){}},C.prototype.getStream=function(){this[this.streamType[this.type]]=this.container.MediaPermission.getStreamByType(this.type)},C.prototype.getCredentail=function(){var e=this.mid,t=this.container.dataHandler.get(e+"_credential").credential;if(t){var t=D(t),e=this.getServerUrl(t,e).split(","),i=t.user_name,a=t.token,n=[];return e.forEach(function(e){n.push({username:i,urls:e,credential:a})}),{iceServers:n}}return null},C.prototype.getServerUrl=function(e,t){var i=this.container.dataHandler;switch(i.get(t+"_nextTurnServer")){case b.TURN_URL[0]:return i.set(t+"_nextTurnServer",b.TURN_URL[1]),e.geo_turnurls||this.getServerUrl(e,t);case b.TURN_URL[1]:return i.set(t+"_nextTurnServer",b.TURN_URL[2]),e.primary_turnurls||this.getServerUrl(e,t);case b.TURN_URL[2]:return i.set(t+"_nextTurnServer",b.TURN_URL[3]),e.secondary_turnurls||this.getServerUrl(e,t);case b.TURN_URL[3]:if(i.remove(t+"_nextTurnServer"),e.servers)return e.servers;break;default:return i.remove(t+"_nextTurnServer"),e.servers}},C.prototype.createOffer=function(){var t=this,e=this.getSDPConstraints();this.iceRestart&&(e.iceRestart=!0),this.rtcConnection.createOffer(e).then(function(e){return t.offerSuccessCallBack(e)}).catch(function(e){return t.offerErrorCallBack(e)})},C.prototype.offerSuccessCallBack=function(e){var t=this.container,i=t.commonImpl,t=t.constants;this.isOfferer=!0,this.localDescription=e,this.rtcConnection.setLocalDescription(new RTCSessionDescription(e));e={session:R(e)};this.isNegotiation&&(e.tracks_id=R(this.tracksId),e.negotiation_type=this.negotiationType,e.process_type=t.negotiation);e={action:t.offer,success_cbk:null,failure_cbk:null,extraData:e};i.setApiData(this.mid,e),i.makeApiCall(this.mid),this.createIceCandidates()},C.prototype.offerErrorCallBack=function(e){},C.prototype.createAnswer=function(){var t=this;this.rtcConnection.createAnswer(this.sdpConstraints).then(function(e){return t.answerSuccessCallBack(e)}).catch(function(e){return t.answerErrorCallBack(e)})},C.prototype.answerSuccessCallBack=function(e){var t=this.container,i=t.commonImpl,t=t.constants;this.localDescription=e,this.rtcConnection.setLocalDescription(new RTCSessionDescription(e));e={session:R(e)};this.negotiationType&&(e.tracks_id=R(this.tracksId),e.negotiation_type=this.negotiationType,e.process_type=t.negotiation);e={action:t.answer,success_cbk:null,failure_cbk:null,extraData:e};i.setApiData(this.mid,e),i.makeApiCall(this.mid)},C.prototype.addStream=function(){var t=this;this[this.streamType[this.type]]&&this[this.streamType[this.type]].getTracks().forEach(function(e){t[t.streamData[t.type]]="function"==typeof t.rtcConnection.addTrack?t.rtcConnection.addTrack(e,t[t.streamType[t.type]]):t.rtcConnection.addStream(t[t.streamType[t.type]])})},C.prototype.createIceCandidates=function(){var i=this,e=this.container,a=e.commonImpl,n=e.constants;this.localIceCandidates=[],this.rtcConnection.onicecandidate=function(e){i.localIceCandidates.push(e);var t={};e.candidate&&(t.label=e.candidate.sdpMLineIndex,t.type=n.candidate,t.id=e.candidate.sdpMid,t.candidate=e.candidate.candidate,t={candidates:R(t)},t={action:n.candidates,success_cbk:null,failure_cbk:null,extraData:t},a.setApiData(i.mid,t),a.makeApiCall(i.mid))}},C.prototype.setRemoteDescription=function(e){var t=this;this.negotiationType&&this.negotiationType==this.audio&&!this.audioRtpSenders&&(this.audioStream=this.container.MediaPermission.getStreamByType("audio"),this.audioRtpSenders=this.addTrack(this.audioStream)),this.isUpStream||this.isReconnecting||this.iceRestart||!this.audioStream||this.audioRtpSenders||this.addStream(),this.rtcConnection.setRemoteDescription(new RTCSessionDescription(D(e))).then(function(){t.isOfferer||(t.createAnswer(),t.createIceCandidates()),t.clearReconnectNWTimer()}),this.remoteDescription=e,this.remoteCandidatePushed||this.pushIceCandidate(),this.negotiationType&&this.updateRemoteStream()},C.prototype.setOfferRemoteDescription=function(e){this.isOfferer=!1,this.localDescription=null,this.curr_connection.audio=!(!this.remoteTracksId||!this.remoteTracksId[this.audio]),this.curr_connection.screen_share=!(!this.remoteTracksId||!this.remoteTracksId[this.screen_share]),this.tracksId=this.container.MediaPermission.getTracksId(),this.setRemoteDescription(e)},C.prototype.setAnswerRemoteDesription=function(e){this.isOfferer=!0,this.setRemoteDescription(e)},C.prototype.pushIceCandidate=function(){var t=this;this.remoteIceCandidates.forEach(function(e){e=new RTCIceCandidate({sdpMid:e.id,sdpMLineIndex:e.label,candidate:e.candidate});t.rtcConnection.addIceCandidate(e)}),this.remoteCandidatePushed=!0},C.prototype.setIceCandidates=function(e){var t=D(e.candidates||e.msg.candidate);this.remoteDescription&&this.localDescription?(this.remoteIceCandidates&&0<this.remoteIceCandidates.length&&!this.remoteCandidatePushed&&this.pushIceCandidate(),e=new RTCIceCandidate({sdpMid:t.id,sdpMLineIndex:t.label,candidate:t.candidate}),this.rtcConnection.addIceCandidate(e)):(this.remoteIceCandidates&&0<this.remoteIceCandidates.length||(this.remoteIceCandidates=[]),this.remoteIceCandidates.push(t))},C.prototype.rtcConnectionStatus=function(){var a=this;this.rtcConnection.oniceconnectionstatechange=function(){var e,t=a.rtcConnection.iceConnectionState,i=a.mid;"connected"==t?(a.remoteIceCandidates=[],a.localIceCandidates=[],a.remoteDescription=null,a.localDescription=null,a.isCallConnected=!0,e=a.type+"Impl",a.container[e].callConnected(a),a.container.commonImpl.clearNetworkTimer(a),a.statsObj=new n({mediaID:i,connection:a.rtcConnection,networkInfoCallBack:a.container.commonImpl.sendRTCNetworkStats,updateStatsCallBack:a.container.commonImpl.sendRTCConnectionStats},a.container)):"failed"==t&&(a.isCallConnected?a.initReconnect():a.container.dataHandler.get(i+"_nextTurnServer")?(a.clearRTCData(),a.intRTCConn()):a.initCallFailed())},this.rtcConnection.onconnectionstatechange=function(e){var t=a.mid;"failed"==a.rtcConnection.connectionState&&(a.isCallConnected?a.initReconnect():a.container.dataHandler.get(t+"_nextTurnServer")?(a.clearRTCData(),a.intRTCConn()):a.initCallFailed()),"connected"==a.rtcConnection.iceConnectionState&&(a.remoteIceCandidates=[],a.localIceCandidates=[],a.remoteDescription=null,a.localDescription=null,a.isCallConnected=!0,a.updateRemoteStream())}},C.prototype.initReconnect=function(){this.isReconnecting=!0,this.iceRestart=!0,this.remoteIceCandidates=[],this.remoteDescription=null,this.remoteCandidatePushed=!1,this.container.commonImpl.checkNetwork(this.chid,this.mid)},C.prototype.initCallFailed=function(){this.container.commonImpl.callFailed(this.chid,this.mid)},C.prototype.getRemoteStream=function(){var t=this;this.rtcConnection.onaddstream=this.rtcConnection.ontrack=function(e){t.remoteStream.push(e),(e.streams&&e.streams[0]||e.stream)&&t.container[t.type+"Impl"].addRemoteStream(e,t),t.type!=t.screen_share&&"screen_view"!=t.type||t.negotiationType||e.streams&&(e.streams[0].onremovetrack=t.handleScreenTrackremoved),t.negotiationType&&e.streams&&e.streams[0]&&t.updateRemoteStream()}},C.prototype.updateRemoteStream=function(){try{for(var e in this.remoteStream){var t,i=this.remoteStream[e],a=null,a="track"==i.type?i.streams&&i.streams[0]?i.streams[0].id:null:i.stream?i.stream.id:null;for(t in this.remoteTracksId){var n=this.remoteTracksId[t];a&&a===n&&(this.container[t+"Impl"].addRemoteStream(i,this),t==this.screen_share&&i.streams&&i.streams[0]&&(i.streams[0].onremovetrack=this.handleScreenTrackremoved))}}}catch(e){}},C.prototype.handleScreenTrackremoved=function(){SiqAVRouter.container.commonImpl.handleScreenTrackEnd()},C.prototype.contructResponse=function(e){var t=this.mid,i=this.type,a=this.chid;return Object.assign({},{mid:t,type:i,chid:a},e)},C.prototype.closeConnection=function(){try{this.rtcConnection.close(),this.statsObj._stopGathering(this.mid),this[this.streamType[this.type]]&&this.closeTracksInStream(this[this.streamType[this.type]])}catch(e){}},C.prototype.closeTracksInStream=function(e){try{e.getTracks().forEach(function(e){return e.stop()})}catch(e){}},C.prototype.getSDPConstraints=function(){var e=this.type,t=(this.mid,this.chid),i=this.container,a=i.dataHandler,i=i.constants,t=(a.get(t+"_call_status",!0),{offerToReceiveAudio:!0,offerToReceiveVideo:!0});return e==i.audio?t.offerToReceiveVideo=!0:e==i.screen_share&&(t.offerToReceiveVideo=!0,t.offerToReceiveAudio=!0),t},C.prototype.clearReconnectNWTimer=function(){this.reconnectInterval&&(clearInterval(this.reconnectInterval),this.reconnectInterval=null,this.iceRestart=!1)},C.prototype.addAudioTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.audioStream=this.container.MediaPermission.getStreamByType(this.audio),this.audioRtpSenders=this.addTrack(this.audioStream),this.isNegotiation=!0,this.negotiationType=this.audio,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!0,this.createOffer(),!0)},C.prototype.removeAudioTrackInConnection=function(){this.rtcConnection.removeTrack(this.audioRtpSenders),this.container.MediaPermission.closeStreamByType(this.audio)},C.prototype.addScreenTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.screenStream=this.container.MediaPermission.getStreamByType(this.screen_share),this.screenRtpSenders=this.addTrack(this.screenStream),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!0,this.createOffer(),this.istransceiverAdded=!0)},C.prototype.removeScreenTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.rtcConnection.removeTrack(this.screenRtpSenders),this.container.MediaPermission.closeStreamByType(this.screen_share),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!1,this.screenRtpSenders=null,this.createOffer(),!0)},C.prototype.addTrack=function(t){var i,a=this;return t&&t.getTracks().forEach(function(e){i="function"==typeof a.rtcConnection.addTrack?a.rtcConnection.addTrack(e,t):a.rtcConnection.addStream(t)}),i},C.prototype.checkIsEligibleToCreateOfferOnNegotiation=function(){return!!(this.currentPerfectRenegotiation&&this.remotePerfectRenegotiation||this.isFirstOfferer)},C.prototype.screenShareRenegotiation=function(){this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.istransceiverAdded||(this.rtcConnection.addTransceiver(this.video),this.istransceiverAdded=!0),this.createOffer()},C.prototype.handleScreenShareRenegotiation=function(e,t){(t=void 0===t?!1:t)?(this.rtcConnection.removeTrack(this.screenRtpSenders),this.container.MediaPermission.closeStreamByType(this.screen_share)):(this.screenStream=this.container.MediaPermission.getStreamByType(this.screen_share),this.screenRtpSenders=this.addTrack(this.screenStream)),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.setOfferRemoteDescription(e)},C.prototype.audioRenegotiation=function(){this.__addAudioTracks(),this.isNegotiation=!0,this.negotiationType=this.audio,this.tracksId=this.container.MediaPermission.getTracksId(),this.createOffer()},C.prototype.handleAudioRenegotiation=function(e){this.__addAudioTracks(),this.isNegotiation=!0,this.negotiationType=this.audio,this.setOfferRemoteDescription(e)},C.prototype.__addAudioTracks=function(){this.audioStream=this.container.MediaPermission.getStreamByType(this.audio),this.audioRtpSenders=this.addTrack(this.audioStream)},C.prototype.clearRTCData=function(){this.remoteIceCandidates=[],this.remoteDescription=null,this.localDescription=null,this.audioRtpSenders=null,this.rtcConnection.close(),this.container.uiHandler.updateCallInvitationState(this.type,{chid:this.chid,media_id:this.mid},b.reconnecting)};function r(e,t){this.container=t,this.sdpConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!1},this.audio="audio",this.screen_share="screen_share",this.video="video",this.curr_connection={audio:!1,screen_share:!1,video:!1},this.init(e)}r.prototype.init=function(e){this.chid=e.chatid||e.chid,this.mid=e.id,this.type=e.datatype||e.type,this.localDescription="",this.remoteDescription="",this.localStream="",this.remoteStream="",this.localIceCandidates=[],this.remoteIceCandidates=[],this.iceRestart=e.iceRestart||!1,this.isUpStream=e.isUpStream,this.connectionStatus="",this.rtcConnection="",this.isReconnecting=!1,this.remoteCandidatePushed=!1,this.mediaRequest=e.mediaRequest,this.reconnectInterval=null,this.statsObj=null,this.reconnectEndTimer=null,this.audioStream=null,this.screenStream=null,this.remoteStream=[],this.remoteAudioStream=null,this.remoteScreenStream=null,this.screenRtpSenders=null,this.audioRtpSenders=null,this.videoRtpSenders=null,this.isOfferer=!1,this.remoteTracksId=null,this.isNegotiation=!1,this.negotiationType=null,this.dataChannel=null,this.isDataChannel=e.isDataChannel||!1,this.streamType={audio:"audioStream",screen_share:"screenStream",video:"videoStream",screen_view:"screenStream",audio_unified_mix:"audioStream",screen_share_smart:"screenStream"},this.streamData={audio:"audioRtpSenders",screen_share:"screenRtpSenders",screen_view:"screenRtpSenders",video:"videoRtpSenders",audio_unified_mix:"audioRtpSenders",screen_share_smart:"screenRtpSenders"},this.currentPerfectRenegotiation=this.container.MediaDetails.getClientSupport().perfect_renegotiation,this.remotePerfectRenegotiation=e.perfectReNegotiation||!0,this.isFirstOfferer=!1,this.istransceiverAdded=!1,this.firstCandidate=null,this.creatorid=e.creatorid,this.intRTCConn()},r.prototype.intRTCConn=function(){try{this.rtcConnection=new RTCPeerConnection(this.getCredentail()),this.getStream(),this.isUpStream&&(this.iceRestart||!this[this.streamType[this.type]]||this.isDataChannel||this.addStream(),this.isFirstOfferer=!0,this.isDataChannel&&this.createDataChannel(),this.createOffer(),this[this.curr_connection[this.type]]=!0),this.getRemoteStream(),this.rtcConnectionStatus()}catch(e){}},r.prototype.getStream=function(){var e=this.type;"audio_unified_mix"==this.type?e="audio":"screen_share_smart"!=this.type&&"screen_view_smart"!=this.type||(e="screen_share"),this[this.streamType[this.type]]=this.container.MediaPermission.getStreamByType(e)},r.prototype.getCredentail=function(){var e=this.mid,t=this.container.dataHandler.get(e+"_credential");if(t.credential){var e=D(t.credential),t=e.servers.split(","),i=e.user_name,a=e.token,n=[];return t.forEach(function(e){n.push({urls:e,username:i,credential:a})}),{iceServers:n}}return null},r.prototype.createOffer=function(){var t=this,e=this.getSDPConstraints();this.iceRestart&&(e.iceRestart=!0),this.rtcConnection.createOffer(e).then(function(e){return t.offerSuccessCallBack(e)}).catch(function(e){return t.offerErrorCallBack(e)})},r.prototype.offerSuccessCallBack=function(e){this.isOfferer=!0,this.localDescription=e,this.rtcConnection.setLocalDescription(new RTCSessionDescription(e)),this.createIceCandidates()},r.prototype.sendOffer=function(){var e={description:this.localDescription.sdp,candidate:this.firstCandidate.candidate.candidate,dataType:this.type};this.isNegotiation&&(e.tracksId=this.tracksId,e.negotiationType=this.negotiationType,e.processType="negotiation"),this.iceRestart&&(e.processType=b.restart);var t=this.contructResponse(e),e=this.type+"Impl";this.container[e].sendUnifiedOffer(t)},r.prototype.offerErrorCallBack=function(e){},r.prototype.createAnswer=function(){var t=this;this.rtcConnection.createAnswer(this.sdpConstraints).then(function(e){return t.answerSuccessCallBack(e)}).catch(function(e){return t.answerErrorCallBack(e)})},r.prototype.answerSuccessCallBack=function(e){this.localDescription=e,this.rtcConnection.setLocalDescription(new RTCSessionDescription(e))},r.prototype.sendAnswer=function(){var e={description:this.localDescription.sdp,candidate:this.firstCandidate.candidate.candidate,dataType:this.type,creatorid:this.creatorid};this.isNegotiation&&(e.tracksId=this.tracksId,e.negotiationType=this.negotiationType,e.processType="negotiation");var t=this.contructResponse(e),e=this.type+"Impl";this.container[e].sendUnifiedAnswer(t)},r.prototype.addStream=function(){var t=this;this[this.streamType[this.type]]&&this[this.streamType[this.type]].getTracks().forEach(function(e){t[t.streamData[t.type]]="function"==typeof t.rtcConnection.addTrack?t.rtcConnection.addTrack(e,t[t.streamType[t.type]]):t.rtcConnection.addStream(t[t.streamType[t.type]])})},r.prototype.createIceCandidates=function(){var t=this;this.localIceCandidates=[],this.rtcConnection.onicecandidate=function(e){t.firstCandidate?e.candidate&&e.candidate.candidate&&t.localIceCandidates.push(e.candidate.candidate):(t.firstCandidate=e,t.isOfferer?t.sendOffer():t.sendAnswer()),e.candidate}},r.prototype.sendCandidates=function(){this.container[this.type+"Impl"].sendUnifiedCandidates(this.contructResponse({candidates:this.localIceCandidates,isupstream:this.isUpStream,dataType:this.type,creatorid:this.creatorid}))},r.prototype.createDataChannel=function(){this.dataChannel=this.rtcConnection.createDataChannel("receiveChannel"),this.dataChannel.binaryType="arraybuffer"},r.prototype.setRemoteDescription=function(e){var t=this;this.rtcConnection.setRemoteDescription(new RTCSessionDescription(D(e))).then(function(){t.isOfferer||(t.createAnswer(),t.createIceCandidates()),t.clearReconnectNWTimer()}),this.remoteDescription=e,this.remoteCandidatePushed||this.pushIceCandidate(),this.negotiationType&&this.updateRemoteStream()},r.prototype.setOfferRemoteDescription=function(e){this.isOfferer=!1,this.localDescription=null,this.curr_connection.audio=!(!this.remoteTracksId||!this.remoteTracksId[this.audio]),this.curr_connection.screen_share=!(!this.remoteTracksId||!this.remoteTracksId[this.screen_share]),this.tracksId=this.container.MediaPermission.getTracksId(),this.setRemoteDescription(e)},r.prototype.setAnswerRemoteDesription=function(e){this.isOfferer=!0,this.setRemoteDescription(e)},r.prototype.pushIceCandidate=function(){var t=this;this.remoteIceCandidates.forEach(function(e){e=new RTCIceCandidate({sdpMid:e.id,sdpMLineIndex:e.label,candidate:e.candidate});t.rtcConnection.addIceCandidate(e)}),this.remoteCandidatePushed=!0},r.prototype.setIceCandidatesArray=function(e){this.remoteIceCandidates=e.candidates,this.pushUnifiedIceCandidate()},r.prototype.setIceCandidates=function(e){var t=D(e.candidates||e.msg.candidate);this.remoteDescription&&this.localDescription?(this.remoteIceCandidates&&0<this.remoteIceCandidates.length&&!this.remoteCandidatePushed&&this.pushIceCandidate(),e=new RTCIceCandidate({sdpMid:t.id,sdpMLineIndex:t.label,candidate:t.candidate}),this.rtcConnection.addIceCandidate(e)):(this.remoteIceCandidates&&0<this.remoteIceCandidates.length||(this.remoteIceCandidates=[]),this.remoteIceCandidates.push(t))},r.prototype.rtcConnectionStatus=function(){var i=this;this.rtcConnection.oniceconnectionstatechange=function(){var e,t=i.rtcConnection.iceConnectionState;"connected"==t?(i.remoteIceCandidates=[],i.remoteDescription=null,i.localDescription=null,e=i.type+"Impl",i.type!=b.data_channel&&i.container[e].unifiedcallConnected(i),i.container.commonImpl.clearNetworkTimer(i),i.isUpStream&&!i.isNegotiation&&i.container[e].notifyUser(i)):"failed"==t&&i.initReconnect()},this.rtcConnection.onconnectionstatechange=function(e){"failed"==i.rtcConnection.connectionState&&i.initReconnect(),"connected"==i.rtcConnection.iceConnectionState&&(i.remoteIceCandidates=[],i.remoteDescription=null,i.localDescription=null,i.updateRemoteStream())}},r.prototype.initReconnect=function(){this.isReconnecting=!0,this.iceRestart=!0,this.remoteIceCandidates=[],this.remoteDescription=null,this.remoteCandidatePushed=!1,this.container.commonImpl.checkUnifiedNetwork(this)},r.prototype.getRemoteStream=function(){var t=this;this.rtcConnection.onaddstream=this.rtcConnection.ontrack=function(e){t.remoteStream.push(e),e.streams&&e.streams[0]&&t.container[t.type+"Impl"].addUnifiedRemoteStream(e,t),t.type!=t.screen_share&&"screen_view"!=t.type||t.negotiationType||e.streams&&(e.streams[0].onremovetrack=t.handleScreenTrackremoved),t.negotiationType&&e.streams&&e.streams[0]&&t.updateRemoteStream()}},r.prototype.updateRemoteStream=function(){try{for(var e in this.remoteStream){var t,i=this.remoteStream[e],a=null,a="track"==i.type?i.streams&&i.streams[0]?i.streams[0].id:null:i.stream?i.stream.id:null;for(t in this.remoteTracksId){var n=this.remoteTracksId[t];a&&a===n&&(this.container[t+"Impl"].addUnifiedRemoteStream(i,this),t==this.screen_share&&i.streams&&i.streams[0]&&(i.streams[0].onremovetrack=this.handleScreenTrackremoved))}}}catch(e){}},r.prototype.handleScreenTrackremoved=function(){SiqAVRouter.container.commonImpl.handleScreenTrackEnd()},r.prototype.contructResponse=function(e){var t=this.mid,i=this.type,a=this.chid;return Object.assign({},{mid:t,type:i,chid:a},e)},r.prototype.closeConnection=function(){try{this.rtcConnection.close(),this[this.streamType[this.type]]&&this.closeTracksInStream(this[this.streamType[this.type]])}catch(e){}},r.prototype.closeTracksInStream=function(e){try{e.getTracks().forEach(function(e){return e.stop()})}catch(e){}},r.prototype.getSDPConstraints=function(){var e=this.type,t=(this.mid,this.chid),i=this.container,a=i.dataHandler,i=i.constants,t=(a.get(t+"_call_status",!0),{offerToReceiveAudio:!0,offerToReceiveVideo:!1});return e==i.audio?t.offerToReceiveVideo=!1:e==i.screen_share||e==i.screen_share_smart||e==i.screen_view_smart?(t.offerToReceiveVideo=!0,t.offerToReceiveAudio=!1):e==i.data_channel&&(t.offerToReceiveVideo=!1,t.offerToReceiveAudio=!1),t},r.prototype.clearReconnectNWTimer=function(){this.reconnectInterval&&(clearInterval(this.reconnectInterval),this.reconnectInterval=null,this.iceRestart=!1)},r.prototype.addAudioTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.audioStream=this.container.MediaPermission.getStreamByType(this.audio),this.audioRtpSenders=this.addTrack(this.audioStream),this.isNegotiation=!0,this.negotiationType=this.audio,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!0,this.createOffer(),!0)},r.prototype.removeAudioTrackInConnection=function(){this.rtcConnection.removeTrack(this.audioRtpSenders),this.container.MediaPermission.closeStreamByType(this.audio)},r.prototype.addScreenTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.screenStream=this.container.MediaPermission.getStreamByType(this.screen_share),this.screenRtpSenders=this.addTrack(this.screenStream),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!0,this.createOffer(),this.istransceiverAdded=!0)},r.prototype.removeScreenTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.rtcConnection.removeTrack(this.screenRtpSenders),this.container.MediaPermission.closeStreamByType(this.screen_share),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!1,this.screenRtpSenders=null,this.createOffer(),!0)},r.prototype.addTrack=function(t){var i,a=this;return t&&t.getTracks().forEach(function(e){i="function"==typeof a.rtcConnection.addTrack?a.rtcConnection.addTrack(e,t):a.rtcConnection.addStream(t)}),i},r.prototype.checkIsEligibleToCreateOfferOnNegotiation=function(){return!!(this.currentPerfectRenegotiation&&this.remotePerfectRenegotiation||this.isFirstOfferer)},r.prototype.screenShareRenegotiation=function(){this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.istransceiverAdded||(this.rtcConnection.addTransceiver(this.video),this.istransceiverAdded=!0),this.createOffer()},r.prototype.handleScreenShareRenegotiation=function(e,t){(t=void 0===t?!1:t)?(this.rtcConnection.removeTrack(this.screenRtpSenders),this.container.MediaPermission.closeStreamByType(this.screen_share)):(this.screenStream=this.container.MediaPermission.getStreamByType(this.screen_share),this.screenRtpSenders=this.addTrack(this.screenStream)),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.setOfferRemoteDescription(e)},r.prototype.audioRenegotiation=function(){this.__addAudioTracks(),this.isNegotiation=!0,this.negotiationType=b.audio_unified_mix,this.firstCandidate=null,this.createOffer()},r.prototype.handleAudioRenegotiation=function(e){this.__addAudioTracks(),this.isNegotiation=!0,this.negotiationType=this.audio,this.setOfferRemoteDescription(e)},r.prototype.__addAudioTracks=function(){this.audioStream=this.container.MediaPermission.getStreamByType(this.audio),this.audioRtpSenders=this.addTrack(this.audioStream)},r.prototype.pushUnifiedIceCandidate=function(){var t=this;this.remoteIceCandidates.forEach(function(e){e=new RTCIceCandidate(D(e));t.rtcConnection.addIceCandidate(e)}),this.remoteCandidatePushed=!0};var e=function(e){(this.container=e).audioImpl=this,e.audio_unified_mixImpl=this,e.audio_smartImpl=this,(e.data_channelImpl=this).init(),this.audio="audio",this.timeout={},this.iconClicked={},this.reinit=!1,this.isWaitingForPermission=!1};e.prototype.setCredential=function(e){this.container.commonImpl.setCredential(e)},e.prototype.handleInvitation=function(e,t){var i=this;void 0===t&&(t=0);var a=this.container,n=a.constants,o=a.detailsHandler,s=a.commonImpl,r=a.mediaUIHandler,c=s.getWmsPushData(e),d=c.chatid,l=c.type,p=c.mediaRequest,u=c.isOldUI,h=c.perfectReNegotiation,m=c.mediaInvitation,_=c.isMobileOperator,f=c.datamode,a=n.RINGTONE_DURATION,c={};if(o.isOldUI()&&(c.is_old_ui=o.isOldUI()),f&&!o.isOldUI()&&(l=f),s.endCallFromSameChat(e),o.canShowAudioCallInvitation(d))try{var y=s.getActiveCallData();if(o.isembed&&y&&y!=d){var g={action:n.reject,success_cbk:null,failure_cbk:null,extraData:c};return s.setApiData(e,g),void s.makeApiCall(e)}function C(){clearTimeout(i.timeout[e]),i.handleUIReject(e)}var v,S,I,A,D={rejectCbk:C,acceptCbk:function(){clearTimeout(i.timeout[e]),i.handleUIAccept(e)},chid:d,media_id:e,isDirectCall:!1};if(s.checkIncomingCallAllowed(e)){var R={action:n.reject,success_cbk:null,failure_cbk:null,extraData:c};return s.setApiData(e,R),s.makeApiCall(e),!0}s.setCredential(e),u&&s.setIsCallInitiatedFromOldUI(u,e),_&&s.setIsMobileOperator(_,e),o.handleIncomingCall({type:l,chid:d}),m?(setTimeout(function(){r.handleAudioCallInvite(l,D)},500),v={callType:n.incoming,callStatus:n.ringing,mediarequest:p,host:n.downstream,isdirectcall:!1,isPerfectRenegotiation:h,type:l},s.setCallStatusData(e,v),s.setCallStatus(e),S=s.getActiveTab(),I={chatid:d,type:n.audiocall,duration:S?"3":a,tone:S?n.outgoingcall:n.incomingcall,isEncrypted:!1},s.playMediaNotificationSound(I),s.sendMediaActivity({param:{action_type:I.tone==n.incomingcall?b.activity.MEDIA_AUDIO_INCOMING_SOUND_START:b.activity.MEDIA_AUDIO_OUTGOING_SOUND_START,add_info:o.getMediaActivityAddInfo()},mid:e}),s.showDesktopNotif({chatid:d}),this.timeout[e]=setTimeout(C,a)):(A={callType:n.incoming,callStatus:n.connecting,mediarequest:p,host:n.downstream,isdirectcall:!1,isPerfectRenegotiation:h},s.setCallStatusData(e,A),s.setCallStatus(e),this.handleUIAccept(e));var E={chid:d,type:l,media_id:e,status:b.incoming};s.setMediaCache(b.siq_unifiedMedia,E),s.updateIncomingRequestData(e);var T="siqMedia: media invitation  | chid :"+d+" | mediaid : "+e+" | curUserId : "+o.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,T),o.triggerIconCheck(d)}catch(e){}else t<3&&(0==t&&o.joinChat(d),setTimeout(function(){return i.handleInvitation(e,t++)},3e3))},e.prototype.handleCallRequest=function(n){var o=this,e=this.container,s=e.commonImpl,r=e.mediaUIHandler,t=e.dataHandler,c=e.MediaPermission,d=e.constants,i=e.detailsHandler,a=s.getWmsPushData(n),l=a.chatid,e=a.negotiationType,a=a.processType,p=s.getCallStatusByChid(l),u=t.get(l+"_peer")||{},h={process_type:d.negotiation,negotiation_type:e};if(i.isOldUI()&&(h.is_old_ui=i.isOldUI()),a&&a==d.reinit)s.getPeerObject(n).audioRenegotiation();else try{function m(){clearTimeout(o.timeout[n]),r.updateCallInvitationState(d.audio,{chid:l,media_id:n},d.rejected);var e={action:d.reject,success_cbk:null,failure_cbk:null,extraData:h};s.setApiData(n,e),s.makeApiCall(n)}var _={chid:l,media_id:n,rejectCbk:m,acceptCbk:function(){clearTimeout(o.timeout[n]);var e={action:d.reject,success_cbk:null,failure_cbk:null,extraData:h},i={chid:l,media_id:n,isDirectCall:p[n].isdirectcall,muteCbk:function(){return o.toggleMute()},rejectCbk:function(){return s.setApiData(n,e)&&s.makeApiCall(n)}},a=function(){clearTimeout(t)},t=setTimeout(function(){a=r.mediaPermissionUI()},3e3);s.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_RENEGOTIATION_ACCEPT},mid:n}),c.getAudioStream(function(){a(),s.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_MIC_PERMISSION_ALLOWED},mid:n}),r.updateCallInvitationState(d.audio,i,d.connecting);var e={action:d.accept,success_cbk:null,failure_cbk:null,extraData:h},t=s.isSmartFlow(n);s.setApiData(n,e),s.makeApiCall(n),t?o.addAudioCallInConnection():u[n].addAudioTrackInConnection()||o.handleInitReNegotiation(n),s.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_RENEGOTIATION_TRACKADDED}})},o.onDownStreamMediaPermissionFailureSecondary({chatid:l,id:n,cbk:a}))}};this.timeout[n]=setTimeout(m,65e3),r.handleAudioCallInvite(e,_)}catch(e){}},e.prototype.callConnected=function(e){var t=this,i=e.chid,a=(e.type,e.mid),n=(e.isReconnecting,this.container),o=n.commonImpl,s=n.dataHandler,r=n.mediaUIHandler,e=n.detailsHandler,c=n.constants,n=o.getCallStatusByChid(i)[a].isdirectcall;clearTimeout(s.get(a+"_connecting_timer")),r.updateCallInvitationState(c.audio,{chid:i,callEndCbk:n?function(){return t.handleUIApiCallEnd(a)}:function(){var e={action:c.end,success_cbk:null,failure_cbk:null,extraData:{}};o.setApiData(a,e),o.makeApiCall(a),t.handleCallEnd(a)},muteCbk:function(){return t.toggleMute()},media_id:a,isDirectCall:n},c.connected),o.updateMediaCache(b.siq_unifiedMedia,b.status,b.connected);r=o.getCallStatusData(a);r?r.callStatus=c.connected:r={callStatus:c.connected},o.setCallStatusData(a,r),o.updateCallStatus(a),e.triggerIconCheck(i),o.sendMediaStats({id:a},"call connected ");e="siqMedia: Audio call connected  | chid :"+i+" | mediaid : "+a+" | curUserId : "+e.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,e);i=s.get(i+"_peer");i&&i[a]&&i.reconnectEndTimer&&clearTimeout(i.reconnectEndTimer),n&&o.updateMediaCache(b.siq_directcall,b.status,b.connected),o.updateMediaStatsDetail({connectedTime:Date.now(),isreconnected:!1,mediaid:a}),o.getConnectedStatsDetail(a),o.makeApiCall(a),o.stopNotificationSound()},e.prototype.handleCallAccept=function(t){var i=this,e=this.container,a=e.dataHandler,n=e.constants,o=e.commonImpl,s=e.mediaUIHandler,r=e.detailsHandler,c=o.getWmsPushData(t),d=c.chatid,l=c.type,p=c.processType,u=c.isOldUI,h=c.isMobileOperator,m=c.perfectReNegotiation,_=n.WAITING_TIME,f=d+"_peer",e=a.get(f)||{},y=o.getCallStatusByChid(d);if(clearTimeout(a.get(t+"_waiting_timer")),a.remove(t+"_waiting_timer"),r.handleOutgoingAccept({type:l,chid:d}),!p||p!=n.negotiation){u&&o.setIsCallInitiatedFromOldUI(u,t),h&&o.setIsMobileOperator(h,t);c.isUpStream=!0,c.iceRestart=!1,e[t]=new C(c,this.container),a.set(f,e),o.updateMediaCache(b.siq_unifiedMedia,b.status,b.accept);e=o.getCallStatusData(t);e?(e.type=l,e.callStatus=n.connecting,e.isPerfectRenegotiation=m):e={callStatus:n.connecting,isPerfectRenegotiation:m},o.setCallStatusData(t,e),o.updateCallStatus(t),a.set(t+"_connecting_timer",setTimeout(function(){var e={action:n.end,success_cbk:null,failure_cbk:null,extraData:{}};o.setApiData(t,e),o.makeApiCall(t),i.clearData(t),s.updateCallInvitationState(n.audio,{chid:d,media_id:t},n.ended)},_));_={};r.isOldUI()&&(_.is_old_ui=r.isOldUI());_={action:y[t].host==n.upstream?n.cancel:n.reject,success_cbk:null,failure_cbk:null,extraData:_};o.setApiData(t,_);_={chid:d,media_id:t,isDirectCall:y[t].isdirectcall,muteCbk:function(){return i.toggleMute()},rejectCbk:function(){return y[t].host,n.upstream,o.makeApiCall(t)}};s.updateCallInvitationState(n.audio,_,n.connecting),o.stopNotificationSound(),o.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_SOUND_STOP,add_info:r.getMediaActivityAddInfo()},mid:t});try{var g={type:l,acceptedTime:Date.now(),callerType:0,reconnectCount:0,mediaid:t};o.setMediaStatsDetail(g)}catch(e){}r="siqMedia: call accept request received  | chid :"+d+" | mediaid : "+t+" | curUserId : "+r.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,r)}},e.prototype.handleCallReject=function(e){var t=this.container,i=t.commonImpl,a=t.mediaUIHandler,n=t.dataHandler,o=t.detailsHandler,s=t.constants,r=i.getWmsPushData(e),c=r.chatid,d=r.processType,t=r.opruser,r=i.getCallStatusByChid(c),t={chid:c,media_id:e,isDirectCall:r[e].isdirectcall,lsuid:D(t).lsuid,process_type:d};delete this.iconClicked[c],clearTimeout(n.get(e+"_waiting_timer")),clearTimeout(n.get(e+"_connecting_timer")),a.updateCallInvitationState(s.audio,t,s.rejected),r[e].isdirectcall&&i.removeMediaCache(s.siq_directcall),d&&d==s.negotiation||(this.clearData(e),delete r[e],i.removeCredential(e),i.removeMediaCache(b.siq_unifiedMedia),o.handleCallRejected({type:s.audio,chid:c}),o="siqMedia: call reject request received  | chid :"+c+" | mediaid : "+e+" | curUserId : "+o.getCurrentUserId(),this.callBackAction(this.implConstants.postDebugLog,o))},e.prototype.handleCandidates=function(e){var t=this.container,i=t.dataHandler,a=t.commonImpl,n=a.getWmsPushData(e),o=n.chatid,t=i.get(o+"_peer")[e];t||((t={})[e]=new C(n,this.container),i.set(o+"_peer",t),t=t[e],a.setRemotePerfectReNegotiation(t,e,o)),t.setIceCandidates(n)},e.prototype.handleCallAnswer=function(e){var t=this.container,i=t.commonImpl,a=t.dataHandler,n=i.getWmsPushData(e),o=n.chatid,t=n.session,i=n.tracksId,n=n.negotiationType,e=a.get(o+"_peer")[e];e.remoteTracksId=i?JSON.parse(i):null,e.negotiationType=n||null,e.setAnswerRemoteDesription(t)},e.prototype.handleCallEnd=function(e){var t=this.container,i=t.commonImpl,a=t.mediaUIHandler,n=t.detailsHandler,o=t.constants,s=t.screenShareImpl,r=i.getWmsPushData(e).chatid,c=i.getCallStatusByChid(r),t={chid:r,media_id:e,isDirectCall:c[e].isdirectcall};a.updateCallInvitationState(o.audio,t,o.ended),c[e].isdirectcall&&i.removeMediaCache(o.siq_directcall),s.handleAudioCallEnd(r),this.clearData(e),n.removeAudioPlayers(),n.handleCallEnded({type:o.audio,chid:r})},e.prototype.handleCallOffer=function(e){var t,i,a,n,o,s=this.container,r=s.dataHandler,c=s.constants,d=s.MediaPermission,l=s.commonImpl;l.isSmartFlow(e)||(i=(t=l.getWmsPushData(e)).chatid,a=t.session,n=t.tracksId,o=t.negotiationType,s=r.get(i+"_peer")||{},d.getStreamByType(c.screen_share)&&o==c.screen_share&&r.set(c.isAlreadySharing,!0),t.isUpStream=!1,t.iceRestart=!1,c=s[e],s[e]||(s[e]=new C(t,this.container),r.set(i+"_peer",s),c=s[e]),c.remoteTracksId=n?JSON.parse(n):null,c.negotiationType=o||null,l.setRemotePerfectReNegotiation(c,e,i),this.reinit?c.handleAudioRenegotiation(a):c.setOfferRemoteDescription(a),this.reinit=!1)},e.prototype.handleCallCancel=function(e){try{var t=this.container,i=t.commonImpl,a=t.mediaUIHandler,n=t.dataHandler,o=t.detailsHandler,s=t.constants,r=i.getWmsPushData(e),c=r.chatid,d=r.type,l=r.processType,p={chid:c,media_id:e,isDirectCall:i.getCallStatusByChid(c)[e].isdirectcall};if(clearTimeout(this.timeout[e]),clearTimeout(n.get(e+"_waiting_timer")),clearTimeout(n.get(e+"_connecting_timer")),a.updateCallInvitationState(s.audio,p,s.cancelled),l&&l==s.negotiation)return;i.removeCredential(e),i.removeMediaCache(b.siq_unifiedMedia);var u="siqMedia: call cancel request received  | chid :"+c+" | mediaid : "+e+" | curUserId : "+o.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,u),this.clearData(e),o.handleCallCancelled({type:d,chid:c})}catch(e){}},e.prototype.handleCallFailed=function(e){try{var t=this.container,i=t.commonImpl,a=t.mediaUIHandler,n=t.detailsHandler,o=t.constants,s=(t.screenShareImpl,i.getWmsPushData(e)),r=(s.processType,s.chatid),c=i.getCallStatusByChid(r),d={chid:r,media_id:e,isDirectCall:c[e].isdirectcall};a.updateCallInvitationState(o.audio,d,o.failed),c[e].isdirectcall&&i.removeMediaCache(o.siq_directcall),this.clearData(e),n.handleCallFailed({type:o.audio,chid:r})}catch(e){}},e.prototype.clearData=function(e){try{var t=this.container,i=t.detailsHandler,a=t.commonImpl,n=a.getWmsPushData(e);if(!n)return;var o=n.type,s=n.chatid,r="siqMedia: before clearing Audio call data  | chid :"+s+" | mediaid : "+e+" | curUserId : "+i.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,r),this.closePeerConn(e),a.removeCredential(e),a.checkAVIcon(s),a.clearCallDetails(s,e),a.getActiveCallData()&&a.getActiveCallData()==s&&!a.getCallStatusByChid(s)&&(a.removeActiveCallData(),a.removeActiveTab(),this.clearMediaPermision(o)),a.removeIncomingRequestData({id:e,chatid:s}),i.isEmbed()&&i.checkIsChatEndTimerAlive(s)||a.stopNotificationSound(),a.checkAndPlayNotification(),i.triggerIconCheck(s),a.clearConnectedStatsDetail(e),a.removeMediaCallDetails(e),a.removeMediaCache(b.siq_unifiedMedia)}catch(e){}},e.prototype.handleCallInvite=function(){},e.prototype.closePeerConn=function(t){var e=this.container,i=e.dataHandler,a=e.detailsHandler,n=e.commonImpl,o=n.getWmsPushData(t),e=o.type,o=o.chatid;try{var s,r=i.get(o+"_peer");r&&(s=r[t],n.clearNetworkTimer(s),s.closeConnection(),delete r[t]),this.clearMediaPermision(n.getType(e)),this.removeAudioPlayer()}catch(e){a="siqMedia: error while clearing peer connection  | chid :"+o+" | mediaid : "+t+" | curUserId : "+a.getCurrentUserId()+" | error msg :"+e;this.callBackAction(this.implConstants.postDebugLog,a)}},e.prototype.clearMediaPermision=function(e){"audio_unified_mix"==e?e="audio":"screen_share_smart"!=e&&"screen_view_smart"!=e||(e="screen_share"),this.container.MediaPermission.closeStreamByType(e)},e.prototype.startAudioCall=function(e){var t=this,i=this.container,a=i.commonImpl,n=i.detailsHandler,o=i.mediaUIHandler,s=i.MediaPermission,r=i.MediaDetails,c=i.constants,d=e.chatid,l=e.normalchid,p=e.mode,i=a.getActiveCallData();if((!i||i==d||n.isEmbed())&&!this.iconClicked[l||d]){if(this.iconClicked[l||d]=!0,n.isoldUI&&(e.is_old_ui=n.isoldUI),e.perfect_renegotiation=r.getClientSupport().perfect_renegotiation,i){var u,h=a.getCallStatusByChid(i);for(u in h)if(h[u].type==c.audio)return void delete this.iconClicked[l||d]}try{var m=n.isembed;if(p!=b.callMode.P2P&&p!=b.callMode.UNIFIED_P2P||(!!m||this.isAudioCallAllowed(e))){if(n.isAudioCallDisabled(d))return void delete this.iconClicked[l||d];var _,f=function(){clearTimeout(y)},y=setTimeout(function(){f=o.mediaPermissionUI()},3e3);this.isWaitingForPermission=!0,this.getAudioInputDevice()&&!n.isOldUI()&&(_=this.getAudioInputDevice(),s.updatePreferredDeviceByDeviceId(_,"audioInput")),s.getAudioStream(function(){f(),t.onMediaPermissionSuccess(e).call(t)},this.onUpStreamMediaPermissionFailure(function(){return f()},d))}else{var g="siqMedia: To start AUDIO call - permission checks failed | chid - "+d+" ";this.callBackAction(this.implConstants.postDebugLog,g),delete this.iconClicked[l||d]}}catch(e){}}},e.prototype.constructResponeObj=function(e){return Object.assign({},{type:"audio"},e)},e.prototype.onMediaPermissionSuccess=function(i){var a=this;try{var e=this.container,n=e.constants,o=e.commonImpl,s=e.ajaxHandler,t=e.MediaPermission,r=i.normalchid,c=i.chatid,d=i.mode,l=i.mediainvitation,p=i.mediarequest,c=(i.type,n.WAITING_TIME_SECS,r||c),u=o.getCallStatusByChid(c);if(i.mode=d||n.visitor,!this.isCallAllowed(c))return t.closeStreamByType(n.audio),delete this.iconClicked[c],function(){a.isWaitingForPermission=!1};var h=this.constructResponeObj(i);o.setActiveTab(),h.mediainvitation=l||!1,h.mediarequest=p||!1;var m=o.constructURL(null,null);return o.setActiveCallData(c),o.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_MIC_PERMISSION_ALLOWED}}),function(){a.isWaitingForPermission=!1;var e=a.onstarted.bind(a);if(u){h={};var t=Object.keys(u)[0];o.getCallStatusData(t).type;return m=o.constructURL(n.audio,t),e=function(){return a.onstartedSecondary({chid:c,id:t,negotiationType:h.negotiation_type||n.audio})},h.action=b.request,h.process_type=b.negotiation,h.negotiation_type=b.audio,void s.put(m,h,e,a.startCallFailure.bind(a),!0,"v3")}delete i.normalchid,h.normalchid&&delete h.normalchid,s.post(m,h,e,a.startCallFailure.bind(a),!0,!1,"v3")}}catch(e){}},e.prototype.onUpStreamMediaPermissionFailure=function(i,a){var n=this,e=this.container,o=e.commonImpl,s=e.mediaUIHandler;return function(e,t){o.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_MIC_PERMISSION_BLOCKED}}),i(),n.isWaitingForPermission=!1;e=o.getFailureMessage(e);s.mediaPermissionUnlock(),s.showDialog({desc:e,buttons:{accept:{text:"common.ok",callback:function(){return null}}}}),delete n.iconClicked[a]}},e.prototype.onDownStreamMediaPermissionFailure=function(e){var o=this,t=this.container,s=t.commonImpl,r=t.mediaUIHandler,c=t.detailsHandler,d=t.constants,l=e.chatid,p=e.id,u=e.cbk;return function(e,t){try{s.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_MIC_PERMISSION_BLOCKED},mid:p}),u(),r.mediaPermissionUnlock();var i=s.getFailureMessage(e),a={};c.isOldUI()&&(a.is_old_ui=c.isOldUI());var n={action:d.reject,success_cbk:null,failure_cbk:null,extraData:a};s.setApiData(p,n),s.makeApiCall(p),o.clearData(p),s.removeActiveTab(),r.updateCallInvitationState(d.audio,{chid:l,media_id:p},d.rejected),r.showDialog({desc:i,buttons:{accept:{text:"common.ok",callback:function(){return null}}}})}catch(e){}}},e.prototype.onDownStreamMediaPermissionFailureSecondary=function(e){var t=this.container,n=t.commonImpl,o=t.mediaUIHandler,i=t.detailsHandler,s=t.constants,r=e.chatid,c=e.id,d=e.cbk,l={process_type:s.negotiation,negotiation_type:s.audio};return i.isOldUI()&&(l.is_old_ui=i.isOldUI()),function(e,t){try{n.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_MIC_PERMISSION_BLOCKED},mid:c}),d(),o.mediaPermissionUnlock();var i=n.getFailureMessage(e),a={action:s.reject,success_cbk:null,failure_cbk:null,extraData:l};n.setApiData(c,a),n.makeApiCall(c),o.updateCallInvitationState(s.audio,{chid:r,media_id:c},s.rejected),o.showDialog({desc:i,buttons:{accept:{text:"common.ok",callback:function(){return null}}}})}catch(e){}}},e.prototype.isAudioCallAllowed=function(t){var e=this.container,i=e.commonImpl,a=e.mediaUIHandler,n=e.detailsHandler,e=e.MediaDetails,t=t.chatid;try{var o=n.getVisitorBrowser(t),s=n.getVisitorPage(t),r=!0,c="",d="",l=n.getVisitorID(t);return i.getMediaDataByChidAndType({chatid:t,type:this.audio})?(d="siqMedia - Call data not cleared/call ongoing | chid - "+t+" | visitorId - "+l,this.callBackAction(this.implConstants.postDebugLog,d),!1):(n.isChatMonitor(t)?(d="siqMedia - call Not Allowed because chat is in monitor | chid - "+t+" | chatMonitors - "+MediaLib.getConversationByCHID(chid).chat.ismonitor,c=n.I18N("av.info.chatinvite"),r=!1):n.isVisitorBrowserSupported(t)?e.checkBrowserSupported(b.audio)?n.isVisitorPageSecured(t)?n.isGroupConversation(t)?(c=n.I18N("av.info.chatinvite"),d="siqMedia - Failed Visitor not in secure connection | chid - "+t+" |  visitorId - "+l,r=!1):n.isAttenderBot(t)?(d="siqMedia - Failed bot attender | chid - "+t+" |  visitorId - "+l,r=!1):n.isFaceBookIntegration(t)&&(c=n.I18N("av.info.facebookpagenotsupported"),d="siqMedia - Failed Visitor is in Facebook page | chid - "+t+" |  visitorId - "+l,r=!1):(c=n.I18N("av.info.insecuredwebsite"),d="siqMedia - Failed Visitor not in secure connection | chid - "+t+" |  visitor page - "+s,r=!1):(c=n.I18N("av.audio.info.agentbrowsernotsupported"),d="siqMedia - Failed agent browser not supported| chid - "+t,r=!1):(c=n.I18N("av.audio.info.visitorbrowsernotsupported"),d="siqMedia - Failed visitor browser not supported | chid - "+t+" | browser-"+o,r=!1),r||(a.showDialog({desc:c,buttons:{accept:{text:"common.ok",callback:function(){return null}}}}),this.callBackAction(this.implConstants.postDebugLog,d)),r)}catch(e){this.callBackAction(this.implConstants.postDebugLog,"siqMedia - Failed in isAudioCallAllowed method | chid - "+t)}},e.prototype.postDebugLog=function(e){this.container.detailsHandler.sendDebugLogger(e,null,null,!0)},e.prototype.callBackAction=function(e,t){({postDebugLog:this.postDebugLog.bind(this)})[e](t)},e.prototype.init=function(){this.implConstants={postDebugLog:"postDebugLog"}},e.prototype.addRemoteStream=function(e,t){var i=this,a=this.container,n=a.detailsHandler,o=a.commonImpl,s=a.mediaUIHandler,r=a.constants,c=t.chid,d=t.mid,l=t.type,a=t.negotiationType,t=o.getCallStatusByChid(c)[d].isdirectcall;try{var p="siqMedia: adding remote stream  | chid :"+c+" | mediaid : "+d+" | lsuid : "+n.getCurrentUserId(),u=t?function(){i.handleUIApiCallEnd(d)}:function(){i.handleUIEnd(d)};l!=r.audio&&a!=r.audio||s.updateCallInvitationState(r.audio,{chid:c,id:d,callEndCbk:u},r.connected),this.callBackAction(this.implConstants.postDebugLog,p);var h,m="",_=e.stream;l!=this.audio&&a!=this.audio&&l!=r.audio_unified_mix||(m=this.addAudioPlayer()),e.streams&&(_=e.streams[0]);try{m.srcObject=_,this.getAudioOutputDevice()&&!n.isOldUI()&&(h=this.getAudioOutputDevice(),this.changeAudioPlayer(h,c))}catch(e){m.src=window.URL.createObjectURL(_)}o.checkAndUpdateUIForApi()}catch(e){n="siqMedia: adding remote stream  | chid :"+c+" | mediaid : "+d+" | lsuid : "+n.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,n)}},e.prototype.addAudioPlayer=function(){try{var e="siqMedia: creating audio player stream  | curUserId : "+this.container.detailsHandler.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,e);var t=document.querySelector("#remoteaudio");if(null!=t&&null!=t&&0!=t.length)return t;var i=document.createElement("audio");return i.id="remoteaudio",i.autoplay=!0,document.querySelector("body").appendChild(i),i}catch(e){}},e.prototype.removeAudioPlayer=function(){var e=document.querySelector("#remoteaudio");e.parentNode.removeChild(e)},e.prototype.startCallFailure=function(e){this.iconClicked={},callBackAction()},e.prototype.startcall=function(e,t,i){var a={},n=this.container,o=n.ajaxHandler,s=n.commonImpl,n=n.constants;a.type=e,a.chatid=t,a.mode=i||n.visitor;n=s.constructURL(null,null);s.setActiveCallData(t),o.post(n,a,this.onstarted,this.startCallFailure)},e.prototype.handleUIReject=function(e){var t=this.container,i=t.commonImpl,a=t.mediaUIHandler,n=t.detailsHandler,o=t.constants,s=i.getWmsPushData(e),r=s.chatid,t=s.type,s={chid:r,media_id:e,isDirectCall:i.getCallStatusByChid(r)[e].isdirectcall};a.updateCallInvitationState(o.audio,s,o.rejected);s={};n.isOldUI()&&(s.is_old_ui=n.isOldUI());s={action:o.reject,success_cbk:null,failure_cbk:null,extraData:s};i.setApiData(e,s),i.makeApiCall(e),i.removeMediaCache(b.siq_unifiedMedia),this.clearData(e),n.handleCallRejected({type:t,chid:r});n="siqMedia -  reject trigger from UI | chid :"+r+" | mediaid : "+e+" | curUserId : "+n.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,n)},e.prototype.handleUIEnd=function(e){var t=this.container,i=t.commonImpl,a=t.mediaUIHandler,n=t.detailsHandler,o=t.screenShareImpl,s=t.constants,r=i.getWmsPushData(e),c=r.type,t=r.chatid,r=i.getCallStatusByChid(t);try{var d={chid:t,media_id:e,isDirectCall:r[e].isdirectcall},l={action:s.end,success_cbk:null,failure_cbk:null,extraData:{}};i.setApiData(e,l),i.makeApiCall(e),a.updateCallInvitationState(s.audio,d,s.ended),n.triggerIconCheck(t),this.clearData(e),n.removeAudioPlayers(),o.handleAudioCallEnd(t),this.container.detailsHandler.handleCallEnded({type:c,chid:t})}catch(e){}},e.prototype.endOngoingCall=function(e,t,i){try{var a=this.container,n=a.dataHandler,o=a.mediaUIHandler,s=a.commonImpl,r=a.screenShareImpl,c=a.detailsHandler,d=a.constants,l=n.get(e+"_peer");if(r.handleAudioCallEnd(e),l)for(var p in l){var u=l[p],h=u.type,m=u.mid;o.updateCallInvitationState(h,{chid:e,media_id:m},d.ended);var _={action:d.end,success_cbk:i,failure_cbk:null,extraData:{}};s.setApiData(m,_),s.makeApiCall(m),this.clearData(m),delete l[p]}else{var f={action:d.end,success_cbk:i,failure_cbk:null,extraData:{}};s.setApiData(t,f),s.makeApiCall(t),this.clearData(t)}s.stopNotificationSound(),s.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_SOUND_STOP,add_info:c.getMediaActivityAddInfo()},mid:t}),s.removeActiveCallData(e)}catch(e){}},e.prototype.endFailedCall=function(e){var t=this.container,i=t.dataHandler,a=t.mediaUIHandler,n=t.commonImpl,o=t.constants,s=n.getWmsPushData(e),t=s.chatid,s=s.type;try{var r=i.get(t+"_peer");n.updateFailedTimeForMediaStats({failedTime:Date.now(),isreconnected:!1,mediaid:e}),n.getFailedStatsDetail(e),n.makeApiCall(e),a.updateCallInvitationState(s,{chid:t,media_id:e},o.failed),this.clearData(e),delete r[e]}catch(e){}},e.prototype.__handleUIAccept=function(t){var o=this,e=this.container,s=e.commonImpl,r=e.detailsHandler,i=e.mediaUIHandler,a=e.MediaPermission,n=e.dataHandler,c=e.constants,d=e.MediaDetails,e=s.getWmsPushData(t),l=e.chatid,p=(e.mediaInvitation,s.getActiveCallData()),u=s.getCallStatusByChid(p),h=s.getCallStatusByChid(l);if(r.isOldUI()&&r.focusChatWindow(l),p&&p!=l){function m(e){var t=u[e],i=t.type,a=t.callStatus,n=t.isdirectcall,t=t.host,i=i+"Impl";a==c.connected?o.container[i].endOngoingCall(p,e,function(){return n&&r.endSession(p)}):a!=c.ringing&&a!=c.connecting||(t==c.upstream?o.container[i].handleUICancel(e):o.container[i].handleUIReject(e),s.removeActiveCallData())}for(var _ in u)m(_)}var f=function(){clearTimeout(y)},y=setTimeout(function(){f=i.mediaPermissionUI()},3e3);a.getAudioStream(function(){f(),s.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_MIC_PERMISSION_ALLOWED},mid:t});var e=s.getCallStatusData(t);e?e.callStatus=c.connecting:e={callStatus:c.connecting},s.setCallStatusData(t,e),s.updateCallStatus(t),s.setActiveCallData(l);e={};r.isoldUI&&(e.is_old_ui=r.isoldUI),e.perfect_renegotiation=d.getClientSupport().perfect_renegotiation,e.session_id=r.getSessionID();e={action:c.accept,success_cbk:null,failure_cbk:null,extraData:e};s.setApiData(t,e),s.makeApiCall(t),i.updateCallInvitationState(c.audio,{chid:l,media_id:t,muteCbk:function(){return o.toggleMute()},rejectCbk:function(){return h[t].host==c.upstream?o.handleUICancel(t):o.handleUIReject(t)}},c.connecting);e=c.WAITING_TIME;n.set(t+"_connecting_timer",setTimeout(function(){var e={action:c.end,success_cbk:null,failure_cbk:null,extraData:{}};s.setApiData(t,e),s.makeApiCall(t),o.clearData(t),i.updateCallInvitationState(c.audio,{chid:l,media_id:t},c.ended),s.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_INVITATION_CLEARED,add_info:r.getMediaActivityAddInfo()},mid:t})},e))},this.onDownStreamMediaPermissionFailure({chatid:l,id:t,cbk:f})),s.removeIncomingRequestData({id:t,chatid:l}),s.setActiveTab(),s.stopNotificationSound(),s.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_SOUND_STOP,add_info:r.getMediaActivityAddInfo()},mid:t})},e.prototype.handleUIAccept=function(e){var t=this,i=this.container,a=i.detailsHandler,n=i.mediaUIHandler,o=i.commonImpl,s=o.getWmsPushData(e),r=s.type,i=s.chatid,s=o.getActiveCallData();this.isWaitingForPermission||(o.isSmartFlow(e)&&a.isEmbed()&&a.showEmbedBanner("av.info.recording.disclaimer",5e3,i),o.updateMediaCache(b.siq_unifiedMedia,b.status,b.accept),s&&s!=i?n.handleCallClash(function(){return t.__handleUIAccept(e)},function(){return t.handleUIReject(e)}):this.__handleUIAccept(e),n={type:r,acceptedTime:Date.now(),callerType:1,reconnectCount:0,mediaid:e},o.setMediaStatsDetail(n),a.handleIncomingAccept({type:r,chid:i}))},e.prototype.handleUICancel=function(e){var t=this.container,i=t.detailsHandler,a=t.mediaUIHandler,n=t.commonImpl,o=t.dataHandler,s=t.constants,r=n.getWmsPushData(e),t=r.type,r=r.chatid;a.updateCallInvitationState(t,{chid:r,media_id:e},s.cancelled);a={};i.isOldUI()&&(a.is_old_ui=i.isOldUI());a={action:s.cancel,success_cbk:null,failure_cbk:null,extraData:a};n.setApiData(e,a),n.makeApiCall(e),n.removeMediaCache(b.siq_unifiedMedia),this.clearData(e),i.handleCallCancelled({type:t,chid:r}),clearTimeout(this.timeout[e]),clearTimeout(o.get(e+"_waiting_timer")),clearTimeout(o.get(e+"_connecting_timer")),o.remove(e+"_waiting_timer"),i.clearPlayer()&&n.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:e});i="siqMedia - cancel trigger from UI | chid :"+r+" | mediaid : "+e+" | curUserId : "+i.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,i)},e.prototype.toggleMute=function(){this.container.MediaPermission.toggleMute()},e.prototype.startVisitorAudioCall=function(e){var t=this.container.constants,t={chatid:e,mode:t.visitor,mediarequest:!0,mediainvitation:!0,type:t.audio};this.startAudioCall(t)},e.prototype.handleCallMissed=function(t){var i=this.container,a=i.detailsHandler,e=i.mediaUIHandler,n=i.constants,o=i.commonImpl,s=o.getWmsPushData(t),i=s.chatid,s=s.processType;try{delete this.iconClicked[i];var r={chid:i,media_id:t};if(clearTimeout(this.timeout[t]),e.updateCallInvitationState(n.audio,r,n.missed),s&&s==n.negotiation)return;o.removeMediaCache(b.siq_unifiedMedia),this.clearData(t),a.handleCallMissed({type:n.audio,chid:i})}catch(e){a="siqMedia - call missed  | chid :"+i+" | mediaid : "+t+" | curUserId : "+a.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,a)}},e.prototype.acceptAudioCallForDsk=function(e){var t=this.container,i=t.commonImpl,a=t.mediaUIHandler,t=i.getMediaDataByChidAndType({chatid:e,type:this.audio}).id;clearTimeout(this.timeout[t]);e={chatid:e,id:t,type:this.type,mediaInvitation:!0};i.setWmsPushData(t,e),this.handleUIAccept(t),a.clearAudioCallInvite(this.audio,t)},e.prototype.rejectAudioCallForDsk=function(e){var t=this.container,i=t.commonImpl,a=t.mediaUIHandler,t=i.getMediaDataByChidAndType({chatid:e,type:this.audio}).id;clearTimeout(this.timeout[t]);e={chatid:e,id:t,type:this.type};i.setWmsPushData(t,e),this.handleUIReject(t),a.clearAudioCallInvite(this.audio,t)},e.prototype.hasIncommingCall=function(e){var t,i=this.container,a=i.commonImpl,n=i.constants,o=a.getActiveCallData(),s=a.getCallStatusByChid(e);for(t in s){var r=s[t];if(r.type==n.audio&&r.callType==n.incoming&&r.callStatus==n.ringing||o==e)return!0}return!1},e.prototype.handleCallRequestSuccesCbk=function(e){e.mid,e.chid},e.prototype.initCallRequest=function(e){var t=e.mid,i=e.negotiationType,a=e.chid,n=this.container,o=n.commonImpl,e=n.dataHandler,s=n.constants,r=n.mediaUIHandler,c=n.screenShareImpl,n=n.detailsHandler,d={negotiation_type:i,process_type:s.negotiation};n.isOldUI()&&(d.is_old_ui=n.isOldUI());e.set(t+"_connecting_timer",setTimeout(function(){var e={action:s.miss,success_cbk:null,failure_cbk:null,extraData:d};o.setApiData(t,e),o.makeApiCall(t);e=r.getUIState().states[a];e&&e.screen_share&&e.screen_share.type!=s.sharing&&!o.getSwapRequestCallbackState()?(r.updateCallInvitationState(s.screenshare,{chid:a,media_id:t},s.requestMissed),r.deleteScreenShareState(a)):o.getSwapRequestCallbackState()&&c.handlingRequestStateOnSwap(a,t,s.requestMissed)},s.WAITING_TIME));e={action:s.request,success_cbk:null,failure_cbk:null,extraData:d};o.setApiData(t,e),o.makeApiCall(t)},e.prototype.addScreenShareTrack=function(e){var t=e.chid,i=e.id,e=this.container,a=e.commonImpl,n=e.screenShareImpl,o=e.MediaPermission,s=e.mediaUIHandler,r=e.constants,e=a.getCallStatusByChid(t),c=Object.keys(e)[0],d=a.getPeerObject(i);o.getScreenShareStream(function(){d.addScreenTrackInConnection()||n.handleInitReNegotiation(i),a.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_RENEGOTIATION_TRACKADDED}});var e=s.getUIState().states[t];e.screen_share=e.screen_share||{};e=function(){return n.handleUIEnd(c)};s.makeScreenShareConnected(r.screen_share,{chid:t,media_id:c,callEndCbk:e,ss_type:r.sharing}),o.screenEndFromBrowserUI(e),a.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED},mid:c})},function(){a.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_BLOCKED},mid:c})})},e.prototype.handleAudioCallEnd=function(e){var t=this.container,i=t.mediaUIHandler,a=t.MediaPermission,n=t.commonImpl,o=t.detailsHandler,s=t.constants,r=n.getWmsPushData(e).chatid,t=n.getCallStatusByChid(r);a.closeStreamByType(s.audio),i.clearAudioCallInvite(s.audio,e);t={chid:r,media_id:e,isDirectCall:!(!t||!t[e])&&t[e].isdirectcall};i.updateCallInvitationState(s.audio,t,s.ended),i.stopTimer(r),i.clearAllStates(r),o.clearAudioUI(),o.clearPlayer()&&n.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:e}),o.clearPopup()&&n.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:e})},e.prototype.isCallAllowed=function(e){for(var t=this.container,i=t.dataHandler,a=t.detailsHandler,t=t.constants,n=i.get(t.media_inv),o=0;n&&n.length>o;o++)if(n[o][e=a.isembed?a.getChatWinObjById(e,!0).RCHID:e])return!1;return!0},e.prototype.handleInitReNegotiation=function(e){var t=this.container,i=t.commonImpl,a=t.constants;this.reinit=!0;t={process_type:a.reinit,negotiation_type:a.audio},t={action:a.request,success_cbk:null,failure_cbk:null,extraData:t};i.setApiData(e,t),i.makeApiCall(e)},e.prototype.changeAudioPlayer=function(e,t){var i=document.querySelector("#remoteaudio");void 0!==i.sinkId&&(this.setAudioOutputDevice(e),i.setSinkId(e),this.container.commonImpl.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_OUTPUT_DEVICE_CHANGED}}))},e.prototype.changeAudioInputDevice=function(e,t,i){var a=this,n=this.container,o=n.MediaPermission,n=n.commonImpl,t=n.getActiveMediaID(t),s=n.getPeerObject(t);s&&s.removeAudioTrackInConnection(),o.updatePreferredDeviceByDeviceId(e,"audioInput"),o.getAudioStream(function(){s.audioRenegotiation(),i&&a.toggleMute(),a.setAudioIputDevice(e),a.container.commonImpl.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_INPUT_DEVICE_CHANGED}})},function(){})},e.prototype.setAudioIputDevice=function(e){localStorage.setItem("siqmedia_audio_input_device",R(e))},e.prototype.setAudioOutputDevice=function(e){localStorage.setItem("siqmedia_audio_output_device",R(e))},e.prototype.getAudioInputDevice=function(){return D(localStorage.getItem("siqmedia_audio_input_device"))},e.prototype.getAudioOutputDevice=function(){return D(localStorage.getItem("siqmedia_audio_output_device"))};function d(e){e.videoImpl=this}d.prototype.handleInvitation=function(){},d.prototype.handleCallAccept=function(){},d.prototype.handleCallReject=function(){},d.prototype.handleCandidates=function(){},d.prototype.handleCallAnswer=function(){},d.prototype.handleCallEnd=function(){},d.prototype.handleCallOffer=function(){},d.prototype.handleCallCancel=function(){},d.prototype.handleCallCancel=function(){},d.prototype.handleCallInvite=function(){};var l=function(e){e.screenShareImpl=this,e.screen_viewImpl=this,e.screen_share_smartImpl=this,(e.screen_view_smartImpl=this).container=e,this.timeout={},this.init(),this.reinit=!1,this.removeTrackOnReNegotiation=!1};l.prototype.setCredential=function(e){this.container.commonImpl.setCredential(e)},l.prototype.handleInvitation=function(i){var a=this,e=this.container,n=e.commonImpl,t=e.mediaUIHandler,o=e.MediaPermission,s=e.detailsHandler,r=e.MediaDetails,c=e.constants,d=n.getWmsPushData(i),l=d.chatid,p=d.type,u=d.perfectReNegotiation,h=d.mediaInvitation,m=d.mediaRequest;n.endCallFromSameChat(i),s.isEmbed()&&s.clearBusyUI();function _(e){void 0===e&&(e=!0),clearTimeout(a.timeout[i]),e?a.handleUIAccept(i):a.handleUIReject(i);try{var t={type:p,acceptedTime:Date.now(),callerType:1,reconnectCount:0,mediaid:i};n.setMediaStatsDetail(t)}catch(e){}}function f(){return _(!1)}e={chid:l,media_id:i,rejectCbk:f,acceptCbk:_},d={};if(s.isOldUI()&&(d.is_old_ui=s.isOldUI()),n.checkIncomingCallAllowed(i)){d={action:c.reject,success_cbk:null,failure_cbk:null,extraData:d};return n.setApiData(i,d),n.makeApiCall(i),!0}if(n.setScreenShareRequestData(l),n.setCredential(i),h){t.handleAudioCallInvite(c.screen_share,e);e={chid:l,type:p,media_id:i,status:b.incoming};n.setMediaCache(b.siq_unifiedMedia,e);e={callType:c.incoming,callStatus:c.ringing,mediarequest:m,host:c.downstream,isdirectcall:!1,isPerfectRenegotiation:u,type:p};n.setCallStatusData(i,e),n.setCallStatus(i),this.timeout[i]=setTimeout(f,65e3)}else{var y={perfect_renegotiation:r.getClientSupport().perfect_renegotiation,session_id:getSid()},r={chid:l,type:p,media_id:i,status:b.accept};n.setMediaCache(b.siq_unifiedMedia,r);u={callType:c.incoming,callStatus:c.connecting,mediarequest:m,host:c.downstream,isdirectcall:!1,isPerfectRenegotiation:u,type:p};n.setCallStatusData(i,u),n.setCallStatus(i),m?o.getScreenShareStream(function(){var e;n.isScreenRequestPending(l)&&(e={action:c.accept,success_cbk:null,failure_cbk:null,extraData:y},n.setApiData(i,e),n.makeApiCall(i),o.screenEndFromBrowserUI(function(){return a.handleUIEnd(i)}),n.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED},mid:i}))},this.onMediaPermissionFailure(i)):(n.setActiveCallData(l),setTimeout(function(){var e={action:c.accept,success_cbk:null,failure_cbk:null,extraData:y};n.setApiData(i,e),n.makeApiCall(i)},2e3)),n.setActiveTab(),s.triggerIconCheck(l);try{var g={type:p,acceptedTime:Date.now(),callerType:1,reconnectCount:0,mediaid:i};n.setMediaStatsDetail(g)}catch(e){}}s.handleIncomingCall({type:p,chid:l})},l.prototype.handleAcceptSuccessCbk=function(e){var t=this.container,i=t.dataHandler,a=t.constants,n=t.commonImpl.getWmsPushData(e).chatid,o=n+"_peer",t=i.get(o)||{},a={id:e,chatid:n,type:a.screen_share,iceRestart:!1,isUpStream:!0,mediaRequest:!0};t[e]=new C(a,this.container),i.set(o,t)},l.prototype.handleCallAccept=function(t){var i=this,e=this.container,a=e.dataHandler,n=e.commonImpl,o=e.constants,s=e.mediaUIHandler,r=e.detailsHandler,c=n.getWmsPushData(t),d=c.chatid,l=c.type,p=c.processType,u=c.perfectReNegotiation;if(p&&p==o.negotiation)return n.clearConnectingTimer(t),n.clearMissedCallTimeout(t),s.deleteScreenShareState(d),void n.deleteSwapRequestCallbackState();e=d+"_peer",p=a.get(e)||{};c.isUpStream=!0,c.iceRestart=!1,l==o.screen_share&&(p[t]=new C(c,this.container),a.set(e,p)),clearTimeout(a.get(t+"_waiting_timer")),a.remove(t+"_waiting_timer");var h={};r.isOldUI()&&(h.is_old_ui=r.isOldUI());r={chid:d,media_id:t,muteCbk:function(){},rejectCbk:function(){var e={action:o.cancel,success_cbk:null,failure_cbk:null,extraData:h};n.setApiData(t,e),n.makeApiCall(t),s.updateCallInvitationState(l,{chid:d,media_id:t},o.cancelled),i.clearData(t)}};try{var m={type:l,acceptedTime:Date.now(),callerType:0,reconnectCount:0,mediaid:t};n.setMediaStatsDetail(m)}catch(e){}m=n.getCallStatusData(t);m?(m.callStatus=o.connecting,m.isPerfectRenegotiation=u):m={callStatus:o.connecting,isPerfectRenegotiation:u},n.setCallStatusData(t,m),n.updateCallStatus(t),s.updateCallInvitationState(o.screen_share,r,o.connecting)},l.prototype.handleCallReject=function(e){var t=this.container,i=t.detailsHandler,a=t.mediaUIHandler,n=t.constants,o=t.commonImpl,s=o.getWmsPushData(e),r=s.chatid,t=s.type,s=s.processType;if(s&&s==n.negotiation)return o.getSwapRequestCallbackState()?this.handlingRequestStateOnSwap(r,e,n.requestRejected):a.getUIState().states[r][n.screen_share].status==n.requested&&a.updateCallInvitationState(n.screen_share,{chid:r,media_id:e},n.rejected),o.clearMissedCallTimeout(e),void o.clearConnectingTimer(e);a.updateCallInvitationState(n.screen_share,{chid:r,media_id:e},n.rejected),this.clearData(e),o.removeMediaCache(b.siq_unifiedMedia),i.handleCallRejected({type:t,chid:r})},l.prototype.handleCandidates=function(e){var t=this.container,i=t.dataHandler,a=t.commonImpl,n=a.getWmsPushData(e),o=n.chatid,t=i.get(o+"_peer")[e];t||((t={})[e]=new C(n,this.container),i.set(o+"_peer",t),t=t[e],a.setRemotePerfectReNegotiation(t,e,o)),t.setIceCandidates(n)},l.prototype.handleCallAnswer=function(e){var t=this.container,i=t.commonImpl,a=t.dataHandler,n=i.getWmsPushData(e),o=n.chatid,t=n.session,i=n.tracksId,n=n.negotiationType,e=a.get(o+"_peer")[e];e.remoteTracksId=i?JSON.parse(i):null,e.negotiationType=n||null,e.setAnswerRemoteDesription(t)},l.prototype.handleCallEnd=function(e){var t=this.container,i=t.mediaUIHandler,a=t.detailsHandler,n=t.audioImpl,o=t.commonImpl,s=t.constants,r=o.getWmsPushData(e),c=r.type,d=r.chatid,t=r.negotiationType,r=r.processType;e==o.getActiveMediaID(d)&&(t!=b.screen_share||r!=b.negotiation?(i.updateCallInvitationState(c,{chid:d,media_id:e},s.ended),i.deleteScreenShareState(d),i.deletePlayer(d),a.clearPlayer()&&o.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:a.getMediaActivityAddInfo()},mid:e}),a.clearPopup()&&o.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:a.getMediaActivityAddInfo()},mid:e}),n.handleAudioCallEnd(e),this.clearData(e),o.removeMediaCache(b.siq_unifiedMedia),a.handleCallEnded({type:c,chid:d})):this.handleStopScreenShare(e))},l.prototype.handleCallOffer=function(e){var t=this.container,i=t.dataHandler,a=t.constants,n=t.MediaPermission,o=t.commonImpl,s=o.getWmsPushData(e),r=s.chatid,c=s.session,d=s.tracksId,l=s.negotiationType,t=i.get(r+"_peer")||{};n.getStreamByType(a.screen_share)&&l==a.screen_share&&!this.reinit&&i.set(a.isAlreadySharing,!0),s.isUpStream=!1,s.iceRestart=!1;a=t[e];t[e]||(t[e]=new C(s,this.container),i.set(r+"_peer",t),a=t[e]),a.remoteTracksId=d?JSON.parse(d):null,a.negotiationType=l||null,o.setRemotePerfectReNegotiation(a,e,r);try{this.reinit?(a.handleScreenShareRenegotiation(c,this.removeTrackOnReNegotiation),this.removeTrackOnReNegotiation=!1):a.setOfferRemoteDescription(c),this.reinit=!1}catch(e){}},l.prototype.handleCallCancel=function(e){var t=this.container,i=t.commonImpl,a=t.mediaUIHandler,n=t.detailsHandler,o=t.constants,s=i.getWmsPushData(e),r=s.chatid,c=s.type,t=s.processType,s={chid:r,media_id:e};i.deleteScreenShareRequestData(r),i.removeCredential(e),n.isEmbed()&&n.clearConformBox()&&i.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:e}),clearTimeout(this.timeout[e]),t&&t==o.negotiation||(a.updateCallInvitationState(o.screen_share,s,o.cancelled),i.removeCredential(e),this.clearData(e),e="siqMedia: call cancel request received  | chid :"+r+" | mediaid : "+e+" | curUserId : "+n.getCurrentUserId(),this.callBackAction(this.implConstants.postDebugLog,e),i.removeMediaCache(b.siq_unifiedMedia),n.handleCallCancelled({type:c,chid:r}))},l.prototype.handleCallFailed=function(e){var t=this.container,i=t.commonImpl,a=t.mediaUIHandler,n=t.detailsHandler,o=t.constants,s=i.getWmsPushData(e),r=s.chatid,t=s.type,i=s.processType,s={chid:r,media_id:e};clearTimeout(this.timeout[e]),i&&i==o.negotiation||(a.updateCallInvitationState(o.screen_share,s,o.failed),this.clearData(e),n.handleCallFailed({type:t,chid:r}))},l.prototype.handleUIReject=function(e){var t=this.container,i=t.mediaUIHandler,a=t.commonImpl,n=t.detailsHandler,o=t.constants,s=a.getWmsPushData(e),r=s.chatid,t=s.type,s={};n.isOldUI()&&(s.is_old_ui=n.isOldUI()),i.updateCallInvitationState(t,{chid:r,mid:e},o.rejected);s={action:o.reject,success_cbk:null,failure_cbk:null,extraData:s};a.setApiData(e,s),a.makeApiCall(e),this.clearData(e),a.removeMediaCache(b.siq_unifiedMedia);e=" reject trigger from UI | chid :"+r+" | mediaid : "+e+" | curUserId : "+n.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,e),n.handleCallRejected({type:t,chid:r})},l.prototype.__handleUIAccept=function(t){var i=this,e=this.container,a=e.commonImpl,n=e.mediaUIHandler,o=e.MediaPermission,s=e.constants,r=e.MediaDetails,c=e.detailsHandler,e=a.getWmsPushData(t),d=e.chatid,l=e.type,p=(e.mediaInvitation,a.getActiveCallData()),u=a.getCallStatusByChid(p),h=a.getCallStatusByChid(d);if(p&&p!=d)for(var m in u){var _=u[m],f=_.callStatus,y=_.host;c.isOldUI()&&c.isOldUI(),f==s.connected?this.endOngoingCall(p,m):f==s.ringing?(_={action:y==s.upstream?s.cancel:s.reject,success_cbk:null,failure_cbk:null,extraData:{}},a.setApiData(m,_),s.upstream,a.makeApiCall(m),a.removeActiveCallData()):f==s.connecting&&(y={action:y==s.upstream?s.cancel:s.reject,success_cbk:null,failure_cbk:null,extraData:{}},a.setApiData(m,y),s.upstream,a.makeApiCall(m),a.removeActiveCallData())}var g={perfect_renegotiation:r.getClientSupport().perfect_renegotiation,session_id:getSid()};a.getCallStatusByChid(d)[t].mediarequest?l==b.screen_share_smart||l==b.screen_view_smart?(a.setActiveCallData(d),a.deleteScreenShareRequestData(d),this.__makeCallAccept(t),this.addScreenTrackInConference({type:l})):o.getScreenShareStream(function(){var e=a.getCallStatusByChid(d);e&&e[t]&&a.isScreenRequestPending(d)?(a.deleteScreenShareRequestData(d),(e=a.getCallStatusData(t))?e.callStatus=s.connecting:e={callStatus:s.connecting},a.setCallStatusData(t,e),a.updateCallStatus(t),a.setActiveCallData(d),e={action:s.accept,success_cbk:function(){i.handleAcceptSuccessCbk(t)},failure_cbk:null,extraData:g},a.setApiData(t,e),a.makeApiCall(t),e={},c.isOldUI()&&(e.is_old_ui=c.isOldUI()),e={action:h[t].host==s.upstream?s.cancel:s.reject,success_cbk:null,failure_cbk:null,extraData:e},a.setApiData(t,e),n.updateCallInvitationState(l,{chid:d,media_id:t,muteCbk:function(){return i.toggleMute()},rejectCbk:function(){return h[t].host,s.upstream,a.makeApiCall(t)}},s.connecting),o.screenEndFromBrowserUI(function(){return i.handleUIEnd(t)}),a.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED},mid:t})):o.closeStreamByType(s.screen_share)},this.onMediaPermissionFailure(d,t)):(r={action:s.accept,success_cbk:null,failure_cbk:null,extraData:g},a.setApiData(t,r),a.makeApiCall(t)),a.removeIncomingRequestData({id:t,chatid:d}),a.setActiveTab()},l.prototype.handleUIAccept=function(e){var t=this,i=this.container,a=i.mediaUIHandler,n=i.commonImpl,o=i.detailsHandler,i=n.getWmsPushData(e).chatid,n=n.getActiveCallData();n&&n!=i?a.handleCallClash(function(){return t.__handleUIAccept(e)},function(){return t.handleUIReject(e)}):this.__handleUIAccept(e),o.triggerIconCheck(i)},l.prototype.startScreenShare=function(e){try{var t,i=this.container,a=i.detailsHandler,n=i.MediaPermission,o=i.commonImpl,s=i.MediaDetails,r=i.constants,c=e.mediarequest,d=e.chatid,l=e.mode,p=e.id,u=!0,h=c?b.screen_view:b.screen_share;if(e.perfect_renegotiation=s.getClientSupport().perfect_renegotiation,l==r.visitor){if(a.checkIsSSOnGoing(d,h))return;u=this.isScreenShareAllowed(e,h)}u?c?this.initRequest(this.onMediaPermissionSuccess(e)):n.getScreenShareStream(this.onMediaPermissionSuccess(e),this.onMediaPermissionFailure(d,p,!0)):(t="To start Siq Screen Share  - permission checks failed | chid - "+d+" ",this.callBackAction(this.implConstants.postDebugLog,t)),o.setActiveTab()}catch(e){}},l.prototype.initRequest=function(e){e()},l.prototype.onMediaPermissionSuccess=function(e){var t=this,i=this.container,a=i.commonImpl,n=i.ajaxHandler,o=i.MediaPermission,s=i.constants,r=(e.mediarequest,e.chatid),i=e.mode,i=(e.id,e.type,i||s.visitor),c=this.constructResponeObj(e),d=a.constructURL(null,null);return a.setActiveCallData(r),function(){if(!t.checkOngoingCall(r))return o.closeStreamByType(s.screen_share),delete t.iconClicked[r],function(){};a.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED}}),n.post(d,c,t.onstarted.bind(t),t.startCallFailure.bind(t),!0,!1,"v3")}},l.prototype.onMediaPermissionFailure=function(d,l,p){var u=this;return void 0===p&&(p=!1),function(e,t){try{var i,a=u.container,n=a.commonImpl,o=a.mediaUIHandler,s=a.detailsHandler,r=a.constants,c={};s.isOldUI()&&(c.is_old_ui=s.isOldUI()),p||(i={action:r.reject,success_cbk:null,failure_cbk:null,extraData:c},n.setApiData(l,i),n.makeApiCall(l),o.updateCallInvitationState(r.screen_share,{chid:d,media_id:l},r.rejected),u.clearData(l),s.triggerIconCheck(d)),n.getActiveCallData()&&n.getActiveCallData()==d&&!n.getCallStatusByChid(d)&&(n.removeActiveCallData(),n.removeActiveTab()),n.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_BLOCKED}})}catch(e){}}},l.prototype.constructResponeObj=function(e){return Object.assign({},{type:"screen_share"},e)},l.prototype.onstarted=function(e){var t=this,i=this.container,a=i.commonImpl,n=i.mediaUIHandler,o=i.dataHandler,s=i.MediaPermission,r=i.detailsHandler,c=i.constants,d=D(e.msg||e.data.msg).media?D(D(e.msg||e.data.msg).media):D(e.msg||e.data.msg),l=d.chatid,p=d.id,u=d.type,i=d.mediaRequest,e=d.chid;l||(d.chatid=l=l||e),a.setWmsPushData(p,d);o.set(p+"_waiting_timer",setTimeout(function(){var e={};r.isOldUI()&&(e.is_old_ui=r.isOldUI());e={action:c.miss,success_cbk:null,failure_cbk:null,extraData:e};a.setApiData(p,e),a.makeApiCall(p),n.updateCallInvitationState(u,{chid:l,media_id:p},c.missed),t.clearData(p),a.removeMediaCache(b.siq_unifiedMedia),r.handleCallMissed({type:u,chid:l})},6e4));o={chid:l,type:u,media_id:p,status:b.outgoing};a.setMediaCache(b.siq_unifiedMedia,o);o={callType:c.outgoing,callStatus:c.ringing,mediarequest:i,host:c.upstream,isdirectcall:!1,isPerfectRenegotiation:!1,type:u};a.setCallStatusData(p,o),a.setCallStatus(p);o=function(){return t.handleUICancel(p)},o={chid:l,media_id:p,rejectCbk:o,cancelCbk:o,muteCbk:function(){},initiated:!0};u==c.screen_share||u==c.screen_share_smart?n.makeScreenShareConnecting(u,o):n.showScreenShareMaking(u,o),i||s.screenEndFromBrowserUI(function(){return t.handleUIEnd(p)}),r.triggerIconCheck(l),r.handleCallInitiate({type:u,chid:l})},l.prototype.startCallFailure=function(){},l.prototype.addRemoteStream=function(e,t){var i=this;try{t.type;var a=t.mid,n=t.chid,o=t.negotiationType,s=this.container,r=s.constants,c=s.mediaUIHandler,d=s.dataHandler,l=(s.MediaPermission,e.stream);if(e.streams&&(l=e.streams[0]),o==r.audio)return;function p(){i.handleUIEnd(a)}if(d.get(r.isAlreadySharing)&&(d.set(r.isAlreadySharing,!1),setTimeout(function(){i.handleStopScreenShare(a)},2e3)),c.getUIState().states&&c.getUIState().states[n]&&c.getUIState().states[n].screen_share&&c.getUIState().states[n].screen_share.type==r.sharing)return;c.updateCallInvitationState(r.screen_share,{chid:n,id:a,callEndCbk:p},r.connected),c.playScreenShareStream({stream:l,chid:n,mid:a,endCbk:p})}catch(e){}},l.prototype.clearData=function(e){try{var t=this.container,i=t.commonImpl,a=t.dataHandler,n=t.constants,o=t.detailsHandler,s=i.getWmsPushData(e);if(!s)return;s.type;var r=s.chatid;this.closePeerConn(e),i.removeCredential(e),i.checkAVIcon(r),i.clearCallDetails(r,e),i.clearConnectingTimer(e),i.clearMissedCallTimeout(e),clearTimeout(this.timeout[e]),a.remove(n.isAlreadySharing),i.getActiveCallData()&&i.getActiveCallData()==r&&!i.getCallStatusByChid(r)&&i.removeActiveCallData(),i.removeIncomingRequestData({id:e,chatid:r}),o.isEmbed()&&o.checkIsChatEndTimerAlive(r)||i.stopNotificationSound(),i.checkAndPlayNotification(),i.deleteScreenShareRequestData(r),i.clearConnectedStatsDetail(e),i.removeMediaCallDetails(e),i.removeMediaCache(b.siq_unifiedMedia),i.getCallStatusByChid(r)||i.removeActiveTab()}catch(e){}},l.prototype.closePeerConn=function(e){var t=this.container,i=t.commonImpl,a=t.dataHandler,n=i.getWmsPushData(e),t=n.chatid,n=n.type;try{var o=a.get(t+"_peer");if(!o)return void this.clearMediaPermision(n);var s=o[e];i.clearNetworkTimer(s),s.closeConnection(),delete o[e],this.clearMediaPermision(n)}catch(e){}},l.prototype.clearMediaPermision=function(e){"audio_unified_mix"==e?e="audio":"screen_share_smart"!=e&&"screen_view_smart"!=e||(e="screen_share"),this.container.MediaPermission.closeStreamByType(e)},l.prototype.handleUIEnd=function(e){var t=this.container,i=t.mediaUIHandler,a=t.detailsHandler,n=t.commonImpl,o=t.constants,s=n.getWmsPushData(e),r=s.type,t=s.chatid,s=n.getPeerObject(e);s.curr_connection.audio&&s.audioRtpSenders||i.getUIState().states[t].audio?i.getUIState().states[t].screen_share.type==b.viewing?this.endViewingScreenShare(e):this.handleStopScreenShare(e):(s={action:o.end,success_cbk:null,failure_cbk:null,extraData:{}},n.setApiData(e,s),n.makeApiCall(e),i.updateCallInvitationState(r,{chid:t,media_id:e},o.ended),a.clearPlayer()&&n.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:a.getMediaActivityAddInfo()},mid:e}),this.clearData(e),n.removeMediaCache(b.siq_unifiedMedia),a.handleCallEnded({type:r,chid:t}))},l.prototype.callConnected=function(e){this.screenShareConnectedUI(e)},l.prototype.screenShareConnectedUI=function(e){var t=this,i=this.container,a=i.commonImpl,n=i.mediaUIHandler,o=i.constants,s=e.chid,r=(e.type,e.mid),c=e.isUpStream,i=e.isReconnecting,e=a.getCallStatusByChid(s)[r].mediarequest,e={chid:s,isViewing:c&&e||!c&&!e,media_id:r,ss_type:n.getCurrentScreenshareType(s),muteCbk:function(){return function(){}},callEndCbk:function(){return t.handleUIEnd(r)}};a.updateMediaCache(b.siq_unifiedMedia,b.status,b.connected);s=a.getCallStatusData(r);s?s.callStatus=o.connected:s={callStatus:o.connected},a.setCallStatusData(r,s),a.updateCallStatus(r),n.updateCallInvitationState(o.screen_share,e,o.connected),a.updateMediaStatsDetail({connectedTime:Date.now(),isreconnected:i,mediaid:r}),a.getConnectedStatsDetail(r),a.makeApiCall(r)},l.prototype.callBackAction=function(e,t){({postDebugLog:this.postDebugLog.bind(this)})[e](t)},l.prototype.init=function(){this.implConstants={postDebugLog:"postDebugLog"}},l.prototype.postDebugLog=function(e){this.container.detailsHandler.sendDebugLogger(e,null,null,!0)},l.prototype.handleUICancel=function(e){var t=this.container,i=t.commonImpl,a=t.mediaUIHandler,n=t.detailsHandler,o=t.constants,s=i.getWmsPushData(e),t=s.type,s=s.chatid;a.updateCallInvitationState(o.screen_share,{type:t,chid:s,media_id:e},o.cancelled);a={};n.isOldUI()&&(a.is_old_ui=n.isOldUI());a={action:o.cancel,success_cbk:null,failure_cbk:null,extraData:a};i.setApiData(e,a),i.makeApiCall(e),this.clearData(e),i.removeMediaCache(b.siq_unifiedMedia),n.handleCallCancelled({type:t,chid:s})},l.prototype.handleUIRequestCancel=function(e,t,i){var a=this.container,n=a.commonImpl,o=a.mediaUIHandler,s=a.detailsHandler,r=a.constants,a=(a.dataHandler,{type:e,chid:t,media_id:i});n.getSwapRequestCallbackState()?this.handlingRequestStateOnSwap(t,i,r.requestCancelled):o.updateCallInvitationState(r.screen_share,a,r.cancelled);a={process_type:r.negotiation,negotiation_type:e};s.isOldUI()&&(a.is_old_ui=s.isOldUI());a={action:r.cancel,success_cbk:null,failure_cbk:null,extraData:a};n.setApiData(i,a),n.makeApiCall(i),n.clearConnectingTimer(i),n.clearMissedCallTimeout(i),s.handleCallCancelled({type:e,chid:t})},l.prototype.handlingRequestStateOnSwap=function(e,t,i){var a=this.container,n=a.commonImpl,o=a.mediaUIHandler,s=a.constants,a={chid:e,id:t};o.updateCallInvitationState(s.screen_share,{chid:e,status:i,media_id:t},i),this.setSharingState(a),n.deleteSwapRequestCallbackState()},l.prototype.swapScreenShare=function(e,t){var i=this,a=this.container,n=a.audioImpl,o=a.MediaPermission,s=a.constants,r=a.mediaUIHandler,a=a.commonImpl,c=e.id,d=e.chatid||e.chid;a.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_SWAP},mid:c}),o.getStreamByType(s.screen_share)?((r=r.getUIState().states[d])&&r.screen_share&&r.screen_share.type==s.sharing&&(a.setSwapRequestCallbackState(),r.screen_share.type=s.viewing,r.screen_share.status=s.requested,r.screen_share.reject_cbk=function(){return i.handleUIRequestCancel(s.screen_share,d,c)}),n.initCallRequest({chid:d,mid:c,negotiationType:s.screen_share})):n.addScreenShareTrack({id:c,chid:d})},l.prototype.getScreenShareType=function(e,t){try{var i=this.container,a=i.commonImpl,n=i.constants,o=a.getCallStatusByChid(e),s=o&&o[t],r=a.getPeerObject(t);if(!o||!s)return-1;if(r&&r.curr_connection&&r.curr_connection.audio)return-1;var c=s.mediarequest,d=s.host==n.upstream;if(d&&c)return 1;if(d&&!c)return 0;if(!d&&c)return 0;if(!d&&!c)return 1}catch(e){}},l.prototype.endOngoingCall=function(e,t,i){var a=this.container,n=a.dataHandler,o=a.mediaUIHandler,s=a.commonImpl,r=a.audioImpl,c=a.constants,d=n.get(e+"_peer");if(r.handleAudioCallEnd(t),d)for(var l in d){var p=d[l],u=p.mid,p=p.type;o.updateCallInvitationState(p,{chid:e,media_id:u},c.ended);p={action:c.end,success_cbk:i,failure_cbk:null,extraData:{}};s.setApiData(u,p),s.makeApiCall(u),this.clearData(l),delete d[l]}else{r={action:c.end,success_cbk:i,failure_cbk:null,extraData:{}};s.setApiData(t,r),s.makeApiCall(t),this.clearData(t)}s.stopNotificationSound(),s.removeActiveCallData(e)},l.prototype.endFailedCall=function(e){try{var t=this.container,i=t.dataHandler,a=t.mediaUIHandler,n=t.commonImpl,o=t.constants,s=(t.detailsHandler,n.getWmsPushData(e)),r=s.chatid,c=s.type,d=i.get(r+"_peer");n.updateFailedTimeForMediaStats({failedTime:Date.now(),isreconnected:!1,mediaid:e}),n.getFailedStatsDetail(e),n.makeApiCall(e),a.updateCallInvitationState(c,{chid:r,media_id:e},o.failed),this.clearData(e),delete d[e]}catch(e){}},l.prototype.isScreenShareSupported=function(){},l.prototype.handleCallRequest=function(e){var t=this,i=this.container,a=i.mediaUIHandler,n=i.constants,o=i.MediaPermission,s=i.commonImpl,r=i.dataHandler,c=s.getWmsPushData(e),d=c.chatid,i=(c.type,c.processType);c.negotiationType;if(i&&i==n.reinit)return o.getStreamByType(n.screen_share)&&r.set(n.isAlreadySharing,!0),void s.getPeerObject(e).screenShareRenegotiation();a.showScreenShareInvitation({chid:d,media_id:e,acceptCbk:function(){t.container.MediaPermission.getScreenShareStream(function(){t.handleUiRequestAccept(e),t.setSharingState({id:e,chid:d}),o.screenEndFromBrowserUI(function(){return t.handleUIEnd(e)}),s.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED},mid:e})},function(){t.handleUiRequestReject(e),s.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_BLOCKED},mid:e})})},rejectCbk:function(){t.handleUiRequestReject(e)}})},l.prototype.setSharingState=function(e){var t=this,i=e.chid,a=e.id,n=this.container,o=n.constants,e=n.mediaUIHandler,s=n.screenShareImpl,n=n.commonImpl.getWmsPushData(a),r=n.negotiationType,c=n.type,i=e.getUIState().states[i];i.screen_share=i.screen_share||{},i.screen_share.type=o.sharing,i.screen_share.status=o.connected;i.screen_share.reject_cbk=function(){r==b.screen_share_smart||c==b.screen_share_smart?t.handleUnifiedCallEnd(a):s.handleUIEnd(a)}},l.prototype.handleUiRequestAccept=function(e){var t=this.container,i=t.commonImpl,a=t.constants,n=i.getWmsPushData(e).negotiationType,t={process_type:a.negotiation,negotiation_type:n},t={action:a.accept,success_cbk:n==b.screen_share_smart?this.handleUiSmartRequestAcceptSuccessCBK(e):this.handleUiRequestAcceptSuccessCbk(e),failure_cbk:null,extraData:t};i.setApiData(e,t),i.makeApiCall(e)},l.prototype.handleUiRequestAcceptSuccessCbk=function(e){var t=this.container,i=t.dataHandler,a=t.commonImpl,t=a.getWmsPushData(e).chatid;i.get(t+"_peer")[e].addScreenTrackInConnection()||this.handleInitReNegotiation(e),a.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_RENEGOTIATION_TRACKADDED}})},l.prototype.handleUiRequestReject=function(e){var t=this.container,i=t.commonImpl,a=t.constants,t=i.getWmsPushData(e).negotiationType,t={process_type:a.negotiation,negotiation_type:t},t={action:a.reject,success_cbk:null,failure_cbk:null,extraData:t};i.setApiData(e,t),i.makeApiCall(e)},l.prototype.handleStopScreenShare=function(e){var t=this.container,i=t.commonImpl,a=t.mediaUIHandler,n=t.detailsHandler,t=(t.constants,i.getWmsPushData(e).chatid);i.getPeerObject(e).removeScreenTrackInConnection()||(this.removeTrackOnReNegotiation=!0,this.handleInitReNegotiation(e)),i.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_RENEGOTIATION_TRACKREMOVED},mid:e}),a.deleteScreenShareState(t),a.deletePlayer(t),n.clearPlayer()&&i.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:e})},l.prototype.handleCallMissed=function(e){var t=this.container,i=t.mediaUIHandler,a=t.detailsHandler,n=t.commonImpl,o=t.constants,s=n.getWmsPushData(e),r=s.type,t=s.processType,s=s.chatid,i=i.getUIState().states[s];i&&i.screen_share&&i.screen_share.type!=o.viewing&&uiHandler.deleteScreenShareState(s),a.isEmbed()&&a.clearConformBox()&&n.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:a.getMediaActivityAddInfo()}}),n.deleteScreenShareRequestData(s),t&&t==o.negotiation||(this.clearData(e),n.removeMediaCache(b.siq_unifiedMedia),a.handleCallMissed({type:r,chid:s}))},l.prototype.handleAudioCallEnd=function(e){var t=this.container,i=t.mediaUIHandler,a=t.MediaPermission,n=t.detailsHandler,o=t.commonImpl,t=t.constants;a.closeStreamByType(t.screen_share),n.isEmbed()&&n.clearConformBox()&&o.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:n.getMediaActivityAddInfo()}}),i.deleteScreenShareState(e),i.deletePlayer(e),n.clearPlayer()&&o.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:n.getMediaActivityAddInfo()}}),n.clearPopup()&&o.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:n.getMediaActivityAddInfo()}})},l.prototype.checkOngoingCall=function(e){for(var t=this.container,i=t.dataHandler,a=t.detailsHandler,t=t.constants,n=i.get(t.media_inv),o=0;n&&n.length>o;o++)if(n[o][e=a.isembed?a.getChatWinObjById(e,!0).RCHID:e])return!1;return!0},l.prototype.handleInitReNegotiation=function(e){var t=this.container,i=t.commonImpl,a=t.constants;this.reinit=!0;t={process_type:a.reinit,negotiation_type:a.screen_share},t={action:a.request,success_cbk:null,failure_cbk:null,extraData:t};i.setApiData(e,t),i.makeApiCall(e)},l.prototype.endViewingScreenShare=function(e){var t=this.container,i=t.commonImpl,a=t.constants,t={process_type:a.negotiation,negotiation_type:a.screen_share},t={action:a.end,success_cbk:null,failure_cbk:null,extraData:t};i.setApiData(e,t),i.makeApiCall(e)};var p=function(e){((this.container=e).commonImpl=this).reloadCheck=!1};p.prototype.setCredential=function(e){var t=this.getWmsPushData(e),i=t.id,a=t.type,e=t.credentials,t=t.chatid;this.container.dataHandler.set(i+"_credential",{mid:i,credential:e,chid:t,type:a}),this.container.dataHandler.set(i+"_nextTurnServer",b.TURN_URL[0])},p.prototype.removeCredential=function(e){this.container.dataHandler.remove(e+"_credential"),this.container.dataHandler.remove(e+"_nextTurnServer")},p.prototype.constructURL=function(e,t){var i="media",a=this.getVersion(t);return"v2"==a&&e?i+="/"+t+"/"+e:"v3"==a&&(i=t?i+"/"+t:i),i},p.prototype.setActiveCallData=function(e){this.container.dataHandler.set("active_call",e,!0)},p.prototype.getActiveCallData=function(){return this.container.dataHandler.get("active_call",!0)},p.prototype.removeActiveCallData=function(){this.container.dataHandler.remove("active_call",!0)},p.prototype.setCallStatus=function(e){var t,i=this.getCallStatusData(e),a=i.callType,n=i.callStatus,o=i.mediarequest,s=i.host,r=i.isdirectcall,c=i.isPerfectRenegotiation,i=this.getWmsPushData(e),i=r&&s==b.downstream?(t=i.chid,D(i.media[0]).type):(t=i.chatid,i.datamode||i.type),r={id:e,type:i,host:s,callType:a,callStatus:n,mediarequest:o,isdirectcall:r,isPerfectRenegotiation:c,chid:t},c=this.getCallStatusByChid(t)||{};c[e]=r,this.container.dataHandler.set(t+"_call_status",c,!0)},p.prototype.getCallStatusByChid=function(e){return this.container.dataHandler.get(e+"_call_status",!0)},p.prototype.getAcitveMediaTypes=function(){var e=this.container.dataHandler.get("active_call",!0),e=this.getCallStatusByChid(e);return e?Object.values(e).map(function(e){return e.type}):[]},p.prototype.updateCallStatus=function(e){var t=this.container.dataHandler,i=this.getWmsPushData(e).chatid,a=this.getCallStatusData(e),n=a.callStatus,o=a.isPerfectRenegotiation,a=t.get(i+"_call_status",!0);a&&a[e]&&(a[e].callStatus=n,a[e].isPerfectRenegotiation=o),t.set(i+"_call_status",a,!0)},p.prototype.checkAVIcon=function(e){var t=this.container,i=t.dataHandler,t=t.mediaUIHandler;i.get("active_call",!0)==e&&t.enableOutingCallUI()},p.prototype.callFailed=function(e,t){var i=this.container.dataHandler.get(e+"_peer")[t].type;this.setWmsPushData(t,{type:i,chatid:e,id:t}),this.container[i+"Impl"].endFailedCall(t)},p.prototype.checkNetwork=function(t,i,e){var a=this;void 0===e&&(e=!1);var n=this.container,o=n.dataHandler,n=n.mediaUIHandler,s=o.get(t+"_peer")[i],r=s.type,c="undefined"==typeof _MEDIASERVERURL?_MEDIASTATICURL:_MEDIASERVERURL;s.reconnectInterval=setTimeout(function(){var e=document.createElement("IMG");e.src=c+"/images/spacer.gif?nocache="+(new Date).getTime(),e.onload=function(){s.iceRestart=!0,s.isUpStream&&s.createOffer(),a.updateAcceptedTimeForMediaStats(Date.now(),i)},e.onerror=function(){return a.checkNetwork(t,i,!0)}},5e3),s.reconnectEndTimer||(s.reconnectEndTimer=setTimeout(function(){a.container[r+"Impl"].endOngoingCall(t,i),clearTimeout(s.reconnectInterval),s.reconnectEndTimer=null},3e4)),e||n.updateCallInvitationState(r,{chid:t,media_id:i},"reconnecting")},p.prototype.clearNetworkTimer=function(e){clearTimeout(e.reconnectEndTimer),clearTimeout(e.reconnectInterval)},p.prototype.clearCallDetails=function(e,t){var i=this.container.dataHandler,a=i.get(e+"_call_status",!0);delete a[t],0<Object.keys(a).length?i.set(e+"_call_status",a,!0):i.remove(e+"_call_status",!0),i.remove(t+"_credential")},p.prototype.updateCommonData=function(){},p.prototype.getCommonData=function(){},p.prototype.makeApiCall=function(e){var t=this.getApiData(e),i=t.action,a=t.success_cbk,n=(t.failure_cbk,t.extraData),o=Object.assign({},n),s=this.container,t=(s.detailsHandler,s.ajaxHandler),n=s.constants,s=this.constructURL(i,e);"v3"==this.getVersion(e)&&-1!=[n.cancel,n.restart,n.miss,n.reject,n.request,n.end,n.accept,n.invite,n.offer,n.answer,n.candidates,n.connected].indexOf(i)?(o.action=i,t.put(s,o,a,null,!0,"v3")):t.post(s,o,a)},p.prototype.updateIncomingRequestData=function(e){var t=this.container,i=t.dataHandler,a=t.constants,n={},o=this.getWmsPushData(e),s=o.chatid,r=o.type,t=o.negotiationType,o=i.get(a.media_inv)||[];n[s]={id:e,type:t||r},o.push(n),i.set(a.media_inv,o,!0)},p.prototype.removeIncomingRequestData=function(e){var t,i=e.id,a=e.chatid,n=this.container,e=n.dataHandler,n=n.constants,o=e.get(n.media_inv,!0);for(t in o){var s=o[t],r=Object.keys(s)[0],s=s[r].id;r==a&&s==i&&o.splice(t,1)}o&&(0==o.length?this.deleteIncomingRequestKey():e.set(n.media_inv,o,!0))},p.prototype.getIncomingRequest=function(){var e=this.container,t=e.dataHandler,e=e.constants;return t.get(e.media_inv,!0)},p.prototype.deleteIncomingRequestKey=function(){var e=this.container,t=e.dataHandler,e=e.constants;t.remove(e.media_inv,!0)},p.prototype.getMediaDataByChidAndType=function(e){var t,i=e.chatid,a=e.type,n=this.getCallStatusByChid(i);for(t in n){var o=n[t];if(o.type==a)return o}return null},p.prototype.endCallByChid=function(d,l){var p=this;try{function e(e){var t=f[e],i=t.id,a=t.type,n=t.callStatus,o=t.isdirectcall,s=t.callType,r=p.container[a+"Impl"],c={type:a,chid:d,media_id:i},e={};u.isOldUI()&&(e.is_old_ui=u.isOldUI()),n==_.connected?(a==_.audio_unified_mix?p.endOngoingUnifiedCall(i,d,l):r.endOngoingCall(d,i,l||function(){return o&&u.endSession(d)}),h.updateCallInvitationState(a,c,_.ended)):n!=_.connected&&s==_.incoming?(p.clearConnectingTimer(i),t={action:_.reject,success_cbk:l,failure_cbk:null,extraData:e},p.setApiData(i,t),o||p.makeApiCall(i),h.updateCallInvitationState(a,c,_.rejected),o&&r.handleUIApiReject(i)):n!=_.connected&&s==_.outgoing&&(clearTimeout(m.get(i+"_waiting_timer")),e={action:_.cancel,success_cbk:l,failure_cbk:null,extraData:e},p.setApiData(i,e),p.makeApiCall(i),h.updateCallInvitationState(a,c,_.cancelled)),r.clearData(i)}var t,i=this.container,u=i.detailsHandler,h=i.mediaUIHandler,m=i.dataHandler,_=i.constants,f=this.getCallStatusByChid(d);for(t in f)e(t)}catch(e){}},p.prototype.checkOnGoingCall=function(){try{this.checkAndClearDataOnRefresh()}catch(e){}},p.prototype.checkAndClearDataOnRefresh=function(){var t=this;Object.keys(localStorage).forEach(function(e){return e.match(/SiqMedia_/g)&&t.container.dataHandler.remove(e.replace("SiqMedia_",""),!0)})},p.prototype.setActiveTab=function(){var e=this.container,t=e.dataHandler,e=e.constants;t.set(e.media_active,!0)},p.prototype.getActiveTab=function(){var e=this.container,t=e.dataHandler,e=e.constants;return t.get(e.media_active)||!1},p.prototype.removeActiveTab=function(){var e=this.container,t=e.dataHandler,e=e.constants;t.remove(e.media_active)},p.prototype.currentUserBrowserSupportSS=function(){var e=this.container.MediaDetails,t=e.getPlatform();return!!/linux|Microsoft Windows|Mac OS|MacIntel|Win32|Win64/i.test(t)&&e.checkBrowserSupported(b.screen_share)},p.prototype.checkIncomingCallAllowed=function(e){var t=this.container,i=t.constants,a=t.dataHandler,t=this.getWmsPushData(e),n=t.chatid,e=t.type,t=t.negotiationType;if(this.getMediaDataByChidAndType({chatid:n,type:t||e}))for(var o=a.get(n+"_peer"),s=o&&Object.keys(o).length||0,r=0;r<s;r++)return o[Object.keys(o)[r]].connectionStatus!=i.connected?(this.endCallByChid(n),!1):!0;return!1},p.prototype.setMediaStatsDetail=function(e){var t=e.acceptedTime,i=e.type,a=e.mediaid,n=e.reconnectCount,e=e.callerType;this.container.dataHandler.set(a+"_connectionstats",{acceptedTime:t,type:i,mediaid:a,reconnectCount:n,callerType:e})},p.prototype.updateMediaStatsDetail=function(e){var t=e.connectedTime,i=e.isreconnected,a=e.mediaid,n=this.container.dataHandler,e=n.get(a+"_connectionstats");e.connectedTime=t,e.reconnectCount=i?e.reconnectCount+1:e.reconnectCount,n.set(a+"_connectionstats",e)},p.prototype.updateAcceptedTimeForMediaStats=function(e,t){var i=this.container.dataHandler,a=i.get(t+"_connectionstats");a&&(a.acceptedTime=e,i.set(t+"_connectionstats",a))},p.prototype.updateFailedTimeForMediaStats=function(e){var t=e.failedTime,i=e.isreconnected,a=e.mediaid,n=this.container.dataHandler,e=n.get(a+"_connectionstats");e.failedTime=t,e.reconnectCount=i?e.reconnectCount+1:e.reconnectCount,n.set(a+"_connectionstats",e)},p.prototype.getConnectedStatsDetail=function(e){var t=this.container,i=t.dataHandler,t=(t.detailsHandler,t.constants),i=i.get(e+"_connectionstats"),i={latency:i.connectedTime-i.acceptedTime,reconcount:i.reconnectCount,callerType:i.callerType},i={action:t.connected,success_cbk:null,failure_cbk:null,extraData:i};this.setApiData(e,i)},p.prototype.getFailedStatsDetail=function(e){var t=this.container,i=t.dataHandler,t=(t.detailsHandler,t.constants),i=i.get(e+"_connectionstats"),i={latency:i.failedTime-i.acceptedTime,reconcount:i.reconnectCount,callerType:i.callerType},i={action:t.failed,success_cbk:null,failure_cbk:null,extraData:i};this.setApiData(e,i)},p.prototype.clearConnectedStatsDetail=function(e){this.container.dataHandler.remove(e+"_connectionstats")},p.prototype.getPeerObject=function(e){var t=this.container.dataHandler,i=this.getWmsPushData(e).chatid;try{return t.get(i+"_peer")[e]||null}catch(e){return null}},p.prototype.handleScreenTrackEnd=function(){var e=this.container,t=e.detailsHandler,i=e.mediaUIHandler,a=e.MediaPermission,n=e.screenShareImpl,o=e.constants,e=this.getActiveCallData(),s=this.getActiveMediaID(e);i.deleteScreenShareState(e),i.deletePlayer(e),t.clearPlayer()&&this.sendMediaActivity({param:{action_type:o.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:t.getMediaActivityAddInfo()},mid:s}),a.getStreamByType(o.screen_share)&&i.updateCallInvitationState(o.screen_share,{chid:e,id:s,callEndCbk:function(){n.handleUIEnd(s)},ss_type:o.sharing},o.connected)},p.prototype.getActiveMediaID=function(e){e=this.getCallStatusByChid(e);return e?Object.keys(e)[0]:""},p.prototype.setScreenShareRequestData=function(e){this.container.dataHandler.set(e+"_screenRequest",!0)},p.prototype.deleteScreenShareRequestData=function(e){this.container.dataHandler.remove(e+"_screenRequest")},p.prototype.isScreenRequestPending=function(e){return!!this.container.dataHandler.get(e+"_screenRequest")},p.prototype.setCallUIPosition=function(e,t){this.container.dataHandler.set("callUIposition",{top:e,left:t})},p.prototype.getCallUIPosition=function(){return this.container.dataHandler.get("callUIposition")},p.prototype.removeCallUIPosition=function(){this.container.dataHandler.remove("callUIposition")},p.prototype.clearMissedCallTimeout=function(e){var t=this.container.dataHandler;clearTimeout(t.get(e+"_waiting_timer")),t.remove(e+"_waiting_timer")},p.prototype.setSwapRequestCallbackState=function(){this.container.dataHandler.set("isScreenShareOngoing",!0)},p.prototype.getSwapRequestCallbackState=function(){return this.container.dataHandler.get("isScreenShareOngoing")},p.prototype.deleteSwapRequestCallbackState=function(){this.container.dataHandler.remove("isScreenShareOngoing")},p.prototype.clearConnectingTimer=function(e){var t=this.container.dataHandler;clearTimeout(t.get(e+"_connecting_timer")),t.remove(e+"_connecting_timer")},p.prototype.onGoingMediaType=function(e){var t={audio:!1,screenshare:!1},e=this.container.mediaUIHandler.getUIState().states[e];return e&&e.audio?t.audio=!0:t.audio,e&&e.screen_share?t.screenshare=!0:t.screenshare,t},p.prototype.setRemotePerfectReNegotiation=function(e,t,i){i=this.getCallStatusByChid(i);null!=i[t].isPerfectRenegotiation&&(e.remotePerfectRenegotiation=i[t].isPerfectRenegotiation)},p.prototype.endCallFromSameChat=function(e){var t=this.container.constants,i=this.getWmsPushData(e).chatid,a=this.getCallStatusByChid(i);if(a&&a[this.getActiveMediaID(i)].id!=e)for(var n in a){var o=a[n],s=o.type,o=o.callStatus,s=s+"Impl";o==t.connected?this.container[s].endOngoingCall(i,n):o!=t.ringing&&o!=t.connecting||(a[n].host==t.upstream?this.container[s].handleUICancel(n):this.container[s].handleUIReject(n),this.removeActiveCallData())}},p.prototype.sendMediaActivity=function(e){var t=e.param,i=e.mid,a=this.container,n=a.ajaxHandler,e=a.detailsHandler,a=this.getActiveCallData(),a=this.getActiveMediaID(a)||i,i="stats/"+a+"/media/activity";e.isEmbed()&&(t.vwmsid=e.getVisitorWMSID()),a&&n.post(i,t,function(){},function(){},!0,!1,"v2")},p.prototype.checkCallHostType=function(e){var t=e.chid,i=e.mid,e=e.hostType,t=this.getCallStatusByChid(t);return!(!t||!t[i]||t[i].host!=e)},p.prototype.isInvitationPending=function(){var e=this.getIncomingRequest();return!!(e&&0<e.length)},p.prototype.sendRTCNetworkStats=function(e,t){var i=this.container,a=i.ajaxHandler,n=i.detailsHandler,i="stats/"+e+"/media/nrs",e={};n.isEmbed()&&(e.vwmsid=n.getVisitorWMSID()),e.networkstats=t,a.post(i,e,function(){},function(){},!0,!1)},p.prototype.sendRTCConnectionStats=function(e,t){var i=this.container,a=i.ajaxHandler,n=i.detailsHandler,i="stats/"+e+"/media/nrs",e={};n.isEmbed()&&(e.vwmsid=n.getVisitorWMSID()),e.stats=t,a.post(i,e,function(){},function(){},!0,!1)},p.prototype.pushVoiceMessage=function(e){var t=this.container,i=t.ajaxHandler,t=t.detailsHandler,t={action:b.voicemessage,wmsid:t.getVisitorWMSID()},e=this.constructURL(b.voicemessage,e);i.put(e,t,function(){},function(){},!0,"v3")},p.prototype.setMediaCallDetails=function(e){var t=this.container,i=t.constants,t=t.dataHandler;e&&t.set(i.mediaCallDetails,e)},p.prototype.updateMediaCallDetails=function(e,t,i){var a=this.getMediaCallDetails();a&&0<Object.keys(a).length?a[e]||(a[e]={}):(a={})[e]={},a[e][t]=i,this.setMediaCallDetails(a)},p.prototype.setWmsPushData=function(e,t){this.updateMediaCallDetails(e,b.mediaDetailsKeys.wmsPushData,t)},p.prototype.setApiData=function(e,t){this.updateMediaCallDetails(e,b.mediaDetailsKeys.apiData,t)},p.prototype.setCallStatusData=function(e,t){this.updateMediaCallDetails(e,b.mediaDetailsKeys.callStatus,t)},p.prototype.getMediaCallDetails=function(){var e=this.container,t=e.constants;return e.dataHandler.get(t.mediaCallDetails)},p.prototype.getWmsPushData=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].wmsPushData},p.prototype.getApiData=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].apiData},p.prototype.getCallStatusData=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].callStatus},p.prototype.removeMediaCallDetails=function(e){var t=this.getMediaCallDetails();t&&t[e]&&(delete t[e],this.setMediaCallDetails(t))},p.prototype.setIsCallInitiatedFromOldUI=function(e,t){this.updateMediaCallDetails(t,b.mediaDetailsKeys.isCallInitiatedFromOldUI,e)},p.prototype.getIsCallInitiatedFromOldUI=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].isCallInitiatedFromOldUI},p.prototype.setIsMobileOperator=function(e,t){this.updateMediaCallDetails(t,b.mediaDetailsKeys.isMobileOperator,e)},p.prototype.getIsMobileOperator=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].isMobileOperator},p.prototype.stopNotificationSound=function(){this.container.detailsHandler.stopNotifSound()},p.prototype.playMediaNotificationSound=function(e){this.container.detailsHandler.playNotifSound(e)},p.prototype.getVersion=function(e){return"v3"},p.prototype.getType=function(e){var t=this.container.constants;return-1!=[t.audio_unified_mix,t.audio_smart].indexOf(e)?t.audio:-1!=[t.screen_share_smart,t.screen_view_smart,t.screen_view].indexOf(e)?t.screen_share:e},p.prototype.setMediaCache=function(e,t){localStorage.setItem(e,R(t))},p.prototype.getMediaCache=function(e){e=localStorage.getItem(e);return e=e&&JSON.parse(e)},p.prototype.updateMediaCache=function(e,t,i){var a=this.getMediaCache(e);a&&(a[t]=i,localStorage.setItem(e,JSON.stringify(a)))},p.prototype.removeMediaCache=function(e){localStorage.removeItem(e)},p.prototype.handleMediaOnRefresh=function(e){var t=e.media_id,i=e.status,a=this.container.detailsHandler,e={};a.isOldUI()&&(e.is_old_ui=a.isOldUI());e={success_cbk:function(){},failure_cbk:function(){},extraData:e};i==b.connected?e.action=b.end:i==b.accept||i==b.outgoing?e.action=b.cancel:i==b.incoming&&(e.action=b.reject),this.setApiData(t,e),this.makeApiCall(t)};var e=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.setUnifiedCredential=function(e){this.container.commonImpl.setCredential(e)},t.prototype.__initUnifiedConnection=function(e){var t=this.container.commonImpl,i=new r(e,this.container);return t.setUnifiedPeerObj({peerObj:i,data:e}),i},t.prototype.handleUnifiedCallCredentail=function(e){var t=this.container.commonImpl.getWmsPushData(e);this.setUnifiedCredential(e),t.isUpStream=!0,this.__initUnifiedConnection(t),t.audio_offer&&this.handleUnifiedCallOffer(e),this.__createDataChannelCon(e)},t.prototype.__createDataChannelCon=function(e){e=this.container.commonImpl.getWmsPushData(e);e.type=b.data_channel,e.isDataChannel=!0,e.isUpStream=!0,e.datatype=b.data_channel,this.__initUnifiedConnection(e)},t.prototype.handleUnifiedCallAnswer=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),a=i.getWmsPushData(e),n=(a.chid,a.session),o=a.tracksId,s=a.negotiationType,r=(a.candidates,a.type),t=a.datatype,r=i.getUnifiedPeerObjByStreamType({id:e,type:t||r,streamType:b.upstream});r.remoteTracksId=o?D(o):null,r.negotiationType=s||null,r.setAnswerRemoteDesription(n),r.setIceCandidatesArray(a),r.sendCandidates()},t.prototype.handleUnifiedCallOffer=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),a=i.getWmsPushData(e),n=(a.chid,a.session),o=a.tracksId,s=a.negotiationType,r=(a.candidates,a.type),c=a.credentials,d=a.datatype,t=a.audio_offer;c&&this.setUnifiedCredential(e),t&&(n=a.audio_offer,a.candidates=a.audio_candidate,a.type="audio_unified_mix");r=i.getUnifiedPeerObjByStreamType({id:e,type:d||r,streamType:b.downstream});r||(a.isUpStream=!1,r=this.__initUnifiedConnection(a),this.__initUpStreamUnifiedConnection(a)),r.remoteTracksId=o?D(o):null,r.negotiationType=s||null,r.setOfferRemoteDescription(n),r.setIceCandidatesArray(a),i.setUserTrackDetails(a)},t.prototype.__getTypeFromDataMode=function(e){"video"==e&&"audio_conference"==data.type&&(data="video_conference")},t.prototype.__initUpStreamUnifiedConnection=function(e){var t=this.container.commonImpl,i=(e.chid,e.id),a=e.type;t.getUnifiedPeerObjByStreamType({id:i,type:a,streamType:b.upstream})||(e.isUpStream=!0,this.__initUnifiedConnection(e),this.__createDataChannelCon(i))},t.prototype.addAudioCallInConnection=function(){var i=this;this.container.MediaPermission.getAudioStream(function(){var e=i.container.commonImpl,t=e.getActiveCallData(),e=e.getActiveMediaID(t);i.__initUnifiedConnection({id:e,chid:t,isUpStream:!0,type:"audio_unified_mix",mediaRequest:!0})},function(){})},t.prototype.handleUnifiedInvitation=function(e){var t=this.container,i=t.commonImpl,a=t.MediaPermission,n=i.getWmsPushData(e),t=(n.chatid,n.chid);n.mode,n.type,n.mediaRequest,n.isOldUI,n.perfectReNegotiation;a.getAudioStream(null,null);a={action:"accept"};a.session_id=getSid(),this.container.commonImpl.makeUnifiedCallAccept({dataval:a,id:e}),i.setActiveCallData(t),i.setActiveTab()},t.prototype.unifiedcallConnected=function(e){e.chid;var t=e.type,i=e.mid,a=(e.isReconnecting,e.isUpStream),n=this.container,o=n.commonImpl,s=n.constants,e=n.dataHandler,n=o.getCallStatusData(i);n.host==s.downstream&&(n?n.callStatus=b.connected:n={callStatus:b.connected},o.setCallStatusData(i,n),o.updateCallStatus(i),o.updateMediaCache(b.siq_unifiedMedia,b.status,b.connected),this.__updatecallConnectedUi(i)),o.sendUnifiedConnected({mid:i,isUpStream:a,type:t}),clearTimeout(e.get(i+"_connecting_timer")),e.remove(i+"_connecting_timer")},t.prototype.sendUnifiedCandidates=function(e){this.container.commonImpl.sendUnifiedCandidates(e)},t.prototype.sendUnifiedOffer=function(e){this.container.commonImpl.sendUnifiedOffer(e)},t.prototype.sendUnifiedAnswer=function(e){this.container.commonImpl.sendUnifiedAnswer(e)},t.prototype.notifyUser=function(e){var t=e.mid,i=e.type,a=this.container.commonImpl,n=a.getCallStatusData(t),e=n.type;n.host==b.upstream&&e==i&&(i={action:b.invite,mediainvitation:!0},a.inviteUser({dataval:i,id:t}))},t.prototype.handleCallAnswerReceived=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),a=(i.getWmsPushData(e),i.getWmsPushData(e)),t=(a.chid,a.session,a.tracksId,a.negotiationType,a.candidates,a.type),a=a.datatype;i.getUnifiedPeerObjByStreamType({id:e,type:a||t,streamType:b.downstream}).sendCandidates()},t.prototype.handleUnifiedCallAccept=function(e){var t,i=this,a=this.container,n=a.dataHandler,o=a.constants,s=a.commonImpl,r=a.mediaUIHandler,c=a.detailsHandler,d=s.getWmsPushData(e),l=d.chatid,p=d.type,a=d.processType,d=d.negotiationType;clearTimeout(n.get(e+"_waiting_timer")),n.remove(e+"_waiting_timer"),c.isEmbed()&&c.showEmbedBanner("av.info.recording.disclaimer",5e3,l),c.handleOutgoingAccept({type:p,chid:l}),a&&a==b.negotiation&&d==b.audio_unified_mix?this.addAudioCallInConnection():((t=s.getCallStatusData(e))?t.callStatus=o.connecting:t={callStatus:o.connecting},s.setCallStatusData(e,t),s.updateCallStatus(e),l={chid:l,media_id:e,isDirectCall:t.isdirectcall,muteCbk:function(){return i.toggleMute()},rejectCbk:function(){return t.host==o.upstream?i.handleUICancel(e):i.handleUIReject(e)}},s.updateMediaCache(b.siq_directcall,b.status,b.accept),r.updateCallInvitationState(o.audio_unified_mix,l,o.connecting),s.stopNotificationSound())},t.prototype.handleUnifiedCallConnected=function(e){var t=this.container,i=t.dataHandler,a=t.commonImpl,t=a.getCallStatusData(e);t?t.callStatus=b.connected:t={callStatus:b.connected},a.setCallStatusData(e,t),a.updateCallStatus(e),a.updateMediaCache(b.siq_unifiedMedia,b.status,b.connected),this.__updatecallConnectedUi(e),clearTimeout(i.get(e+"_waiting_timer")),clearTimeout(i.get(e+"_connecting_timer")),i.remove(e+"_waiting_timer")},t.prototype.__updatecallConnectedUi=function(e){var t=this,i=this.container,a=(i.dataHandler,i.commonImpl),n=i.mediaUIHandler,o=i.constants,s=a.getWmsPushData(e),i=(s.chatid,s.chid),a=(s.mode,s.type,s.mediaRequest,s.isOldUI,s.perfectReNegotiation,a.getCallStatusByChid(i)[e].isdirectcall);n.updateCallInvitationState(o.audio,{chid:i,id:e,callEndCbk:a?function(){t.handleUIApiCallEnd(e)}:function(){t.closeAllPeerConn(e),t.handleUIEnd(e)}},o.connected)},t.prototype.closeAllPeerConn=function(t){var e=[b.screen_view_smart,b.screen_share_smart,b.audio_unified_mix,b.audio_smart,b.data_channel],i=this;e.forEach(function(e){i.container.commonImpl.closeUnifiedPeerConnByType({id:t,type:e})})},t.prototype.handleUnifiedCallEnd=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),a=t.mediaUIHandler,n=t.screen_shareImpl,o=t.detailsHandler,s=i.getWmsPushData(e),r=(s.chatid,s.chid),t=(s.mode,s.type,s.mediaRequest,s.isOldUI,s.perfectReNegotiation,i.getCallStatusByChid(r)[e]),s={chid:r,media_id:e,isDirectCall:t.isdirectcall};a.updateCallInvitationState(b.audio,s,b.ended),t.isdirectcall&&i.removeMediaCache(b.siq_directcall),i.removeMediaCache(b.siq_unifiedMedia),n.handleUnifiedCallEnd(e),this.clearData(e),o.handleCallEnded({type:b.audio,chid:r})},t.prototype.updateMuteState=function(e){var t=e.id,i=e.state,a=this.container.commonImpl,e=a.getActiveCallData(),t=a.getActiveMediaID(e)||t;a.sendUnifiedState({id:t,dataval:{action:"state",audio:{mute:i}}})},t.prototype.addUnifiedRemoteStream=function(e,t){var i=this.container,a=i.detailsHandler,n=i.commonImpl,o=(i.mediaUIHandler,i.constants),s=t.chid,r=t.mid,i=t.type,t=t.negotiationType;n.getCallStatusByChid(s)[r].isdirectcall;try{var c,d="",l=e.stream;i!=this.audio&&t!=this.audio&&i!=o.audio_unified_mix||(d=this.addUnifiedAudioPlayer()),e.streams&&(l=e.streams[0]);try{d.srcObject=l,this.getAudioOutputDevice()&&!a.isOldUI()&&(c=this.getAudioOutputDevice(),this.changeAudioPlayer(c,s))}catch(e){d.src=window.URL.createObjectURL(l)}}catch(e){a="siqMedia: adding remote stream  | chid :"+s+" | mediaid : "+r+" | lsuid : "+a.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,a)}},t.prototype.addUnifiedAudioPlayer=function(){try{document.querySelector("#remoteaudio");var e=document.createElement("audio");return e.id="remoteaudio",e.className="siqmediaaudioplayer",e.autoplay=!0,document.querySelector("body").appendChild(e),e}catch(e){}},t.prototype.changeUnifiedAudioInputDevice=function(e,t,i){var a=this,n=this.container,o=n.MediaPermission,s=n.commonImpl,r=s.getUnifiedPeerObjByStreamType({id:t,type:b.audio_unified_mix,streamType:b.upstream});r&&r.removeAudioTrackInConnection(),o.updatePreferredDeviceByDeviceId(e,"audioInput"),o.getAudioStream(function(){r.audioRenegotiation(),i&&a.toggleMute(),a.setAudioIputDevice(e),s.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_INPUT_DEVICE_CHANGED}})},function(){})},t.prototype.changeUnifiedAudioPlayer=function(e,t){var i=document.getElementsByClassName("siqmediaaudioplayer"),a=i.length;if(0<a){this.setAudioOutputDevice(e);for(var n=0;n<a;n++)void 0!==i[n].sinkId&&i[n].setSinkId(e);this.container.commonImpl.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_OUTPUT_DEVICE_CHANGED}})}},t}(e),l=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.handleUnifiedCallCredentail=function(e){var t=this.container.commonImpl.getWmsPushData(e);this.setUnifiedCredential(e),t.isUpStream=!0,t.type==b.screen_share_smart?this.__initUnifiedConnection(t):this.notifyUser({mid:t.id,type:b.screen_view_smart}),t.audio_offer&&this.handleUnifiedCallOffer(e)},t.prototype.__makeCallAccept=function(e){var t={action:"accept"};t.session_id=getSid(),this.container.commonImpl.makeUnifiedCallAccept({dataval:t,id:e})},t.prototype.setUnifiedCredential=function(e){this.container.commonImpl.getWmsPushData(e);this.container.commonImpl.setCredential(e)},t.prototype.__initUnifiedConnection=function(e){var t=this.container.commonImpl,i=new r(e,this.container);return e.type==b.screen_view_smart&&(e.type=b.screen_share_smart),t.setUnifiedPeerObj({peerObj:i,data:e}),i},t.prototype.addScreenTrackInConference=function(){var n=this,e=this.container,o=e.MediaPermission,s=e.mediaUIHandler,r=e.detailsHandler;o.getScreenShareStream(function(){function e(){return n.handleUiunifiedEnd(a)}var t=n.container.commonImpl,i=t.getActiveCallData(),a=t.getActiveMediaID(i),t=s.getUIState().states[i];t&&t.screen_share?n.__endUnifiedSreenShare(a):(t=null,t=r.isEmbed()?r.getVisitorWMSID():r.getCurrentUserId(),t={id:a,chid:i,isUpStream:!0,type:b.screen_share_smart,mediaRequest:!1,creatorid:t},n.__initUnifiedConnection(t),s.makeScreenShareConnected(b.screen_share,{chid:i,media_id:a,callEndCbk:e,ss_type:b.sharing}),o.screenEndFromBrowserUI(e))},function(){})},t.prototype.sendUnifiedOffer=function(e){this.container.commonImpl.sendUnifiedOffer(e)},t.prototype.sendUnifiedAnswer=function(e){this.container.commonImpl.sendUnifiedAnswer(e)},t.prototype.sendUnifiedCandidates=function(e){this.container.commonImpl.sendUnifiedCandidates(e)},t.prototype.handleUnifiedCallOffer=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),a=i.getWmsPushData(e),n=(a.chid,a.session),o=a.tracksId,s=a.negotiationType,r=(a.candidates,a.type),c=a.credentials,t=a.datatype;a.audio_offer&&(n=a.audio_offer,a.candidates=a.audio_candidate,a.type=b.audio_unified_mix),c&&this.setUnifiedCredential(e);r=i.getUnifiedPeerObjByStreamType({id:e,type:t||r,streamType:b.downstream});r||(a.isUpStream=!1,r=this.__initUnifiedConnection(a)),r.remoteTracksId=o?D(o):null,r.negotiationType=s||null,r.setOfferRemoteDescription(n),r.setIceCandidatesArray(a),i.setUserTrackDetails(a)},t.prototype.handleUnifiedCallAnswer=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),a=i.getWmsPushData(e),n=(a.chid,a.session),o=a.tracksId,s=a.negotiationType,r=(a.candidates,a.type),t=a.datatype,r=i.getUnifiedPeerObjByStreamType({id:e,type:t||r,streamType:b.upstream});r.remoteTracksId=o?D(o):null,r.negotiationType=s||null,r.setAnswerRemoteDesription(n),r.setIceCandidatesArray(a),r.sendCandidates()},t.prototype.notifyUser=function(e){var t=e.mid,i=e.type,a=this.container.commonImpl,n=a.getCallStatusData(t),e=n.type;n.host==b.upstream&&e==i&&(i={action:b.invite,mediainvitation:i!=b.screen_share_smart,mediarequest:i!=b.screen_share_smart},a.inviteUser({dataval:i,id:t}))},t.prototype.unifiedcallConnected=function(e){e.chid;var t=e.type,i=e.mid,e=(e.isReconnecting,e.isUpStream);this.container.commonImpl.sendUnifiedConnected({mid:i,isUpStream:e,type:t})},t.prototype.handleUnifiedInvitation=function(e){var t=this.container,i=t.commonImpl,a=(t.MediaPermission,i.getWmsPushData(e)),t=(a.chatid,a.chid),a=(a.mode,a.type,a.mediaRequest,a.isOldUI,a.perfectReNegotiation,{});a.action=b.accept,a.session_id=getSid(),this.container.commonImpl.makeUnifiedCallAccept({dataval:a,id:e}),i.setActiveCallData(t),i.setActiveTab()},t.prototype.handleCallAnswerReceived=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),a=i.getWmsPushData(e),t=(a.chid,a.session,a.tracksId,a.negotiationType,a.candidates,a.type),a=a.datatype;i.getUnifiedPeerObjByStreamType({id:e,type:a||t,streamType:b.downstream}).sendCandidates()},t.prototype.handleUnifiedCallConnected=function(e){var t=this,i=this.container,a=i.audioImpl,n=i.commonImpl,o=i.mediaUIHandler,s=n.getWmsPushData(e),r=s.chid,c=s.datatype,i=s.isupstream,s=n.getCallStatusByChid(r)[e].isdirectcall;c!=b.audio_unified_mix||1!=i?((i=n.getCallStatusData(e))?i.callStatus=b.connected:i={callStatus:b.connected},n.setCallStatusData(e,i),n.updateCallStatus(e),o.updateCallInvitationState(b.screen_share_smart,{chid:r,media_id:e,isDirectCall:s,callEndCbk:s?function(){t.handleUIApiCallEnd(e)}:function(){t.handleUiunifiedEnd(e)}},b.connected)):a.handleUnifiedCallConnected(e)},t.prototype.swapUnifiedScreenShare=function(e){var t=e.chid||e.chatid,i=e.id,a=this.container,n=a.audioImpl,o=a.mediaUIHandler,s=a.uiHandler,e=a.commonImpl,a=o.getUIState().states[t];a&&a.screen_share&&(a.screen_share.type==b.viewing?this.addScreenTrackInConference():a.screen_share.type==b.sharing&&(e.setSwapRequestCallbackState(),e={chid:t,media_id:i,cancelCbk:function(){return o.handleUIRequestCancel(b.screen_share,t,i)},ss_type:b.viewing},s.showScreenShareMaking(b.screen_share,e),e={chid:t,mid:i,negotiationType:b.screen_share_smart},n.initCallRequest(e)))},t.prototype.__endUnifiedSreenShare=function(i){var e,t,a=this,n=this.container,o=n.commonImpl,s=n.detailsHandler,r=n.mediaUIHandler,c=n.MediaPermission,d=o.getWmsPushData(i),l=(d.type,d.chid),p=[b.upstream,b.downstream];for(t in p){var u=o.getUnifiedPeerObjByStreamType({id:i,type:b.screen_share_smart,streamType:p[t]});u&&(e=u.creatorid)}n={negotiation_type:b.screen_share_smart,process_type:b.negotiation,creator_id:e},d=o.getCallStatusData(i),d={chid:l,media_id:i,isDirectCall:d.isdirectcall};r.updateCallInvitationState(b.screen_share_smart,d,b.ended);d={id:i,chid:l,type:b.screen_share_smart};o.setWmsPushData(i,d),this.closeUnifiedPeerConn(i),succescbk=function(){function e(){return a.handleUiunifiedEnd(i)}var t=null,t=s.isEmbed()?s.getVisitorWMSID():s.getCurrentUserId(),t={id:i,chid:l,isUpStream:!0,type:b.screen_share_smart,mediaRequest:!1,creatorid:t};setTimeout(function(){r.makeScreenShareConnected(b.screen_share,{chid:l,media_id:i,callEndCbk:e,ss_type:b.sharing})},500),c.screenEndFromBrowserUI(e),a.__initUnifiedConnection(t)};n={action:b.end,success_cbk:succescbk,failure_cbk:null,extraData:n};o.setApiData(i,n),o.makeApiCall(i)},t.prototype.handleUnifiedCallEnd=function(e){var t=this.container,i=t.commonImpl,a=t.mediaUIHandler,n=t.MediaPermission,o=i.getWmsPushData(e),t=o.chid,i=o.processType;o.negotiationType;a.deleteScreenShareState(t),n.closeStreamByType(b.screen_share),i&&i==b.negotiation?this.closeUnifiedPeerConn(e):(this.closeAllPeerConn(e),a.updateCallInvitationState(b.audio,{chid:t,media_id:e},b.ended),this.clearData(e),detailsHandler.handleCallEnded({type:b.screen_share,chid:t}))},t.prototype.closeUnifiedPeerConn=function(e){var t,i=this.container,a=(i.dataHandler,i.commonImpl),i=(i.mediaUIHandler,i.constants,i.MediaPermission,a.getWmsPushData(e)),n=(i.chatid,i.chid,i.mode,i.type),o=(i.mediaRequest,i.isOldUI,i.perfectReNegotiation,i.negotiationType),s=(i.processType,[b.upstream,b.downstream]);for(t in s){var r=a.getUnifiedPeerObjByStreamType({id:e,type:o||n,streamType:s[t]});r&&(r.closeConnection(),a.removeUnifiedPeerObjByStreamType({id:e,type:o||n,streamType:s[t]}))}},t.prototype.closeAllPeerConn=function(t){var e=[b.screen_view_smart,b.screen_share_smart,b.audio_unified_mix,b.audio_smart,b.data_channel],i=this;e.forEach(function(e){i.__closeUnifiedPeerConnByType({id:t,type:e})})},t.prototype.handleUiSmartRequestAcceptSuccessCBK=function(e){this.__endUnifiedSreenShare(e)},t.prototype.handleUiunifiedEnd=function(e){var t=this.container,i=t.mediaUIHandler,a=t.detailsHandler,t=t.commonImpl.getWmsPushData(e).chid;i.getUIState().states[t].audio?i.getUIState().states[t].screen_share.type==b.viewing?(this.__makeUnifiedScreenEnd(e,b.screen_view_smart),this.__closeUnifiedPeerConnByType({id:e,type:b.screen_share_smart}),i.deleteScreenShareState(t),i.deletePlayer(t),a.clearPlayer()):(this.__makeUnifiedScreenEnd(e,b.screen_share_smart),this.__endUnifiedScreenSharing(e)):(i.updateCallInvitationState(b.screen_share_smart,{chid:t,media_id:e},b.ended),this.__closeUnifiedPeerConnByType({id:e,type:b.data_channel}),this.__makeUnifiedScreenEnd(e),this.__endUnifiedScreenSharing(e),this.clearData(e),a.handleCallEnded({type:b.screen_share,chid:t}))},t.prototype.__closeUnifiedPeerConnByType=function(e){var t,i=e.id,a=e.type,n=this.container.commonImpl,o=[b.upstream,b.downstream];for(t in o){var s=n.getUnifiedPeerObjByStreamType({id:i,type:a,streamType:o[t]});s&&(s.closeConnection(),n.removeUnifiedPeerObjByStreamType({id:i,type:a,streamType:o[t]}))}},t.prototype.__endUnifiedScreenSharing=function(e){var t=this.container,i=t.MediaPermission,a=t.commonImpl,n=t.detailsHandler,t=t.mediaUIHandler,a=a.getWmsPushData(e).chid;i.closeStreamByType(this.screen_share),t.deleteScreenShareState(a),t.deletePlayer(a),n.clearPlayer(),this.__closeUnifiedPeerConnByType({id:e,type:b.screen_share_smart})},t.prototype.__makeUnifiedScreenEnd=function(e,t){var i,a=this.container,n=a.commonImpl,o=a.constants,a=n.getWmsPushData(e),s=(a.type,a.chid,null),r=[b.upstream,b.downstream];for(i in r){var c=n.getUnifiedPeerObjByStreamType({id:e,type:b.screen_share_smart,streamType:r[i]});c&&(s=c.creatorid)}a={creator_id:s};t&&(a.process_type=o.negotiation,a.negotiation_type=t);a={action:o.end,success_cbk:null,failure_cbk:null,extraData:a};n.setApiData(e,a),n.makeApiCall(e)},t.prototype.handleUnifiedCallAccept=function(t){var i=this,e=this.container,a=e.dataHandler,n=e.constants,o=e.commonImpl,s=e.mediaUIHandler,e=(e.detailsHandler,o.getWmsPushData(t)),r=e.chid,c=e.type,e=(e.processType,e.isOldUI,e.isMobileOperator,o.getCallStatusData(t));e?(e.type=c,e.callStatus=n.connecting):e={callStatus:n.connecting},o.setCallStatusData(t,e),o.updateCallStatus(t),clearTimeout(a.get(t+"_waiting_timer")),a.remove(t+"_waiting_timer"),o.deleteSwapRequestCallbackState();a={chid:r,media_id:t,muteCbk:function(){},rejectCbk:function(){var e={action:n.cancel,success_cbk:null,failure_cbk:null};o.setApiData(t,e),o.makeApiCall(t),s.updateCallInvitationState(c,{chid:r,media_id:t},n.cancelled),i.clearData(t)}};s.updateCallInvitationState(n.screen_share,a,n.connecting)},t.prototype.addUnifiedRemoteStream=function(e,t){var i=this;try{t.type;var a=t.mid,n=t.chid,o=t.negotiationType,s=this.container,r=s.constants,c=s.mediaUIHandler,d=s.dataHandler,l=s.commonImpl,p=e.stream;if(e.streams&&(p=e.streams[0]),o==r.audio)return;function u(){i.handleUiunifiedEnd(a)}d.get(r.isAlreadySharing)&&(d.set(r.isAlreadySharing,!1),setTimeout(function(){i.handleStopScreenShare(a)},2e3));var h=this.container.uiHandler.states[n];l.getUnifiedPeerObjByStreamType({id:a,type:r.screen_share_smart,streamType:r.downstream})&&h&&h.screen_share&&h.screen_share.type&&(this.container.uiHandler.states[n].screen_share.type=r.viewing);var m=c.getUIState().states&&c.getUIState().states[n]&&c.getUIState().states[n].screen_share;if(m&&m.type==r.sharing)return;c.updateCallInvitationState(r.screen_share,{chid:n,id:a,callEndCbk:u},r.connected),c.playScreenShareStream({stream:p,chid:n,mid:a,endCbk:u})}catch(e){}},t}(l),p=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.setUnifiedCredential=function(e){},t.prototype.setUnifiedPeerObj=function(e){var t=e.peerObj,i=e.data,a=this.container.dataHandler,n=i.id,o=i.isUpStream,s=i.type,r=i.datatype,e=o?b.upstream:b.downstream,i={};i[e]=t;o=this.getUnifiedPeerObj({id:n});(o=o||{})[r||s]?o[r||s][e]=t:o[r||s]=i,a.set(n+"_unifiedconnection",o)},t.prototype.getUnifiedPeerObjByStreamType=function(e){var t=e.id,i=e.type,e=e.streamType,t=this.container.dataHandler.get(t+"_unifiedconnection");if(!t)return null;i=t[i];return i?i[e]:null},t.prototype.removeUnifiedPeerObjByStreamType=function(e){var t=e.id,i=e.type,e=e.streamType,t=this.container.dataHandler.get(t+"_unifiedconnection");if(!t)return null;i=t[i];if(!i)return null;delete i[e]},t.prototype.getUnifiedPeerObj=function(e){e=e.id,e=this.container.dataHandler.get(e+"_unifiedconnection");return e||null},t.prototype.setUserTrackDetails=function(e){var t=this.container.dataHandler,i=e.id,a=e.userDetails;(this.getUnifiedTrackDetails(e)||{})[a],t.set(i+"_unifiedtrackdetails",a)},t.prototype.getUnifiedTrackDetails=function(e){e=e.id,e=this.container.dataHandler.get(e+"_unifiedtrackdetails");return e||null},t.prototype.sendUnifiedOffer=function(e){e.chid;var t=e.description,i=e.mid,a=(e.type,e.tracksId),n=e.negotiationType,o=e.processType,s=e.candidate,r=e.dataType,c=this.container,e=(c.detailsHandler,c.ajaxHandler),c=this.constructV3URL(i),i={};i.offer_sdp=t,i.tracks_id=D(a),i.negotiation_type=n,i.process_type=o,i.action="offer",i.candidate=s,i.data_type=r,e.put(c,i,null,null,!0,"v3")},t.prototype.sendUnifiedAnswer=function(e){e.chid;var t=e.description,i=e.mid,a=(e.type,e.tracksId),n=e.negotiationType,o=e.processType,s=e.candidate,r=e.dataType,c=e.creatorid,d=this.container,e=(d.detailsHandler,d.ajaxHandler),d=this.constructV3URL(i),i={};i.tracks_id=D(a),i.negotiation_type=n,i.process_type=o,i.answer_sdp=t,i.data_type=r,i.candidate=s,i.action="answer",i.creator_id=c,e.put(d,i,null,null,!0,"v3")},t.prototype.sendUnifiedCandidates=function(e){var t=e.candidates,i=(e.chid,e.mid),a=(e.type,e.isupstream),n=e.dataType,o=e.creatorid,e=this.constructV3URL(i),i={};i.ice_candidates=t,i.action="candidates",i.isupstream=a,i.data_type=n,i.creator_id=o,this.container.ajaxHandler.put(e,i,null,null,!0,"v3")},t.prototype.inviteUser=function(e){var t=e.dataval,e=e.id,e=this.constructV3URL(e);this.container.ajaxHandler.put(e,t,null,null,!0,"v3")},t.prototype.makeUnifiedCallAccept=function(e){var t=e.dataval,e=e.id,e=this.constructV3URL(e);this.container.ajaxHandler.put(e,t,null,null,!0,"v3")},t.prototype.sendUnifiedConnected=function(e){var t=e.mid,i=e.isUpStream,a=e.type,e=this.constructV3URL(t),t={action:"connected"};t.isupstream=i,t.data_type=a,this.container.ajaxHandler.put(e,t,null,null,!0,"v3")},t.prototype.sendUnifiedState=function(e){var t=e.dataval,e=e.id,e=this.constructV3URL(e);this.container.ajaxHandler.put(e,t,null,null,!0,"v3")},t.prototype.constructV3URL=function(e){var t="media";return e&&(t+="/"+e),t},t.prototype.isSmartFlow=function(e){e=this.getCallStatusData(e);return!(!e||!e.type||!e.type.includes("unified")&&!e.type.includes("smart"))},t.prototype.checkUnifiedNetwork=function(t,e){var i=this;void 0===e&&(e=!1);var a=t.chid,n=t.mid,o=this.container.mediaUIHandler,s=t.type,r="undefined"==typeof _MEDIASERVERURL?_MEDIASTATICURL:_MEDIASERVERURL;t.reconnectInterval=setTimeout(function(){var e=document.createElement("IMG");e.src=r+"/images/spacer.gif?nocache="+(new Date).getTime(),e.onload=function(){clearTimeout(t.reconnectInterval),t.reconnectEndTimer=null,t.iceRestart=!0,t.isUpStream?t.createOffer():t.isUpStream||i.__initRegenerateOffer(t),t.isReconnecting=!0,t.iceRestart=!0,i.updateAcceptedTimeForMediaStats(Date.now(),n)},e.onerror=function(){return i.checkNetwork(a,!0)}},5e3),t.reconnectEndTimer||(t.reconnectEndTimer=setTimeout(function(){i.container[s+"Impl"].endOngoingCall(a,n),clearTimeout(t.reconnectInterval),t.reconnectEndTimer=null},3e4)),e||o.updateCallInvitationState(s,{chid:a,media_id:n},"reconnecting")},t.prototype.__initRegenerateOffer=function(e){var t=this.container.detailsHandler,i=e.mid,a=this.constructV3URL(i),n={};n.action=b.restart,n.data_type=e.type,n.session_id=t.getSessionID(),this.container.ajaxHandler.put(a,n,null,null,!0,"v3"),e.closeConnection(),this.removeUnifiedPeerObjByStreamType({id:i,type:e.type,streamType:b.downstream})},t.prototype.closeUnifiedPeerConnByType=function(e){var t,i=e.id,a=e.type,n=this.container.commonImpl,o=[b.upstream,b.downstream];for(t in o){var s=n.getUnifiedPeerObjByStreamType({id:i,type:a,streamType:o[t]});s&&(s.closeConnection(),n.removeUnifiedPeerObjByStreamType({id:i,type:a,streamType:o[t]}))}},t.prototype.endOngoingUnifiedCall=function(t,e,i){var a=this.container,n=a.detailsHandler,o=a.mediaUIHandler,a=[b.screen_view_smart,b.screen_share_smart,b.audio_unified_mix,b.audio_smart,b.data_channel],s=this;a.forEach(function(e){s.closeUnifiedPeerConnByType({id:t,type:e})}),n.isEmbed()&&n.clearConformBox()&&this.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:n.getMediaActivityAddInfo()}}),o.deleteScreenShareState(e),o.deletePlayer(e),n.clearPlayer()&&this.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:n.getMediaActivityAddInfo()}}),n.clearPopup()&&this.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:n.getMediaActivityAddInfo()}});i={action:b.end,success_cbk:i,failure_cbk:function(){},extraData:{}};this.setApiData(t,i),this.makeApiCall(t)},t}(p),u=function(e){function t(){e.apply(this,arguments),this.isDirectCallAllowed=!1}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.audioIconStatus=function(e,t,i){void 0===i&&(i=1);var a=this.container,n=a.detailsHandler,o=a.commonImpl,s=a.dataHandler,r=a.MediaDetails,c=a.constants,d=o.getMediaDataByChidAndType({chatid:e,type:c.audio})||!1,a=s.get(c.media_active);-1==e&&t(e,c.hide);var l={not_group_chat:!n.isGroupConversation(e),not_bot:!n.isAttenderBot(e),ongoing_chat:n.isChatExist(e),audiocall_enabled:n.isAudioCallEnabled(),current_plan_allowed:n.isPlanAllowed(),is_secure:n.isSecureConnection(),is_proactive_chat:!n.isProactiveChat(e),live_chat_window:n.isliveChatWindow(),isFacebookIntegration:!n.isFaceBookIntegration(),isBrandsDisabled:!s.get("isBrandsDisabled")||!1,isBrowserSupported:r.checkBrowserSupported(b.audio)||r.isNotebookDSKApp(),not_queued_chat:!n.isCurrentChatQueued()},p={ongoing_call_current_chat:d,incoming_call_notification:n.hasIncomingCall(e),ongoing_media:n.onGoingCallForChat(e),isMediaActive:a,isInvitationPending:o.isInvitationPending()},o={1:["not_group_chat","not_bot","ongoing_chat","audiocall_enabled","current_plan_allowed","is_secure","is_proactive_chat","live_chat_window","isFacebookIntegration","isBrandsDisabled","isBrowserSupported","not_queued_chat"]}[i].map(function(e){return l[e]}).reduce(function(e,t){return e&&t},!0),i={1:["ongoing_call_current_chat","incoming_call_notification","ongoing_media","isMediaActive","isInvitationPending"]}[i].map(function(e){return p[e]}).reduce(function(e,t){return e||t},!1);t(e,o?i?c.disable:c.show:c.hide)},t.prototype.onstarted=function(e){var t=this,i=this.container,a=i.commonImpl,n=i.MediaPermission,o=i.detailsHandler,s=i.mediaUIHandler,r=i.dataHandler,c=i.constants,d=c.WAITING_TIME_SECS;if(this.iconClicked={},e.data.error&&(e.data.error.code==b.error_code.AUDIO_CALL_NOT_ALLOWED||e.data.error.code==b.error_code.ALREADY_CLOSE_CONVERSATION))return a.removeActiveTab(),a.removeActiveCallData(),n.closeAllStream(),o.hideAudioCall(),o.clearBusyUI(),o.stopNotifSound(),e.data.error.code==b.error_code.AUDIO_CALL_NOT_ALLOWED&&r.set("isBrandsDisabled",!0),!0;if(e.data.error&&e.data.error.code==b.error_code.UNABLE_TO_INTIATE_CALL)return this.clearOngoingCallDataOnFailure(),void o.showAudioCall();var i=D(e.data.msg).media?D(D(e.data.msg).media):D(e.data.msg),l=i.chatid,n=i.chid,p=i.id,u=i.type,e=i.mediaRequest;l||(i.chatid=l=l||n),a.setWmsPushData(p,i);r.set(p+"_waiting_timer",setTimeout(function(){var e={};o.isOldUI()&&(e.is_old_ui=o.isOldUI());e={action:c.miss,success_cbk:null,failure_cbk:null,extraData:e};a.setApiData(p,e),a.makeApiCall(p),a.removeMediaCache(b.siq_unifiedMedia),t.clearData(p),t.container.detailsHandler.handleCallMissed({type:u,chid:l}),s.updateCallInvitationState(u,{chid:l,media_id:p},c.missed)},6e4));e={callType:c.outgoing,callStatus:c.ringing,mediarequest:e,host:c.upstream,isdirectcall:!1,isPerfectRenegotiation:!1,type:u};a.setCallStatusData(p,e),a.setCallStatus(p),a.setActiveCallData(l);e={chid:l,type:u,media_id:p,status:b.outgoing};a.setMediaCache(b.siq_unifiedMedia,e),o.handleCallInitiate({type:u,chid:l});d={type:c.audiocall,duration:d,tone:c.outgoingcall,chatid:l,isEncrypted:!1};a.playMediaNotificationSound(d),a.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_OUTGOING_SOUND_START,add_info:o.getMediaActivityAddInfo()},mid:p});s.handleAudioCallInitiate(u,{cancelCbk:function(){t.handleUICancel(p)},muteCbk:function(){return t.toggleMute()},chid:l,media_id:p}),o.triggerIconCheck(l)},t.prototype.clearOngoingCallDataOnFailure=function(){var e=this.container,t=e.commonImpl,i=e.MediaPermission,e=e.detailsHandler;t.removeActiveTab(),t.removeActiveCallData(),i.closeAllStream(),e.stopNotifSound()},t.prototype.onstartedSecondary=function(e){var t=this,i=e.chid,a=e.negotiationType,n=e.id,o=this.container,s=o.mediaUIHandler,r=o.detailsHandler,c=o.commonImpl,d=o.constants,e=o.dataHandler,l={process_type:d.negotiation,negotiation_type:a};r.isOldUI()&&(l.is_old_ui=r.isOldUI()),this.iconClicked[i]&&delete this.iconClicked[i];o=d.WAITING_TIME;e.set(n+"_waiting_timer",setTimeout(function(){var e={action:d.miss,success_cbk:null,failure_cbk:null,extraData:l};c.setApiData(n,e),c.makeApiCall(n),s.updateCallInvitationState(d.audio,{chid:i,media_id:n},d.missed)},o));o={chid:i,media_id:n,cancelCbk:function(){var e={action:d.cancel,success_cbk:null,failure_cbk:null,extraData:l};s.updateCallInvitationState(d.audio,{chid:i,id:n},d.cancelled),c.setApiData(n,e),c.makeApiCall(n),c.clearMissedCallTimeout(n)},muteCbk:function(){return t.toggleMute()}};c.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_RENEGOTIATION_INITIATE},mid:n}),s.handleAudioCallInitiate(a,o),r.handleCallInitiate({chid:i,type:a})},t.prototype.startApiDirectCall=function(e){var t=this,i=(e.conversationType,e.successCbk),a=this.container,n=a.mediaUIHandler,e=a.MediaPermission,a=a.commonImpl,o=function(){clearTimeout(s)},s=setTimeout(function(){o=n.mediaPermissionUI()},3e3);return e.getAudioStream(function(){o(),t.directCallMediaPermissionSuccess(i)},function(){return t.directCallMediaPermissionFailure(function(){return o()})}),a.setActiveTab(),this.isDirectCallAllowed=!0},t.prototype.directCallMediaPermissionSuccess=function(e){var t=this;try{var i=this.container,a=i.detailsHandler,n={tone:i.constants.outgoingcall,duration:60};a.playNotifSound(n),this.isDirectCallAllowed=!0;e(function(){return t.toggleMute()})}catch(e){}},t.prototype.directCallMediaPermissionFailure=function(e){var t=this.container.mediaUIHandler;return e(),t.mediaPermissionUnlock(),t.directCallCancelled(),!1},t.prototype.handleUIApiReject=function(e){this.handleUIReject(e),this.container.detailsHandler.initMissedChat(chatid,"CALLENDED","2",!0)},t.prototype.handleUIApiCallEnd=function(e){var t=this.container,i=t.commonImpl,a=t.detailsHandler,n=t.constants,o=i.getWmsPushData(e).chatid,t={action:n.end,success_cbk:function(){return a.endSession(o)},failure_cbk:null,extraData:{}};i.setApiData(e,t),i.makeApiCall(e),this.handleCallEnd(e),i.removeMediaCache(n.siq_directcall)},t.prototype.onDirectCallStarted=function(e){var t=this,i=this.container,a=i.commonImpl,n=i.detailsHandler,o=i.mediaUIHandler,s=i.dataHandler,r=i.constants,c=e.type,d=e.id,l=e.chatid,i=e.mediaRequest;a.setWmsPushData(d,e),a.setCredential(d);s.set(d+"_waiting_timer",setTimeout(function(){a.removeMediaCache(r.siq_directcall),a.clearMissedCallTimeout(d),t.clearData(d),n.initMissedChat(l,"CALLENDED","2",!0),o.updateCallInvitationState(c,{chid:l,media_id:d},r.missed)},6e4));i={callType:r.outgoing,callStatus:r.ringing,mediarequest:i,host:r.upstream,isdirectcall:!0,isPerfectRenegotiation:!1};a.setCallStatusData(d,i),a.setCallStatus(d),a.setActiveCallData(l);function p(){n.initMissedChat(l,"CALLENDED","2",!0),o.updateCallInvitationState(r.audio,{chid:l,media_id:d},r.cancelled),a.removeMediaCache(r.siq_directcall),a.clearMissedCallTimeout(d),t.clearData(d)}function u(){return t.toggleMute()}n.triggerIconCheck(l);setTimeout(function(){return o.handleAudioCallInitiate(c,{muteCbk:u,chid:l,cancelCbk:p,media_id:d,isDirectCall:!0})},500),clearTimeout(n.getChatWinObjById(l).waitTimer);i={chid:l,type:c,media_id:d,status:b.outgoing};a.setMediaCache(r.siq_directcall,i)},t.prototype.startAudioCallAgain=function(e){var t=this.container,i=t.detailsHandler,a=t.audioImpl,t=t.constants;i.isRecordingON()||this.hasIncommingCall(e)||(e=i.getChatWinObjById(e),e={type:t.audio,chatid:e.chatID,mode:t.visitor,mediarequest:!0,mediainvitation:!0,wmsid:$Support.EmbedObj.vwmsid,lsuid:e.attender,lsid:$Support.getParent().$ZSIQWidget.getWidgetObject().lsid},a.startAudioCall(e))},t}(e),h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.screenshareIconStatus=function(e){var t=e.chid,i=e.callback,a=e.type;void 0===a&&(a=1);var n=this.container,e=n.detailsHandler,n=n.constants,o={not_group_chat:!e.isGroupConversation(t),not_bot:!e.isAttenderBot(t),ongoing_chat:e.isChatExist(),audiocall_enabled:e.isScreenShareAllowed(),current_plan_allowed:e.isPlanAllowed()},s={sharescreenAllowed:!e.isShareScreenAllowed(t)},e={1:["not_group_chat","not_bot","ongoing_chat","audiocall_enabled","current_plan_allowed"]}[a].map(function(e){return o[e]}).reduce(function(e,t){return e&&t},!0),a={1:["sharescreenAllowed"]}[a].map(function(e){return s[e]}).reduce(function(e,t){return e&&t},!0),n=e?a?n.disable:n.show:n.hide;c(i)&&i(t,n)},t.prototype.isScreenShareAllowed=function(e,t){var i=e.chatid,a=this.container,n=a.commonImpl,o=a.constants,s=a.detailsHandler,r=a.mediaUIHandler,c=!0,e="",a="";return!n.getMediaDataByChidAndType({chatid:i,type:o.screen_share})&&(s.isSecureConnection()?s.isShareScreenAllowed(i)||(c=!1,a="siqMedia: screen share Failed screen share not allowed | chid - "+i):(c=!1,e=s.I18N("av.info.insecuredwebsite"),a="siqMedia: screen share Failed Visitor not in secure connection | chid - "+i),!c&&e&&(r.showDialog({desc:e,buttons:{accept:{text:"common.ok",callback:function(){return null}}}}),callBackAction(implConstants.postDebugLog,a)),c)},t}(l),m=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t}(d),_=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.checkAndUpdateUIForApi=function(){},t.prototype.showDesktopNotif=function(){},t.prototype.startApiCall=function(e){},t.prototype.checkAndPlayNotification=function(){},t.prototype.getFailureMessage=function(e){var t=null;switch(e.name){case"NotFoundError":case"DevicesNotFoundError":t=LSResource.getRealValue("av.info.microphone.notavailable");break;case"SourceUnavailableError":case"PermissionDeniedError":case"SecurityError":case"NotAllowedError":default:t=LSResource.getRealValue("av.info.microphone.blocked")}return t},t.prototype.sendMediaStats=function(e,t){var i=e.msg,a=i?i.media:null,a=a&&a.id?a.id:e.id||i.id,i={};e.statcode&&(i.statcode=e.statcode),i.description=t,this.container.ajaxHandler.post("stats/"+a+"/media",i,null,null)},t}(p);function g(e,t){for(var i=[],a=arguments.length-2;0<a--;)i[a]=arguments[a+2];return{tag:e,props:t||{},children:i}}function f(e,t){if(void 0===t&&(t={}),-1!=["number","string","undefined"].indexOf(typeof e))return document.createTextNode(e);var i=document.createElement(e.tag);y(i,e.props,t);for(var a=0;a<e.children.length;a++)i.appendChild(f(e.children[a],t));return i}function y(e,t,i){if(!e.skipattr)for(var a in t)"skipattr"==a?e.skipattr=!0:"on"==a.slice(0,2)?function(e,t,i){t=t.slice(2).toLowerCase(),e._listeners&&e._listeners[t]||e.addEventListener(t,function(e){return this._listeners[e.type](e)},!1);(e._listeners||(e._listeners={}))[t]=i}(e,a,t[a]):"ref"===a.slice(0,3)?i.refs[t[a]]=e:"html"===a.slice(0,4)?e.innerHTML=t[a]:"video"!=e.tagName.toLowerCase()||e[a]?a&&void 0!==t[a]&&$(e).attr(a)!=t[a]&&e.setAttribute(a,t[a]):e[a]=t[a]}function v(e,o){var s=0,r=0,c=e,d=!1;function l(e){p(e);var t=getComputedStyle(c),i=parseInt(t.getPropertyValue("left"))||0,a=parseInt(t.getPropertyValue("top"))||0;if(i<0||a<0)return i<0&&(c.style.left="0px"),a<0&&(c.style.top="0px"),d=!1,void(o?window.parent:window).removeEventListener("mousemove",l);var n=parseInt(t.getPropertyValue("right"))||0,t=parseInt(t.getPropertyValue("bottom"))||0;if(n<0||t<0)return n<0&&(c.style.left=i+n+"px"),t<0&&(c.style.top=a+t+"px"),d=!1,void(o?window.parent:window).removeEventListener("mousemove",l);c.style.left=e.pageX-s+"px",c.style.top=e.pageY-r+"px"}function p(e){e.stopPropagation(),e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1}e.addEventListener("mousedown",function(e){p(e),d=!0;var t=getComputedStyle(c),i=parseInt(t.getPropertyValue("left"))||0,t=parseInt(t.getPropertyValue("top"))||0;s=e.pageX-i,r=e.pageY-t,(o?window.parent:window).addEventListener("mousemove",l)}),e.addEventListener("mouseup",function(e){p(e),!0===d&&(d=!1,(o?window.parent:window).removeEventListener("mousemove",l))})}p=function(){this.embed=SiqAVRouter.container.mediaUIHandler.isEmbed(),this.reRender()};p.prototype.updateState=function(e){e&&(this.state=e);try{this.reRender()}catch(e){}},p.prototype.reRender=function(){var e;this.dom&&1==this.dom.nodeType?this.dom=function e(t,i,a,n){var o,s,r,c=t;if(t)if(o=t,(r=-1!=["string","number"].indexOf(typeof(s=i)))||3==o.nodeType?r&&3==o.nodeType&&o.textContent==s:o.tagName.toLowerCase()==s.tag.toLowerCase()){if("object"==typeof i&&1==t.nodeType){var d=Math.max(t.childNodes.length,i.children.length),l=Array.from(t.childNodes);y(t,i.props||{},n);for(var p=0;p<d;p++)e(l[p],i.children[p]||"",t,n)}}else c=f(i,n),$(t).replaceWith(c);else i&&a.append(f(i,n));return c}(this.dom,this.render(),this.placeholder,this):(e=f(this.render(),this),this.dom&&$(this.dom).replaceWith(e),this.dom=e,this.embed?e&&e.className&&e.className.includes("zsiq_media_videomain")?e&&a(e,this.frameout):this.disableDrag||v(e,this.frameout):this.disableDrag||1!=e.nodeType||$(e).draggable({containment:"window",scroll:!1})),this.dom&&!this.dom.parentNode&&(this.placeholder_prepend?$(this.placeholder).prepend(this.dom):$(this.placeholder).append(this.dom))},p.prototype.destroy=function(){$(this.dom).remove()};var S=function(n){function e(e,t,i,a){void 0===a&&(a=!1),this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=i.constants,this.frameout=!0,this.screenShareAllowed=i.mediaUIHandler.isScreenShareAllowed(),this.isInviteOnly=a,this.isDummyImage=!0,n.call(this)}return n&&(e.__proto__=n),((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype.destroy=function(){this.ssTimer&&clearInterval(this.ssTimer),this.audioTimer&&clearInterval(this.audioTimer),$(this.dom).remove()},e.prototype.canStartSS=function(){return!this.state.screen_share},e.prototype.__callCbk=function(){I(this.container,this.state.chid,this.embed)},e.prototype.getUI=function(){var e=this.state,t=e.audio,e=e.screen_share;return e&&this.isSharing(e.type)&&!this.isInviteOnly?this.getScreenShareUI():!t||e&&this.isViewing(e.type)&&(!this.isViewing(e.type)||this.isConnected(t.status))?"":this.getAudioCallUI()},e.prototype.getAudioCallBtns=function(){var e=this,t=this.state,i=t.handler,a=(t.name,t.url,t.screen_share),n=t.audio,o=t.chid,s=n.mute,r=n.status,c=n.media_id,d=this.container.mediaUIHandler,l=this.isInvited(r),p=this.isConnected(r),u=this.isRequested(r),h=this.isConnecting(r),m=[this.constants.rejected,this.constants.cancelled,this.constants.missed].includes(r),_=d.isScreenShareAllowed(),f=a&&this.isConnected(a.status),y=a&&(this.isConnected(a.status)?this.constants.stopsharing:this.constants.cancel),t=p?this.constants.end:this.constants.cancel,n=!d.isCallInitiatedFromOldUI(c)&&!d.isMobileOperator(c),c=!d.isMobileVisitor(o),d=d.isSecure();return r!=this.constants.ended?g("div",{class:"siq_media_btns siq_media_flexM"},_&&!a&&p&&n&&c&&d?g("div",{class:"zsiqmico-screenshare zsiq_media_gbtn",title:U("screenshare"),onclick:function(){return e.container.uiHandler.shareScreen(o)}}):"",a&&this.isSharing(a.type)&&!l&&!this.isInviteOnly?g("div",{class:"zsiqmico-endscreenshare zsiq_media_rbtn",title:U(y),onclick:function(){return i(o,"screen_share","reject")}}):"",p||u||h?g("div",{class:(s?"zsiqmico-unmute":"zsiqmico-mute")+" zsiq_media_wbtn "+(_||f?"zsiq_media_mL13":""),title:U(s?"unmute":"mute"),onClick:function(){return i(o,"audio","mute")}}):"",l?g("div",{class:"zsiqmico-pickcall zsiq_media_gbtn "+(a?"zsiq_media_mL13":""),title:U("accept"),onclick:function(){return i(o,"audio","accept")}}):"",m?"":g("div",{class:"zsiqmico-endcall zsiq_media_rbtn "+(p||u||l||h||f?"zsiq_media_mL13":""),title:U(t),onclick:function(){return i(o,"audio","reject")}})):""},e.prototype.getScreenShareBtns=function(){var e,t,i=this.state,a=i.handler,n=i.screen_share,o=i.audio,s=i.chid,r=n.status;o&&(e=o.mute,t=o.status);var c=this.isConnected(t),d=this.isConnecting(t),l=this.isEnded(t),p=this.isConnected(r),u=n&&(this.isConnected(n.status)?this.constants.stopsharing:this.constants.cancel),i=o&&(c?this.constants.end:this.constants.cancel),r=this.container.mediaUIHandler.isAudioCallEnabled();return o&&o.status==this.constants.ended?"":g("div",{class:"siq_media_btns siq_media_flexM"},n&&this.isSharing(n.type)&&!this.isRequested(t)&&!this.isInvited(t)?g("div",{class:"zsiqmico-endscreenshare zsiq_media_rbtn",title:U(u),onclick:function(){return a(s,"screen_share","reject")}}):"",n&&(this.isRequested(t)||this.isInvited(t))?g("div",{title:U(u),class:"zsiqmico-endscreenshare zsiq_media_rbtn zsiq_media_disable"}):"",o&&(c||d)?g("div",{class:(e?"zsiqmico-unmute":"zsiqmico-mute")+" zsiq_media_wbtn "+(c||d?"zsiq_media_mL13":""),title:U(e?"unmute":"mute"),onClick:function(){return a(s,"audio","mute")}}):"",c?g("div",{class:"zsiqmico-endcall zsiq_media_rbtn "+(c||isRequested||isInvited||d||l&&p?"zsiq_media_mL13":""),title:U(i),onclick:function(){return a(s,"audio","reject")}}):"",p&&!o&&r?g("div",{class:"zsiqmico-pickcall zsiq_media_gbtn "+(n?"zsiq_media_mL13":""),title:U("call"),onclick:this.__callCbk.bind(this)}):"")},e.prototype.getAudioCallUI=function(){var e=this.state,t=(e.handler,e.name),i=e.url,a=(e.screen_share,e.audio),n=e.chid,o=e.timer,s=(a.mute,a.status),r=a.media_id,e=this.isInvited(s),a=this.isRequested(s),s=i&&i(r)?g("img",{src:i(r,n),alt:t?t(n):"Operator",draggable:"false"}):g("em",{class:"sqico-person"}),i=t(n),i=i&&i[0].toLowerCase(),r=this.container.commonImpl.isSmartFlow(r);return g("div",{class:"zsiq_media_headshot_main"},g("div",{class:"zsiq_media_headshot"},g("div",{class:"zsiq_media_cirview"},e||a?g("div",{class:"zsiq-media-anim"}):"",g("div",{class:this.isDummyImage?"zsiq_media_userimg":"zsiq_media_imgdummy-"+i},s),g("div",{class:"zsiq_media_detail"},g("div",{class:"zsiq_media_elips zsiq_media_name"},t(n)),g("div",{class:"zsiq_media_info zsiq_media_elips"},o&&r?g("em",{title:U("recording"),class:"zsiqmico-record",style:"cursor: pointer;"}):"",O(this.state,this.__getAudioCallStatusPriorityInSS())),g("div",{class:"zsiq_media_dept zsiq_media_flexC",style:"display:none;"},g("span",{class:"zsiqmico-dept"}),g("span",{class:"zsiq_media_elips"})),this.getAudioCallBtns()))))},e.prototype.getScreenShareUI=function(){var e=this.state,t=(e.handler,e.name),i=e.url,a=e.screen_share,n=(e.audio,e.chid),e=(a.status,t(n)),e=e&&e[0].toLowerCase(),a=i&&i(a.media_id)?g("img",{src:i(a.media_id,n),alt:t?t(n):"Operator",draggable:"false"}):g("em",{class:"sqico-person"});return g("div",{class:"zsiq_media_headshot_main"},g("div",{class:"zsiq_media_headshot"},g("div",{class:"zsiq_media_cirview"},g("div",{class:this.isDummyImage?"zsiq_media_userimg":"zsiq_media_imgdummy-"+e},a),g("div",{class:"zsiq_media_detail"},g("div",{class:"zsiq_media_elips zsiq_media_name"},t(n)),g("div",{class:"zsiq_media_info zsiq_media_elips"},P(this.state,!1)),g("div",{class:"zsiq_media_dept zsiq_media_flexC",style:"display:none;"},g("span",{class:"zsiqmico-dept"}),g("span",{class:"zsiq_media_elips"})),this.getScreenShareBtns()))))},e.prototype.inviteCheck=function(){var e=this.state,t=e.screen_share,e=e.audio;return!this.isInviteOnly||t&&e&&this.isSharing(t.type)&&!this.isConnected(e.status)&&!this.isEnded(e.status)},e.prototype.render=function(){return!this.inviteCheck()||this.state.isDirectCall||document.querySelector("#call_Busy")?"":this.getUI()},e.prototype.__getAudioCallStatusPriorityInSS=function(){var e=this.state,t=e.screen_share,i=e.audio,e=e.timer,i=i.status;return!(e&&!t&&this.__isStatusNotConnected(i))&&!!(e&&!t||e&&!this.__isStatusNotConnected(i))},e.prototype.__isStatusNotConnected=function(e){return e!=this.constants.connected},e.prototype.isConnected=function(e){return e&&e==this.constants.connected},e.prototype.isConnecting=function(e){return e&&e==this.constants.connecting},e.prototype.isEnded=function(e){return e&&e==this.constants.ended},e.prototype.isInvited=function(e){return e&&e==this.constants.invited},e.prototype.isRequested=function(e){return e&&e==this.constants.requested},e.prototype.isSharing=function(e){return e&&e==this.constants.sharing},e.prototype.isViewing=function(e){return e&&e==this.constants.viewing},e.prototype.isReconnecting=function(e){return e&&e==this.constants.reconnecting},e.prototype.isRejected=function(e){return e&&e==this.constants.rejected},e.prototype.isMissed=function(e){return e&&e==this.constants.missed},e}(p);function I(e,t,i){void 0===i&&(i=!0);var a={type:e.constants.audio,mode:e.constants.visitor,mediarequest:!0,mediainvitation:!0},n=e.mediaUIHandler.getChatWinObjById(t);i?$.extend(a,{chatid:n.chatID,wmsid:$Support.EmbedObj.vwmsid,lsuid:n.attender,lsid:$Support.getParent().$ZSIQWidget.getWidgetObject().lsid,normalchid:t}):$.extend(a,{chatid:t}),e.mediaUIHandler.startAudioCall(a)}var A=function(a){function e(e,t,i){this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=i.constants,this.showSSList=!1,this.showMoreOptions=!1,this.showSettings=!1,this.placeholder_prepend=!0,this.moreOptionsUIPosition={right:"0"},this.init(),a.call(this)}return a&&(e.__proto__=a),((e.prototype=Object.create(a&&a.prototype)).constructor=e).prototype.init=function(){this.fullscreen=!1,this.showcntrl=!1,this.frameout=!0,this.switchCbk=this.switchFullscreen.bind(this)},e.prototype.switchFullscreen=function(){this.fullscreen=!this.fullscreen,this.fullscreen?window.addEventListener(this.constants.keyup,this.switchCbk):window.removeEventListener(this.constants.keyup,this.switchCbk),this.reRender()},e.prototype.getAudioCallBox=function(){var e=this.state,t=e.audio,i=e.handler,a=e.chid,n=e.name,o=e.url,s=this.embed?"siqico":"sqico",e=t&&(this.isConnected(t.status)?this.constants.end:this.constants.cancel);return g("div",{class:"zsiq_calldtl"},g("span",null,o&&o(t.media_id)?g("img",{src:o(t.media_id,a),alt:n?n(a):"Operator",class:"siquserimg"}):g("em",{class:s+"-user"}),g("em",{class:"zsiq_caller txtelips"},n(a))),g("span",null,O(this.state),t&&this.isConnected(t.status)?g("em",{title:U(t.mute?"unmute":"mute"),class:s+"-"+(t.mute?"unmute":"mute")+" zsiq_ctrlico",onClick:function(){return i(a,"audio","mute")},"data-type":"mic"}):"",t&&this.isInvited(t.status)?g("em",{title:U("accept"),class:s+"-end zsiq_vend zsiq_ctrlico zsiq_callin",onclick:function(){return i(a,"audio","accept")}}):"",g("em",{title:U(e),class:s+"-end zsiq_vend zsiq_ctrlico",onclick:function(){return i(a,"audio","reject")}}),g("em",null)))},e.prototype.showCntrl=function(){var e=this;this.showcntrl=!0,clearTimeout(this.showCntrlTimer),this.showCntrlTimer=setTimeout(function(){e.showcntrl=!1,e.reRender()},1500),this.__swapHandlerClickCbk(),this.reRender()},e.prototype.__swapHandlerClickCbk=function(){this.swapOptions&&($(this.swapOptions).remove(),this.swapOptions=null)},e.prototype.__swapHandler=function(e,a,t){function n(){return o.__swapHandlerClickCbk.call(o)}function i(e,t,i){a(e,t,i),n()}var o=this;if(this.swapOptions)return n();this.swapOptions=f(g("div",{class:"zsiqcalloptions",id:"calloptions",style:"left:"+(e.clientX-220)+";top:"+(e.clientY-65)+";height:65px;z-index:11111111111;",onMouseLeave:this.__swapHandlerClickCbk.bind(this)},g("div",{onClick:function(){return i(t,"screen_share","swap")}},LSResource.getRealValue("screenshare.sharemyscreen")),g("div",{onClick:function(){return i(t,"screen_share","reject")}},LSResource.getRealValue("screenshare.endscreen")))),this.placeholder.append(this.swapOptions)},e.prototype._SwapList=function(e,t,i){this.embed&&this.state.audio&&!this.fullscreen?this.__swapHandler(e,t,i):t(i,"screen_share","swap")},e.prototype.__showMoreOptions=function(){var e,t=this;this.showMoreOptions||(e=function(){t.showMoreOptions=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showMoreOptions=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.__showSettings=function(){var e,t=this;this.showSettings||(e=function(){t.showSettings=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showSettings=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.__showDropDownList=function(){var e,t=this;this.getCallBarUIPosition(),this.showSSList||(e=function(){t.showSSList=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showSSList=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.getCallBarUIPosition=function(){var e=this.container.uiHandler.getUIPosition(".zsiq_media_videomain");e.width<570&&e.left<100?this.moreOptionsUIPosition.right="auto":this.moreOptionsUIPosition.right="0"},e.prototype.__callCbk=function(){I(this.container,this.state.chid,this.embed)},e.prototype.getScreenShareButtons=function(){var e,t,i=this.state,a=i.screen_share,n=i.audio,o=i.handler,s=i.chid,r=i.chatWinFocused;n&&(e=n.mute,t=n.status);var c=this.isConnected(t),d=a.status,l=a.type,p=this.isConnected(d),u=a&&(p?this.constants.stopsharing:this.constants.cancel),h=n&&(c?this.constants.end:this.constants.cancel),i=this.container.mediaUIHandler.isAudioCallEnabled(),d=n&&[this.constants.invited,this.constants.requested,this.constants.connecting,this.constants.cancelled,this.constants.rejected,this.constants.missed].includes(t);return g("div",{class:"zsiq_media_videofoot"},g("div",{class:"zsiq_media_posrel"},p&&!d?g("div",{class:"zsiqmico-more zsiq_media_wbtn",title:U("options"),onMouseUp:this.__showDropDownList.bind(this)}):"",g("div",{class:"zsiq_media_options",style:(this.showSSList?"display:block;":"display:none;")+" right : "+this.moreOptionsUIPosition.right+";"},g("div",{class:"zsiq_media_option_li",onclick:function(){return o(s,"screen_share","swap")}},LSResource.getRealValue("screenshare.sharemyscreen")),n&&a&&this.isViewing(l)?g("div",{class:"zsiq_media_option_li zsiq_media_red",onclick:function(){return o(s,"screen_share","reject")}},LSResource.getRealValue("screenshare.endscreen")):"")),p&&d?g("div",{class:"zsiqmico-more zsiq_media_wbtn zsiq_media_disable"}):"",g("span",{class:"zsiqmico-chat zsiq_media_wbtn",style:"display:none;"}),this.embed&&n&&(c||this.isConnecting(t)||this.isRequested(t))&&!d?g("div",{class:(e?"zsiqmico-unmute":"zsiqmico-mute")+" zsiq_media_wbtn zsiq_media_mL13",title:U(e?"unmute":"mute"),onClick:function(){return o(s,"audio","mute")}}):"",(this.embed||this.fullscreen||!r)&&!n&&p&&i?g("span",{title:U("call"),class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13",onclick:this.__callCbk.bind(this)}):"",this.embed&&n&&d?g("span",{class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13 zsiq_media_disable"}):"",this.embed&&n&&c?g("span",{title:U(h),class:"zsiqmico-endcall zsiq_media_rbtn zsiq_media_mL13",onclick:function(){return o(s,"audio","reject")}}):"",this.embed&&!n&&a&&this.isViewing(l)?g("div",{class:"zsiqmico-endscreenshare zsiq_media_rbtn zsiq_media_mL13",title:U(u),onclick:function(){return o(s,"screen_share","reject")}}):"")},e.prototype.getUI=function(){var e=this,t=this.state,i=t.screen_share,a=(t.audio,t.timer),t=i?i.stream:"";return t?g("div",{class:"zsiq_media_videomain "+(this.fullscreen?"zsiq-media-maxscreen":"zsiq-media-minscreen")+" "+(this.showcntrl||!a?"zsiq_showcntl":"")+" ",onMouseMove:this.showCntrl.bind(this),onMouseOver:this.showCntrl.bind(this),onMouseDown:this.__swapHandlerClickCbk.bind(this)},g("div",{class:"zsiq_media_videohdr"},g("div",{class:"zsiq_media_videotime"},P(this.state)),g("div",{class:"zsiq_media_videohdrico"},g("span",{class:"zsiqmico-settings",style:"display:none;"}),g("span",{class:this.fullscreen?"zsiqmico-minscreen":"zsiqmico-maxscreen",onclick:this.switchFullscreen.bind(this)}))),this.getScreenShareButtons(),g("div",null,g("video",{autoplay:!0,name:"media",srcObject:t,class:this.isReconnecting(i.status)?"zsiq_media_blur":"",onloadedmetadata:function(){return e.metadata=!0}})),"reconnecting"!=i.status&&this.metadata?"":g("div",{class:"zsiq_media_vloader"}),this.fullscreen?"":g("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_left_corner",position:"top_left_corner"}),this.fullscreen?"":g("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_border",position:"top_border"}),this.fullscreen?"":g("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_right_corner",position:"top_right_corner"}),this.fullscreen?"":g("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_right_border",position:"right_border"}),this.fullscreen?"":g("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_right_corner",position:"bottom_right_corner"}),this.fullscreen?"":g("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_border",position:"bottom_border"}),this.fullscreen?"":g("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_left_corner",position:"bottom_left_corner"}),this.fullscreen?"":g("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_left_border",position:"left_border"})):""},e.prototype.render=function(){var e=this.state,t=e.screen_share,e=e.audio;return t&&this.isViewing(t.type)&&!this.isRequested(t.status)||e&&this.isConnected(e.status)?this.getUI():""},e.prototype.isConnected=function(e){return e&&e==this.constants.connected},e.prototype.isConnecting=function(e){return e&&e==this.constants.connecting},e.prototype.isEnded=function(e){return e&&e==this.constants.ended},e.prototype.isInvited=function(e){return e&&e==this.constants.invited},e.prototype.isRequested=function(e){return e&&e==this.constants.requested},e.prototype.isSharing=function(e){return e&&e==this.constants.sharing},e.prototype.isViewing=function(e){return e&&e==this.constants.viewing},e.prototype.isReconnecting=function(e){return e&&e==this.constants.reconnecting},e.prototype.isRejected=function(e){return e&&e==this.constants.rejected},e.prototype.isMissed=function(e){return e&&e==this.constants.missed},e}(p);function E(){var e=getBrowserFromUserAgent(navigator.userAgent).split("-")[0],t={Chrome:"https://support.google.com/chrome/answer/2693767?hl=en",Firefox:"https://support.mozilla.org/en-US/questions/1168156",Opera:"https://help.opera.com/en/latest/web-preferences/#microphone",Safari:"https://support.apple.com/en-in/guide/safari/websites-ibrwe2159f50/mac"};t[e]&&window.open(t[e],"_blank")}function T(i,a,n,o,s,r,c){function d(){$(t).remove()}function e(){var e=$(parent.document.body).find(".siq_media");window.currentRecorder&&window.currentRecorder.destroy();var t=Recorder();i.uiHandler.setCallUIposition("#user_busy"),s||(d(),e.append($Temp.getAudioRecordedUI(n(0,a),i.mediaUIHandler.getEscapedText(o(a)),r().top,r().left)),i.mediaUIHandler.removeCallUIPosition()),(window.currentRecorder=t).init(s,a,c)}var t,l=o(a);l&&l[0].toLowerCase();t=s?f(g("div",{class:"cal-wrap",id:"audiorec"},g("div",{class:"posrel dib-mid"},g("div",{class:"cal-widgt theme1 outcal"},g("div",{class:"posrel usr-imginfo"},g("div",{class:"cal-visimg "+((l=$Support.EmbedObj.clogo)?"":"sqico-user")},l?g("img",{src:l,alt:o?o(a):"Operator",draggable:"false"}):"")),g("div",{class:"cal-vstrdetl"},g("nav",{class:"cal-actvevstr elips font18"},LSResource.getRealValue("av.info.oprbusy")),g("p",{class:"cal-usrdesc elips"},LSResource.getRealValue("av.info.voicemsg"))),g("div",{class:"cal-optns posrel textR"},g("span",{onclick:e,class:"sqico-record bg-aaa"})))))):f(g("div",{class:"zsiq_media_headshot_main",id:"user_busy",style:"top:"+r().top+"px; left:"+r().left+"px;"},g("div",{class:"zsiq_media_headshot"},g("div",{class:"zsiq_media_cirview"},g("span",{class:"zsiqmico-close",onclick:d,onMouseUp:function(){i.mediaUIHandler.removeCallUIPosition()}}),g("div",{class:"zsiq_media_userimg"},g("img",{src:n&&n(0,a),alt:o?o(a):"Operator",draggable:"false"})),g("div",{class:"zsiq_media_detail"},g("div",{class:"zsiq_media_elips zsiq_media_name"},o(a)),g("div",{class:"zsiq_media_elips"},LSResource.getRealValue("av.info.userbusy")),g("div",{class:"siq_media_btns siq_media_flexM"},g("div",{class:"zsiqmico-record zsiq_media_wbtn",title:LSResource.getRealValue("av.info.voicemessage"),onclick:e}),g("div",{class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13",title:LSResource.getRealValue("av.info.callagain"),onclick:function(){i.mediaUIHandler.isRecordingON()||(d(),I(i,a))}}))))))),s?(CallImpl.isCallWithChat=!0,$("body").prepend(t)):(v(t,!0),$(parent.document.body).find(".siq_media").append(t))}var k=function(a){function e(e,t,i){this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=this.container.constants,this.disableDrag=!0,this.placeholder_prepend=!0,a.call(this)}return a&&(e.__proto__=a),((e.prototype=Object.create(a&&a.prototype)).constructor=e).prototype.getAudioCallStatusText=function(){var e=this.state.audio.status,t=this.state.timer;return{timer:t,connected:LSResource.getRealValue("common.connected"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),initiated:LSResource.getRealValue("audiovideo.ringing"),mediapermission:LSResource.getRealValue("av.info.waitingformediapermission")}[t?"timer":e]||""},e.prototype.getUI=function(){var e=this,t=this.state,i=t.url,a=t.handler,n=t.name,o=t.chid,s=t.audio,r=t.screen_share,c=s&&s.status,d=(r&&r.status,-1==["initiated","requested"].indexOf(c)&&i&&i(s.media_id,o)||$Support.EmbedObj.clogo),l="initiated"==c,p="mediapermission"==c,u=this.container.mediaUIHandler.isScreenShareAllowed(),t=this.container.mediaUIHandler.isCallInitiatedFromOldUI(s.media_id),i=r&&r.type==this.constants.viewing;return $Support.getParent().$zoho.salesiq.floatwindow.visible("show"),i&&($Support.getParent().$zoho.salesiq.floatwindow.visible("hide"),$Support.getParent().$zoho.salesiq.floatbutton.visible("hide")),g("div",{class:"cal-wrap",id:"audiocal"},g("div",{class:"posrel dib-mid"},g("div",{class:"cal-widgt theme1 outcal"},g("div",{class:"posrel usr-imginfo"},g("div",{class:"cal-visimg "},g("img",{src:d,alt:n?n(o):"Operator"}))),g("div",{class:"cal-vstrdetl "+(u?"cal-mw180":"")},g("nav",{class:"cal-actvevstr elips font18"},n&&n(o)||""),g("p",{class:"cal-usrdesc elips"},this.getAudioCallStatusText())),g("div",{class:"cal-optns posrel textR"},!t&&s&&c==this.constants.connected&&u&&!r?g("span",{class:"sqico-screenshare bg-grn",title:U("screenshare"),onclick:function(){return e.container.uiHandler.shareScreen(o)}}):"",!t&&r&&r.type==this.constants.sharing?g("span",{class:"sqico-ssend bg-red",title:U("stopsharing"),onclick:function(){return a(o,"screen_share","reject")}}):"",g("span",{title:s&&U(s.mute?"unmute":"mute"),id:"audiocall_mute",class:"sqico-"+(s.mute?"muteaudio":"microphone")+" bg-aaa "+(p?"cmn_disable":"")+" "+(u?"mL20":""),onclick:function(){return p?"":a(o,"audio","mute")}}),g("span",{title:s&&U(c==this.constants.connected?"end":"cancel"),class:"sqico-call cal-rjct "+(l||p?"cmn_disable":""),id:"audiocall_outgoingend",onclick:function(){return l||p?"":a(o,"audio","reject")}})))))},e.prototype.render=function(){var e=this.state,t=e.isDirectCall,i=e.audio;e.status;return t&&i?this.getUI():""},e}(p);function U(e){var t={mute:LSResource.getRealValue("av.info.mute"),unmute:LSResource.getRealValue("av.info.unmute"),end:LSResource.getRealValue("common.end"),reject:LSResource.getRealValue("common.reject"),screenshare:LSResource.getRealValue("common.screenshare"),swap:LSResource.getRealValue("av.info.swap"),call:LSResource.getRealValue("av.info.call"),cancel:LSResource.getRealValue("common.cancel"),accept:LSResource.getRealValue("common.accept"),stopsharing:LSResource.getRealValue("av.info.endscreen"),options:LSResource.getRealValue("av.info.options"),recording:LSResource.getRealValue("av.info.recording")};return t[e]||""}function M(e,t){return"theme4"!=w()?"":g("div",{class:"thme-bgimg",style:"background-image:url("+("Comp"==e?$Support.EmbedObj.clogo:_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+t.attenderimagefkey+"/photo.ls?nps=404")+")"})}function w(){return window.parent.$ZSIQWidget.getWidgetObject().calltheme||"theme1"}function O(e,t){void 0===t&&(t=!0);var i=e.audio.status,e=e.timer;return t="reconnecting"!=i&&t,{timer:g("span",{class:"call-time-embed"},e),connected:LSResource.getRealValue("common.connected"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),failed:LSResource.getRealValue("av.info.failed")}[e&&t?"timer":i]||""}function P(e,t){void 0===t&&(t=!0);var i=e.screen_share.status,e=e.timer;return t="reconnecting"!=i&&t,{timer:g("span",{class:"call-time-embed"},e),connected:LSResource.getRealValue(t?"common.connected":"ss.info.viewing"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),failed:LSResource.getRealValue("screenshare.info.failed")}[e&&t?"timer":i]||""}function H(e){return SiqAVRouter.container.mediaUIHandler.getChatWinObjById(e)}function q(e,t){return void 0===e&&(e=0),t=H(t).attenderimagefkey,e=_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+t+"/photo.ls?mid="+e,t?e:$Support.EmbedObj.clogo}function N(e){return SiqAVRouter.container.mediaUIHandler.getDecodedText(x[e])||""}function L(){return SiqAVRouter.container.mediaUIHandler.getCallUIPosition()}function B(e){var t=this;this.container=e,this.invitations=null,this.ss_invitation={},this.states={},window.onbeforeunload=function(){if(e.commonImpl.updateMediaCache(b.siq_directcall,b.is_refreshed,!0),e.commonImpl.updateMediaCache(b.siq_unifiedMedia,b.is_refreshed,!0),Object.keys(t.states).length)return""},this.siqdom=document.createElement("div"),this.siqdom.setAttribute("class","siq_media"),this.container.mediaUIHandler.getBody()[0].appendChild(this.siqdom)}var x={};function j(){return SiqAVRouter.container.mediaUIHandler.isEmbed()?$(parent.document.body):$("body")}B.prototype.initiateHeadshot=function(e,t){this.states[e]||(this.states[e]={chid:e,isDirectCall:t},this.states[e].headshot=new S(this.states[e],t?$("body"):this.siqdom,this.container),this.states[e].headshotInvite=new S(this.states[e],t?$("body"):this.siqdom,this.container,!0),this.states[e].directCallUI=new k(this.states[e],$("body"),this.container))},B.prototype.__getType=function(e){var t=this.container.constants;return-1!=[t.audio_unified_mix,t.audio_smart].indexOf(e)?t.audio:-1!=[t.screen_share_smart,t.screen_view_smart,t.screen_view].indexOf(e)?t.screen_share:e},B.prototype.updateCallInvitationState=function(e,t,i){e=this.__getType(e);var a={audio:{connecting:this.makeAudioCallConnecting,connected:this.makeAudioCallConnected,ended:this.makeAudioCallEnded,cancelled:this.makeAudioCallCancelled,rejected:this.makeAudioCallRejected,missed:this.makeAudioCallMissed,reconnecting:this.makeAudioReconnecting,failed:this.makeAudioCallFailed},screen_share:{connecting:this.makeScreenShareConnecting,connected:this.makeScreenShareConnected,ended:this.makeScreenShareEnded,cancelled:this.makeScreenShareCancelled,rejected:this.makeScreenShareRejected,missed:this.makeScreenShareMissed,reconnecting:this.makeScreenShareReconnecting,failed:this.MakeScreenShareFailed}},i=a[e]&&a[e][i];try{i&&i.call(this,e,t)}catch(e){}},B.prototype.playScreenShareStream=function(e){var t=e.stream,i=e.mid,a=(e.endCbk,e.chid),e=this.container.mediaUIHandler;this.initiateHeadshot(a);a=this.states[a];a.screen_share=a.screen_share||{},$.extend(!0,a,{screen_share:{stream:t,type:"viewing",status:"connected"}});try{a.player||(a.player=new A(a,this.siqdom,this.container),e.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_PLAYER_SHOWN,add_info:e.getMediaActivityAddInfo()},mid:i}))}catch(e){}},B.prototype.handleAudioCallInvite=function(e,t){var i=this.container.mediaUIHandler;x[t.chid]=H(t.chid)&&H(t.chid).attendername,"audio"==(e=this.__getType(e))?(this.showAudioCallInvitation(t),this.invitations=!0,i.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_INVITATION_SHOWN,add_info:i.getMediaActivityAddInfo()},mid:t.media_id||t.id})):"screen_share"==e&&this.showScreenShareInvitation(t);t=parent.document.querySelector(".zsiqmico-close");t&&t.click()},B.prototype.clearAudioCallInvite=function(e,t,i){var a=this.container.mediaUIHandler;try{a.isEmbed()&&a.clearConformBox()&&a.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:a.getMediaActivityAddInfo()},mid:t}),"audio"==e&&i&&this.__callTerminate(e,{chid:i,media_id:t,isDirectCall:!1},"rejected")}catch(e){}},B.prototype.showAudioCallInvitation=function(e){var t=e.chid,i=e.rejectCbk,a=e.acceptCbk,n=e.media_id;this.initiateHeadshot(t);e=this.states[t];$.extend(!0,e,{handler:this.handleActionHandler.bind(this),name:N,url:q,chid:t,audio:{mute:!1,media_id:n,reject_cbk:i,accept_cbk:a,is_invited:!0,status:"invited"}}),this.__updateState(t)},B.prototype.handleAudioCallInitiate=function(e,t){var i=this,a=t.chid,n=t.cancelCbk,o=t.muteCbk,s=t.media_id,r=t.isDirectCall,c=this.container.mediaUIHandler;r?(this.states[a]=this.states.directcall,delete this.states.directcall):this.initiateHeadshot(a,r),x[a]=H(a)&&H(a).attendername;var d=this.states[a],t=parent.document.querySelector(".zsiqmico-close");t&&t.click(),$.extend(!0,d,{handler:this.handleActionHandler.bind(this),name:N,url:q,chid:a,audio:{mute:!!r&&d.audio.mute,media_id:s,reject_cbk:n,mute_cbk:function(){o(),$.extend(!0,d,{audio:{mute:!i.states[a].audio.mute}}),i.__updateState(a)},is_invited:!1,status:"requested"}}),this.__updateState(a),c.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_UI_SHOWN,add_info:c.getMediaActivityAddInfo()},mid:s})},B.prototype.initiateDirectCallUI=function(e){function t(){e(),$.extend(!0,o,{audio:{mute:!i.states[a].audio.mute}}),i.__updateState(a)}var i=this,a="directcall";if(e=void 0===e?null:e){var n=this.states[a];return $.extend(!0,n,{audio:{mute:!1,mute_cbk:t,status:"initiated"}}),void this.__updateState(a)}$("#audiorec,#audiocal").remove(),this.initiateHeadshot(a,!0);var o=this.states[a];$.extend(!0,o,{audio:{mute:!1,mute_cbk:t,status:"mediapermission"}}),this.__updateState(a)},B.prototype.makeAudioCallConnecting=function(e,t){var i=this,a=t.chid,n=t.muteCbk,o=t.rejectCbk,s=t.media_id,r=(t.name,t.isDirectCall),c=this.container.mediaUIHandler,d=this.states[a];EmbedSound.stop(),x[t.chid]=H(t.chid).attendername,$.extend(!0,d,{isDirectCall:r,audio:{mute_cbk:function(){n(),$.extend(!0,d,{audio:{mute:!i.states[a].audio.mute}}),i.__updateState(a)},reject_cbk:o,status:"connecting"}}),this.__updateState(a),c.checkCallHostType({chid:a,mid:s,hostType:"downstream"})&&c.sendMediaActivity({param:{action_type:b.activity.MEDIA_AUDIO_UI_SHOWN,add_info:c.getMediaActivityAddInfo()},mid:s}),r&&this.stopSoundNotification()},B.prototype.makeAudioCallConnected=function(e,t){t.media_id;var i=t.chid,a=t.callEndCbk,n=t.isDirectCall,o=this.container.constants.connected;EmbedSound.stop(),this.initiateHeadshot(i),this.ss_invitation[i]&&delete this.ss_invitation[i];var s=this.states[i],t=s.audio.status==o?s.audio.connected_time:(new Date).getTime();$.extend(!0,s,{isDirectCall:n,audio:{reject_cbk:a,status:o,connected_time:t}}),setTimeout(this.startTimer.bind(this,i,e),500),this.__updateState(i)},B.prototype.makeAudioReconnecting=function(e,t){this.__makeReconnecting(e,t)},B.prototype.makeAudioCallEnded=function(e,t){this.__callTerminate(e,t,"ended")},B.prototype.makeAudioCallCancelled=function(e,t){this.__callTerminate(e,t,"cancelled")},B.prototype.makeAudioCallRejected=function(e,t){this.states[t.chid].isDirectCall&&this.container.mediaUIHandler.initMissedChat(t.chid,"CALLENDED","2",!0),this.__callTerminate(e,t,"rejected")},B.prototype.makeAudioCallMissed=function(e,t){this.__callTerminate(e,t,"missed")},B.prototype.makeAudioCallFailed=function(e,t){this.__callTerminate(e,t,"failed")},B.prototype.__recordSound=function(e,t,i,a,n){var o=this,s=this.container.mediaUIHandler,r=s.isChatExist(e),c=s.getAttenderId(e);(s.getSupportRepCount(e)<2&&r&&("rejected"==a&&c==i||"missed"==a)||t)&&(T(this.container,e,q,N,t,L,n),this.__updateState(e),$(".zsiq_media_headshot_main .zsiqmico-close").on("click",function(){return o.__updateState(e)}))},B.prototype.__callTerminate=function(e,t,i){var a=this,n=t.chid,o=t.media_id,s=t.isDirectCall,r=t.lsuid,c=this.container.mediaUIHandler,d=this.states[n],l=d.audio.is_invited;c.checkIsChatEndTimerAlive(n)||c.stopNotifSound(),d&&d.audio?(this.invitations=l?null:this.invitations,$.extend(!0,d,{audio:{status:i}}),"rejected"!=i&&"missed"!=i||s||this.setCallUIposition(".zsiq_media_headshot_main"),setTimeout(function(){var e=d.isDirectCall;delete d.audio,a.__updateState(n),a.__checkAndDestroyInstance(n),l||-1==["rejected","missed"].indexOf(i)||a.__recordSound(n,e,r,i,o),e&&"ended"==i&&a.implementRatingUI(n),e&&"cancelled"==i&&a.directCallCancelled()},500),this.__updateState(n),t=c.checkCallHostType({chid:n,mid:o,hostType:"downstream"})&&["cancelled","rejected","missed"].includes(i)?b.activity.MEDIA_AUDIO_INVITATION_CLEARED:b.activity.MEDIA_AUDIO_UI_CLEARED,c.getActiveTab()&&c.sendMediaActivity({param:{action_type:t,add_info:c.getMediaActivityAddInfo()},mid:o}),s&&(this.stopSoundNotification(),clearTimeout(c.getChatWinObjById(n).waitTimer))):d&&this.__checkAndDestroyInstance(n)},B.prototype.__checkAndDestroyInstance=function(e){try{var t=Object.keys(this.states[e]);0==["audio","screen_share"].filter(function(e){return-1!=t.indexOf(e)}).length&&(this.stopTimer(e),delete this.states[e])}catch(e){}},B.prototype.setCallUIposition=function(e){var t=this.container.mediaUIHandler,i=$(j()).find(e);i[0]&&(e=getComputedStyle(i[0]),i=parseInt(e.getPropertyValue("left"))||0,e=parseInt(e.getPropertyValue("top"))||0,t.setCallUIPosition(e,i))},B.prototype.showScreenShareInvitation=function(e){var t=e.chid,i=e.rejectCbk,a=e.acceptCbk,n=e.media_id,o=this.container.mediaUIHandler;this.initiateHeadshot(t);function s(){o.clearConformBox()&&o.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:n}),a()}function r(e){void 0===e&&(e=!0),o.clearConformBox()&&o.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:n}),e&&i()}var c,d,l={name:N,acceptHandler:s,rejectHandler:r,chid:t};c=l,d=l.name,e=l.acceptHandler,c=l.chid,l=f(g("div",{class:"zsiq_popup",id:"zsiqssconfirmbox"},g("div",{class:"zsiq_popupsub"},g("em",{class:"siqico-close zsiq_center",onClick:l=l.rejectHandler}),g("em",{class:"siqico-screenshare zsiq_popuplogo"}),g("div",{class:"zsiq_popup_hdr"},LSResource.getRealValue("common.screensharerequest")),g("div",{class:"zsiq_popup_desc"},LSResource.getRealValue("screenshare.request.desc",d(c))),g("div",{class:"zsiq_popup_btn zsiq_center"},g("span",{class:"zsiq_center",id:"zsiqconfirmss",onClick:e},LSResource.getRealValue("common.share")),g("span",{class:"zsiq_center zsiq_cancelbtn",id:"zsiqdecliness",onClick:l},LSResource.getRealValue("common.decline")))))),$(j()).append(l),o.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_CONFIRMBOX_SHOWN,add_info:o.getMediaActivityAddInfo()},mid:n}),this.ss_invitation[t]={rejectHandler:r,acceptHandler:s,media_id:n,template:l}},B.prototype.showScreenShareMaking=function(e,t){var i=t.chid,a=t.cancelCbk,n=t.media_id,o=t.ss_type;this.initiateHeadshot(i);t=this.states[i],o=o||(0==this.container.mediaUIHandler.getScreenShareType(i,n)?"sharing":"viewing");$.extend(!0,t,{handler:this.handleActionHandler.bind(this),name:N,url:q,chid:i,screen_share:{media_id:n,reject_cbk:a,status:"requested",type:o}}),this.__updateState(i)},B.prototype.makeScreenShareConnecting=function(e,t){var i=t.chid,a=t.muteCbk,n=t.rejectCbk,o=t.media_id;t.name;x[i]=H(i).attendername,this.initiateHeadshot(i);var s=this.states[i],t=0==this.container.mediaUIHandler.getScreenShareType(i,o)?"sharing":"viewing";$.extend(!0,s,{handler:this.handleActionHandler.bind(this),name:N,url:q,chid:i,screen_share:{media_id:o,mute_cbk:a,reject_cbk:n,status:"connecting",type:t}}),this.__updateState(i)},B.prototype.makeScreenShareConnected=function(e,t){var i=this,a=this.container.mediaUIHandler,n=t.media_id,o=t.chid,s=t.callEndCbk,r=t.ss_type;x[o]=H(o).attendername,this.initiateHeadshot(o);t=this.states[o],r=r||(0==a.getScreenShareType(o,n)?"sharing":"viewing");$.extend(!0,t,{handler:this.handleActionHandler.bind(this),name:N,url:q,screen_share:{reject_cbk:s,status:"connected",connected_time:(new Date).getTime(),type:r,swap_cbk:function(){return i.__swapScreen(a.getActiveMediaID(o),o)}}}),setTimeout(this.startTimer.bind(this,o,e),500),this.__updateState(o)},B.prototype.makeScreenShareReconnecting=function(e,t){this.__makeReconnecting(e,t)},B.prototype.makeScreenShareEnded=function(e,t){this.__ssTerminate(e,t,"ended")},B.prototype.makeScreenShareCancelled=function(e,t){this.__ssTerminate(e,t,"cancelled")},B.prototype.makeScreenShareRejected=function(e,t){this.__ssTerminate(e,t,"rejected")},B.prototype.makeScreenShareMissed=function(e,t){this.__ssTerminate(e,t,"missed")},B.prototype.MakeScreenShareFailed=function(e,t){this.__ssTerminate(e,t,"failed")},B.prototype.__ssTerminate=function(e,t,i){var a=this,n=t.chid,o=(t.media_id,this.states[n]);this.ss_invitation[n]&&(this.ss_invitation[n].rejectHandler(!1),delete this.ss_invitation[n]),o&&o.screen_share?(o&&o.screen_share&&!o.audio&&this.stopTimer(n,e),$.extend(!0,o,{screen_share:{status:i}}),setTimeout(function(){delete o.screen_share,a.__updateState(n),a.__checkAndDestroyInstance(n),a.deletePlayer(n)},500),this.__updateState(n)):o&&this.__checkAndDestroyInstance(n)},B.prototype.showDialog=function(){},B.prototype.enableOutingCallUI=function(){},B.prototype.handleActionHandler=function(e,t,i){i=this.states[e]&&this.states[e][t]&&this.states[e][t][i+"_cbk"];i&&i.call(this)},B.prototype.getTimeDiff=function(e){var t=(new Date).getTime()-e,e=(e=Math.floor(t%36e5/6e4))<10?"0"+e:e,t=(t=Math.floor(t%6e4/1e3))<10?"0"+t:t;return isFinite(e)&&isFinite(t)?e+":"+t:""},B.prototype.startTimer=function(t,e){var i,a=this;this.states[t].timer_ref||(i=this.states[t][e].connected_time,this.states[t].timer_ref=setInterval(function(){var e=a.states[t];$.extend(!0,e,{timer:a.getTimeDiff(i)}),a.__updateState(t)},1e3))},B.prototype.stopTimer=function(e){e=this.states[e];clearInterval(e.timer_ref),delete e.timer,this.__updateState(e.chid)},B.prototype.playSoundNotification=function(e,t){var i=this.container.constants.WAITING_TIME_SECS;this.container.mediaUIHandler.playNotifSound({type:t=void 0===t?"audiocall":t,duration:i,tone:e=void 0===e?"incomingcall":e})},B.prototype.stopSoundNotification=function(){this.container.mediaUIHandler.stopNotifSound()},B.prototype.__updateState=function(e){e=this.states[e];e&&[e.headshot,e.headshotInvite,e.player,e.directCallUI].forEach(function(e){e&&e.updateState()}),this.handleMinimizeState()},B.prototype.__swapScreen=function(t,e){var i=this.container.mediaUIHandler,a=(i.getEncryChid(e),H(e),function(e){"Escape"===e.key&&($(j()).find(".zsiq_media_popup").remove(),window.parent.removeEventListener("keydown",a),i.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t}))}),n=f(g("div",{class:"zsiq_media_popup"},g("span",null,LSResource.getRealValue("screenshare.swap.sharing")),g("div",{class:"zsiq_media_btn"},g("span",{onClick:function(){i.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_SWAP},mid:t}),i.swapScreenShare({chid:e,id:t}),window.parent.removeEventListener("keydown",a),$(n).remove(),i.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t})}},LSResource.getRealValue("common.continue")),g("span",{class:"zsiq_media_cancelbtn",onClick:function(){window.parent.removeEventListener("keydown",a),$(n).remove(),i.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t})}},LSResource.getRealValue("common.cancel")))));$(j()).append(n),i.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_POPUP_SHOWN,add_info:i.getMediaActivityAddInfo()},mid:t}),window.parent.addEventListener("keydown",a),window.parent.focus()},B.prototype.__makeReconnecting=function(e,t){var i=t.chid,t=t.media_id;this.states[i][e="viewing"==this.getCurrentScreenshareType(i)?"screen_share":e].status="reconnecting",this.__updateState(i);e="audio"==e?b.activity.MEDIA_AUDIO_RECONNECT_STATE:b.activity.MEDIA_SCREENSHARE_RECONNECT_STATE;this.container.mediaUIHandler.sendMediaActivity({param:{action_type:e},mid:t})},B.prototype.shareScreen=function(e,t,i){var a=this.container.mediaUIHandler,n=a.getCallStatusByChid(e),n=Object.keys(n)[0];a.sendMediaActivity({param:{action_type:b.activity.MEDIA_SCREENSHARE_SHARESCREEN},mid:n}),a.addScreenShareTrack({chid:e,id:n})},B.prototype.mediaPermissionUI=function(e){var t,i,a=(t=e,e=getBrowserFromUserAgent(navigator.userAgent).split("-")[0],i=f(g("div",{class:"zsiq_prv_main zsiq-cal-turtrp",id:"allowmicbannerui",onClick:function(){return $(i).remove()}},g("div",{class:"zsiq-cal-hnt-cont "+("Chrome"==e?"":"zsiq-"+e)},g("div",{class:"zsiq-trtp-anim"}),g("span",{class:"siqico-arrow zsiq-arrow"}),g("span",{class:"zsiq-alw-mic siqico-mic"}),g("div",{class:"zsiq-alw-mic-desc",html:t?LSResource.getRealValue("voicenotes.info.pleaseallowmicrophone"):LSResource.getRealValue("av.info.pleaseallowmicrophone")})))));return $(j()).append(a),function(){return $(a).remove()}},B.prototype.mediaPermissionUnlock=function(e){var t,i,a,n=(t=e,i=getBrowserFromUserAgent(navigator.userAgent).split("-")[0],a=f(g("div",{class:"zsiq_prv_main zsiq-cal-turtrp",onClick:function(){return $(a).remove()}},g("div",{class:"zsiq-cal-hnt-cont zsiq-isblk "+("Chrome"==i?"":"zsiq-"+i)},g("div",{class:"zsiq-trtp-anim "}),g("span",{class:"siqico-arrow zsiq-arrow"}),g("div",{html:t?LSResource.getRealValue("voicenotes.info.pleasetaponlock","<em class='siqico-lock'></em>"):LSResource.getRealValue("av.info.pleasetaponlock","<em class='siqico-lock'></em>")}),g("p",null,"(",LSResource.getRealValue("common.or"),")"),g("div",null,LSResource.getRealValue("av.info.enablemicrophonesetting")),g("div",{class:"calndr-sedulbtn",style:"",onclick:E}," ",LSResource.getRealValue("chatwindow.mailcopy.clickhere")," ")))));$(j()).append(n),$(j()).find("#allowmicbannerui").remove();e=e?LSResource.getRealValue("voicenotes.info.microphone.blocked"):LSResource.getRealValue("av.info.microphone.blocked");return $UI.showBanner(e,!0,null,8e3),function(){return $(n).remove()}},B.prototype.handleCallClash=function(e,t){e()},B.prototype.handleMinimizeState=function(){var e=this.invitations,t=this.container.mediaUIHandler.getActiveCallData();e||t?($Support.getParent().$ZSIQWidgetUI.updateCallUI(),e?$Support.getParent().$ZSIQWidgetUI.updateIncomingCallUI():$Support.getParent().$ZSIQWidgetUI.removeIncomingCallUI()):$Support.getParent().$ZSIQWidgetUI.removeCallUI()},B.prototype.forceEndCall=function(){var e,t=this.container.mediaUIHandler;for(e in this.states)t.endCallByChid(e),t.triggerIconCheck(e)},B.prototype.implementRatingUI=function(e){var t,i,a=this.container.mediaUIHandler,i=(i=e,f(g("div",{class:"cal-wrap",id:"audiocal"},g("div",{class:"posrel dib-mid"},g("div",{class:"cal-widgt theme1 outcal"},g("div",{class:"posrel usr-imginfo"},g("div",{class:"cal-visimg "},g("img",{src:(t=q)&&t(0,i),alt:"Operator"}))),g("div",{class:"cal-vstrdetl textC"},g("nav",{class:"cal-actvevstr elips font16"},LSResource.getRealValue("av.info.rating")),g("div",{class:"rating font18"},g("span",{class:"reaction_ico sad_icon","data-reaction":"sad",documentclick:"sendCallRating",title:LSResource.getRealValue("common.sad")}),g("span",{class:"reaction_ico neutral_icon","data-reaction":"neutral",documentclick:"sendCallRating",title:LSResource.getRealValue("common.neutral")}),g("span",{class:"reaction_ico happy_icon","data-reaction":"happy",documentclick:"sendCallRating",title:LSResource.getRealValue("common.happy")})),g("p",{class:"c777 font14"},LSResource.getRealValue("ne.rating.byline"))))))));CallImpl.isCallWithChat=a.getEncryChid(e),SiqAVRouter.chatwinobj=a.getChatWinObjById(e),a.getChatWinObjById(e).hideMaskDiv(),JSON.parse($Support.EmbedObj.eprops.reaction[0])?($("#audiorec,#audiocal").remove(),$("body").prepend(i)):this.implementRatingFdbkUI(SiqAVRouter.chatwinobj)},B.prototype.implementRatingFdbkUI=function(e){var t,i,a,n,t=(t=e,i=q,a=N,n=ZSIQConversationManager.getChatWinObjById(t.chatID).RCHID,e=$Support.isSignature($Support.EmbedObj),f(g("div",{class:"cal-wrap",id:"audiocal"},g("div",{class:"adocal-cont dtfix "+w()+" cal-oflne",style:"height:354px;"},M(null,t),g("div",{class:"header"},e?"":g("div",{class:"actbtn"},g("em",{class:"sqico-min siq-minimize-icon",title:LSResource.getRealValue("ne.title.minimize"),documentclick:"min_iframe"})),g("div",{class:"posrel dib-mid"},g("div",{class:"cal-visimg sqico-user"},g("img",{src:i&&i(0,n),alt:a?a(n):"Operator"})),t.rating?g("em",{class:"reaction_ico "+t.rating+"_icon usr-rtng"}):""),g("div",null,g("div",{class:"cal-cmpname font20 fontB"},a(n)))),g("div",{class:"cal-bodycont posrel"},t.rating?g("div",{class:"ofln-msg mT5"}," ",$Support.getReactionIndex(t.rating)," "):""),g("div",{class:"cal-footer",style:"height:70px;"},g("textarea",{class:"bg-f6 font13 c333 lH20",dockeyup:"feedback",dockeydown:"textarea",id:"fdbkarea","data-validate":"required",placeholder:LSResource.getRealValue("av.info.fdkbckmsg"),autofocus:"",style:"overflow: hidden;"}),g("div",{class:"sqico-calsend fdbak-send msg-send",documentclick:"sendCallFb",title:LSResource.getRealValue("embed.submit")}))))));JSON.parse($Support.EmbedObj.eprops.feedback[0])?($($Support.getParent().document.body).find(".siqembed").removeClass("zsiq_size2"),$Support.getParent().$ZSIQWidgetUI.handlefbCall(),$("#audiorec,#audiocal").remove(),$("body").prepend(t)):this.directCallCancelled()},B.prototype.implementFdbkSuccessUI=function(e){var t,i,a,n,t=(t=e,i=q,a=N,n=ZSIQConversationManager.getChatWinObjById(t.chatID).RCHID,e=$Support.isSignature($Support.EmbedObj),f(g("div",{class:"cal-wrap",id:"audiocal"},g("div",{class:"adocal-cont dtfix "+w()+" cal-oflne"},M(null,t),g("div",{class:"header"},e?"":g("div",{class:"actbtn"},g("em",{class:"sqico-min siq-minimize-icon",title:LSResource.getRealValue("ne.title.minimize"),documentclick:"min_iframe"})),g("div",{class:"posrel dib-mid"},g("div",{class:"cal-visimg sqico-user"},g("img",{src:i&&i(0,n),alt:a?a(n):"Operator"})),t.rating?g("em",{class:"reaction_ico "+t.rating+"_icon usr-rtng",title:t.rating}):""),g("div",null,g("div",{class:"cal-cmpname font20 fontB"},a(n)))),g("div",{class:"cal-bodycont posrel"},g("div",{class:"ofln-msg mT5"},LSResource.getRealValue(t.rating?"av.info.ratingandfbk":"faq.feedback")),g("div",{class:"sqico-call bg-grn mT25 mA",title:LSResource.getRealValue("av.info.callagain"),onclick:function(){return parent.$zohosq.call.start()}}))))));$Support.getParent().$ZSIQWidgetUI.handleMinCall(),$("#audiorec,#audiocal").remove(),$("body").prepend(t)},B.prototype.directCallCancelled=function(){$("#audiorec,#audiocal").remove(),$("body").prepend(CallUIHandler.getCallCancelledHtml()),$Support.isSignature($Support.EmbedObj)&&$("div.actbtn").remove(),$($Support.getParent().document.body).find(".siqembed").removeClass("zsiq_size2"),$Support.getParent().$ZSIQWidgetUI.handleMinCall()},B.prototype.deleteScreenShareState=function(e){this.states[e]&&this.states[e].screen_share&&delete this.states[e].screen_share},B.prototype.deletePlayer=function(e){this.states[e]&&this.states[e].player&&(clearTimeout(this.states[e].player.showCntrlTimer),delete this.states[e].player)},B.prototype.clearAllStates=function(e){this.states[e]&&delete this.states[e]},B.prototype.getCurrentScreenshareType=function(e){e=this.states[e];return e&&e.screen_share&&e.screen_share.type?e.screen_share.type:null},B.prototype.getUIPosition=function(e){e=getComputedStyle(this.siqdom.querySelector(e));if(e)return{left:parseInt(e.getPropertyValue("left"))||0,top:parseInt(e.getPropertyValue("top"))||0,bottom:parseInt(e.getPropertyValue("bottom"))||0,right:parseInt(e.getPropertyValue("right"))||0,width:parseInt(e.getPropertyValue("width"))||0,height:parseInt(e.getPropertyValue("height"))||0}};function V(e){this.container=e,this.ajax=new t}V.prototype.post=function(e,t,i,a,n,o,s){void 0===s&&(s="v2"),(n=void 0===n?!1:n)?this._postRequest(e,t,i,a,!0,s):this.request("POST",e,t,i,a)},V.prototype.get=function(e,t,i){this.request("GET",url,e,t,i)},V.prototype.request=function(e,t,i,a,n){t=_SCHEMA+"://"+_EMBEDSERVERURL+"/visitor/v2/"+_SCREENNAME+"/"+t;try{$.ajax({url:t,type:e,data:i,success:a||function(){},error:n||function(){}})}catch(e){}},V.prototype._postRequest=function(e,t,i,a,n,o){e=_SCHEMA+"://"+_EMBEDSERVERURL+"/visitor/"+o+"/"+_SCREENNAME+"/"+e;this.ajax.request({url:e,type:"POST",data:t,rest:n,success:i,error:a})},V.prototype.put=function(e,t,i,a,n,o){void 0===o&&(o="v2");e=_SCHEMA+"://"+_EMBEDSERVERURL+"/visitor/"+o+"/"+_SCREENNAME+"/"+e;this.ajax.request({url:e,type:"PUT",data:t,rest:n,success:i,error:a})};function z(e){this.container=e,this.uiutil=$Support,this.isembed=!0,this.isoldUI=!1}z.prototype.isOldUI=function(){return this.isoldUI},z.prototype.handleEndSession=function(e,t){this.onGoingCallForChat(e)?this.container.commonImpl.endCallByChid(e,t):t()},z.prototype.onGoingCallForChat=function(e){return!!this.container.commonImpl.getCallStatusByChid(e)},z.prototype.getEncryChid=function(e){return $Support.chidmappinglist[e]},z.prototype.isEmbed=function(){return this.isembed},z.prototype.getChatWinObjById=function(e,t){e=(t=void 0===t?!1:t)?e:this.getEncryChid(e);return ZSIQConversationManager.getChatWinObjById(e)},z.prototype.getSupportReps=function(e,t){e=(t=void 0===t?!1:t)?e:this.getEncryChid(e);return SUPPORT_REPS[e]||null},z.prototype.getSupportRepCount=function(e,t){t=this.getSupportReps(e,t=void 0===t?!1:t);return t&&Object.keys(t).length},z.prototype.isGroupConversation=function(e,t){void 0===t&&(t=!1);try{return 1<this.getSupportRepCount(e,t)}catch(e){return!1}},z.prototype.isAttenderBot=function(e,t){return this.getChatWinObjById(e,t=void 0===t?!1:t).isBotChat},z.prototype.isChatExist=function(e,t){return this.getChatWinObjById(e,t=void 0===t?!1:t).isAudioCallAllowed()},z.prototype.getAttenderId=function(e,t){return this.getChatWinObjById(e,t=void 0===t?!1:t).attender},z.prototype.isProactiveChat=function(e,t){return this.getChatWinObjById(e,t=void 0===t?!1:t).proactive},z.prototype.getCurrentUserId=function(){return null},z.prototype.playNotifSound=function(e){var t=e.tone,i=e.duration,a=e.chatid,e=e.isEncrypted,e=!a||this.getChatWinObjById(a,e);a&&e.isSoundOff()||EmbedSound.play(t,i)},z.prototype.stopNotifSound=function(){EmbedSound.stop()},z.prototype.initMissedChat=function(e,t,i,a){e=e?this.getChatWinObjById(e):ZSIQConversationManager.getcurrchatwinobj();delete $Support.requestRunning_missedvisitor,this.uiutil.handleMissed(t,i,a,e),this.uiutil.removeWtimeCookie(e.chatID),delete e.reopenwaiting,$Support.removeBroadCast()},z.prototype.clearPlayer=function(){var e=this.getBody().find(".zsiq_media_videomain");return 0<e.length&&(e.remove(),!0)},z.prototype.clearAudioUI=function(){var e=this.getBody().find(".zsiq_media_headshot_main");e&&e[0]&&"user_busy"!=e[0].id&&e.remove()},z.prototype.clearConformBox=function(){var e=this.getBody().find("#zsiqssconfirmbox");return 0<e.length&&(e.remove(),!0)},z.prototype.clearPopup=function(){var e=this.getBody().find(".zsiq_media_popup");return 0<e.length&&(e.remove(),!0)},z.prototype.clearBusyUI=function(){var e=this.getBody().find("#user_busy");return 0<e.length&&(e.remove(),!0)},z.prototype.getBody=function(){return $(parent.document.body)},z.prototype.triggerAudioCallIcon=function(e,t){var i=$("#audiocall");"show"==t?(this.showAudioCall(),i.removeClass("cmn_disable").show(),i.show().parent().addClass("rgt_ico")):"hide"==t?(this.hideAudioCall(),i.hide().parent().removeClass("rgt_ico")):"disable"==t&&(this.showAudioCall(),i.addClass("cmn_disable"))},z.prototype.showAudioCall=function(){$("#audiocall").show(),$(".callagain-txt").show()},z.prototype.hideAudioCall=function(){$("#audiocall").hide(),$(".callagain-txt").hide()},z.prototype.isAudioCallEnabled=function(){var e="true"==$Support.getParent().$ZSIQChat.getWidgetData().embedobj.isaudiocallallowed,t="true"==$Support.EmbedObj.eprops.isaudiocall;return e&&t},z.prototype.isPlanAllowed=function(){return Licence.verify("audiocall")},z.prototype.isScreenShareAllowed=function(){return CommonUtil.isScreenshareEnabledFromPortal()&&$Support.EmbedObj.eprops.ischannelscreenshare&&Licence.verify("issiqscreenshare")},z.prototype.hasIncomingCall=function(e){var t,i=this.container.commonImpl.getCallStatusByChid(e);for(t in i){var a=i[t];if("audio"==a.type&&"incoming"==a.callType&&"ringing"==a.callStatus)return!0}return!1},z.prototype.isActiveBySSType=function(e){var t={isActive:!1,id:null},i=this.container.commonImpl.getActiveCallData();if(!i)return t;if(i==e){var a,n=this.container.commonImpl.getCallStatusByChid(i);for(a in n){var o=n[a].type,s=n[a].id;if("screen_share"==o)return t.isActive=!0,t.id=s,t}}return t},z.prototype.isShareScreenAllowed=function(e){if(!this.container.commonImpl.currentUserBrowserSupportSS())return!1;var t=this.isActiveBySSType(e),i=t.isActive,t=t.id;return 0!=this.container.screen_shareImpl.getScreenShareType(e,t)||!i},z.prototype.checkIsSSOnGoing=function(e,t){var i=this.container.commonImpl.getActiveCallData();return!!i&&(i!=e||(t==b.screen_share?this.isShareScreenAllowed(e):t==b.screen_view?this.isRequestScreenShareAllowed(e):void 0))},z.prototype.isSecureConnection=function(){return-1<window.location.protocol.indexOf("https")||-1<window.location.protocol.indexOf("file:")},z.prototype.isAudioRecordingSupported=function(){return window.AudioContext=window.AudioContext||window.webkitAudioContext,window.URL=window.URL||window.webkitURL,navigator.getUserMedia=this.container.MediaPermission.getUserMediaDetail(),window.AudioContext&&navigator.getUserMedia&&window.URL&&window.Worker||(support=!1),!0},z.prototype.closeViewMediaPermission=function(){$(window.parent.document).find("body").find(".zsiq_prv_main").remove()},z.prototype.isliveChatWindow=function(){return"msgarea"==$Support.container.attr("cwview")},z.prototype.isFaceBookIntegration=function(){return-1<window.location.href.lastIndexOf("facebook.ext")},z.prototype.getVisitorWMSID=function(){return this.uiutil.EmbedObj.vwmsid},z.prototype.getDecodedText=function(e){return"function"==typeof getDecodedText?getDecodedText(e):e},z.prototype.getEscapedText=function(e){return"function"==typeof getEscapedText?getEscapedText(e):e},z.prototype.getVisitorID=function(e){},z.prototype.getVisitorBrowser=function(e){},z.prototype.getVisitorPage=function(e){},z.prototype.isMobileVisitor=function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB10|IEMobile|Opera Mini/i.test(navigator.userAgent)},z.prototype.isIOSSDKVisitor=function(e){},z.prototype.isChatMonitor=function(e){return!1},z.prototype.getCurretUserLSUID=function(){},z.prototype.I18N=function(e){},z.prototype.getChatAttender=function(e){},z.prototype.isVisitorOnline=function(e){},z.prototype.isOngoingChat=function(e){return!1},z.prototype.checkBrowserSupported=function(e,t){},z.prototype.addVisitorDetail=function(e){},z.prototype.pickupsupport=function(e){},z.prototype.endSession=function(e){e=e?this.getChatWinObjById(e):ZSIQConversationManager.getcurrchatwinobj();$Support.quitChat(e)},z.prototype.getChatIdByVisitorId=function(e){},z.prototype.isScreenShareEnabled=function(){},z.prototype.sendDebugLogger=function(e){},z.prototype.removeAudioCallIcon=function(e){},z.prototype.isAllowedForCurrTab=function(e,t){},z.prototype.isVisitorBrowserSupported=function(e){},z.prototype.getVisitorOS=function(e){},z.prototype.triggerIconCheck=function(e){try{this.container.audioImpl.audioIconStatus(e,this.triggerAudioCallIcon.bind(this))}catch(e){}},z.prototype.focusChatWindow=function(e){},z.prototype.joinChat=function(e){},z.prototype.canShowAudioCallInvitation=function(e){return!0},z.prototype.endCall=function(e,t){this.container.commonImpl.endCallByChid(e,t)},z.prototype.isAudioCallDisabled=function(){return!1},z.prototype.handleCallInitiate=function(e){this.clearChatEndTimer(e),this.triggerRecorderIcon("disable")},z.prototype.handleCallEnded=function(e){this.triggerRecorderIcon("show")},z.prototype.handleCallCancelled=function(e){this.triggerRecorderIcon("show")},z.prototype.handleCallRejected=function(e){this.triggerRecorderIcon("show")},z.prototype.handleCallMissed=function(e){this.triggerRecorderIcon("show")},z.prototype.handleCallFailed=function(e){this.triggerRecorderIcon("show")},z.prototype.handleIncomingCall=function(e){this.clearChatEndTimer(e),this.triggerRecorderIcon("disable")},z.prototype.handleIncomingAccept=function(e){this.clearChatEndTimer(e)},z.prototype.handleOutgoingAccept=function(e){this.clearChatEndTimer(e)},z.prototype.isCallInitiatedFromOldUI=function(e){return this.container.commonImpl.getIsCallInitiatedFromOldUI(e)},z.prototype.isMobileOperator=function(e){return this.container.commonImpl.getIsMobileOperator(e)},z.prototype.checkIsChatEndTimerAlive=function(e){e=this.getChatWinObjById(e);return e&&e.endtimer},z.prototype.clearChatEndTimer=function(e){var t=this.getChatWinObjById(e.chid);this.checkIsChatEndTimerAlive(e.chid)&&($Support.clearEndTimer(t),this.stopNotifSound())},z.prototype.isTabFocused=function(){return parent.document.hasFocus()},z.prototype.getSessionID=function(){return getSid()},z.prototype.getMediaActivityAddInfo=function(){return+this.isTabFocused()+" | "+this.getSessionID()},z.prototype.isMediaRecordingEnabledForChat=function(e){return $Support.EmbedObj.eprops.call_recording},z.prototype.removeAudioPlayers=function(){$(".siqmediaaudioplayer").remove()},z.prototype.isCurrentChatQueued=function(){var e=ZSIQConversationManager.getcurrchatwinobj();return!(!e||!e.queueTimer)},z.prototype.showEmbedBanner=function(e,t,i){var a=ZSIQConversationManager.getcurrchatwinobj();this.isEmbed()&&a&&a.RCHID==i&&$UI.showBanner(LSResource.getRealValue(e),!0,null,t)},z.prototype.triggerRecorderIcon=function(e){"show"==e?$(document).ready(function(){$('span[id="zsiq-voicenote"').removeClass("cmn_disable").show(),$('span[id="zsiq-voicenote"').removeAttr("disabled")}):"disable"==e&&$(document).ready(function(){$('span[id="zsiq-voicenote"').addClass("cmn_disable"),$('span[id="zsiq-voicenote"').attr("disabled","")})},z.prototype.isRecordingON=function(){return window.currentRecorder&&window.currentRecorder.isRecording()&&window.currentRecorder.isVoiceNote()},z.prototype.hasAudioCallInvitation=function(){return this.container.dataHandler.data.media_inv&&this.container.dataHandler.data.media_inv.length};function W(e){this.container=e,this.init(e),this.data={}}W.prototype.init=function(e){this.audio_impl=e.audioImpl,this.audio_unified_mix_impl=e.audioImpl,this.video_impl=e.videoImpl,this.screen_share_impl=e.screenShareImpl,this.screen_view_impl=e.screen_viewImpl,this.screen_share_smart_impl=e.screen_viewImpl,this.screen_view_smart_impl=e.screenShareImpl,this.common_impl=e.commonImpl},W.prototype.handle=function(e){this.data=e.param,this.route()},W.prototype.route=function(){var e=this.container,t=e.constants,i=e.commonImpl,a=e.uiHandler,n=this.data.msg.media||this.data.msg,o=n.type,s=n.chatid,r=n.chid,e=n.id;n.negotiationType,n.datamode;s||(this.data.msg.chatid=s=s||r);n=this.data.msg,r=n.operation,n.cbtype;i.setWmsPushData(e,this.data.msg.media||this.data.msg),this.checkIsCurrentTab()||-1!=[t.call_initiate,t.call_cancel,t.call_miss,t.call_failed,"invite",t.cancel,t.reject,t.miss].indexOf(r)||-1!=["offer"].indexOf(r)&&"screen_share_smart"==o?c(r=(t=this.getController())&&t[this.getHandler()])&&(r.call(t,e),i.sendMediaStats(this.data,null)):(a.clearAudioCallInvite(o,e,s),this.container[o+"Impl"].clearData(e),Sound.stop())},W.prototype.checkIsCurrentTab=function(){return this.container.commonImpl.getActiveTab()},W.prototype.getController=function(){var e=this.data.msg.media||this.data.msg,t=e.type;e.chatid,e.id;return"audio_unified_mix"==t?t="audio":"screen_share_smart"!=t&&"screen_view_smart"!=t||(t="screen_share"),this[(e.negotiationType||t)+"_impl"]},W.prototype.getHandler=function(){var e=this.getStatus(),t=this.getOperations(),i=this.getCBTypes(),a=this.__getConfOperationKeys();return e||t||a||i},W.prototype.__getConfOperationKeys=function(){var e=this.container.constants,t=this.data.msg,t=(t.cbtype,t.statusType,t.operation);return{credential:"handleUnifiedCallCredentail",initiate:"handleInvitation",accept:"handleUnifiedCallAccept",reject:"handleCallReject",candidates:"handleCandidates",answer:"handleUnifiedCallAnswer",offer:"handleUnifiedCallOffer",cancel:"handleCallCancel",miss:"handleCallMissed",invite:e.handleInvitation,request:"handleCallRequest",answer_received:"handleCallAnswerReceived",connected:"handleUnifiedCallConnected",end:"handleUnifiedCallEnd"}[t]},W.prototype.getOperations=function(){var e=this.container.constants,t=this.data.msg,t=(t.cbtype,t.statusType,t.operation);return{call_credential:e.setCredential,call_initiate:e.handleInvitation,call_accept:e.handleCallAccept,call_reject:e.handleCallReject,call_candidates:e.handleCandidates,call_answer:e.handleCallAnswer,call_end:e.handleCallEnd,call_offer:e.handleCallOffer,call_cancel:e.handleCallCancel,call_miss:e.handleCallMissed,call_invite:e.handleCallInvite,call_request:e.handleCallRequest,call_failed:e.handleCallFailed}[t]},W.prototype.getCBTypes=function(){var e=this.container.constants,t=this.data.msg;t.cbtype,t.statusType,t.operation;return{credential:e.setCredential,invite:e.handleInvitation,reject:e.handleCallReject,candidate:e.handleCandidates,answer:e.handleCallAnswer,offer:e.handleCallOffer,cancel:e.handleCallCancel,miss:e.handleCallMissed,invite:e.handleCallInvite}},W.prototype.getStatus=function(){var e=this.container.constants,t=this.data.msg,i=(t.cbtype,t.statusType);t.operation;return{accept:e.handleCallAccept,end:e.handleCallEnd}[i]};function F(e){this.container=this.container}F.prototype.getEventsMap=function(){return{mute:"",end_media:"",sharescreen:"",shareaudio:"",stop_audio:"",stop_screenshare:""}};function G(e){this.container=e,this.init(e)}G.prototype.handle=function(){},G.prototype.init=function(e){};function K(e){this.conatiner=e}K.prototype.handle=function(){};function Q(e){((this.container=e).MediaPermission=this).isSupported=void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia,this.displayMediaSupported=this.isSupported&&navigator.mediaDevices.getDisplayMedia&&void 0!==navigator.mediaDevices.getDisplayMedia,this.init(),this.getmediaDevices(this.updateMediaDevices.bind(this),null)}Q.prototype.init=function(){this.type={audio:"audio",video:"video",audio_video:"audio_video",screen:"screen_share"},this.streamType={audio:1,video:2,screen:3,audio_video:4},this.streamTypeInString={1:"audio",2:"video",3:"screen_share",4:"audio_video"},this.devicesType={audioInput:"audioinput",videoInput:"videoinput",audioOutput:"audiooutput"}},Q.prototype.isDisplayMediaSupported=function(){return this.displayMediaSupported},Q.prototype.updateMediaDevices=function(e){this.devicesArray=e;var t,i=[],a=[],n=[];for(t in this.devicesArray){var o=this.devicesArray[t];o.kind==this.devicesType.audioInput?i.push(o):o.kind==this.devicesType.videoInput?n.push(o):o.kind==this.devicesType.audioOutput&&a.push(o)}this.availableDevices={audioInput:i,videoInput:n,audioOutput:a}},Q.prototype.getAvailableDevices=function(){return this.availableDevices},Q.prototype.getmediaDevices=function(t,e){void 0!==navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then(function(e){return t(e)})},Q.prototype.updatePreferredDevice=function(e){this.preferredDevice||(this.preferredDevice={}),this.preferredDevice[e.kind]=e},Q.prototype.updatePreferredDeviceByDeviceId=function(e,t){for(var i={},a=0;a<this.availableDevices[t].length;a++)this.availableDevices[t][a].deviceId==e&&(i=this.availableDevices[t][a]);this.updatePreferredDevice(i)},Q.prototype.getPreferredDevice=function(e){return this.preferredDevice?this.preferredDevice[e]:null},Q.prototype.getAudioInputDevices=function(){return this.availableDevices.audioInput},Q.prototype.getVideoInputDevices=function(){return this.availableDevices.videoInput},Q.prototype.getAudioOutputDevices=function(){return this.availableDevices.audioOutput},Q.prototype.getMediaConstraints=function(e,t){var i={},a=!0,n=!0,o=this.getPreferredDevice(this.devicesType.audioInput),s=this.getPreferredDevice(this.devicesType.videoInput);return o&&(a={deviceId:{exact:o.deviceId}}),s&&(n={deviceId:{exact:s.deviceId}}),i=Object.assign({},{audio:a,video:n},t),e==this.type.audio?i.video=!1:e!=this.type.video&&e!=this.type.screen||(i.audio=!1),i},Q.prototype.getDeskTopScreen=function(i,a,n,e,t,o){var s=this,r=this.container.constants;SalesIQDesktopIPC.getMediaInstance().getSources({types:[r.window,r.screen]}).then(function(e){for(var t in e)if(e[t].name===r.Entire_Screen)try{navigator.mediaDevices.getUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:r.desktop,chromeMediaSourceId:e[t].id}}}).then(function(e){s.streams[i]=e,typeof o!==r.function||(e=e._getPrimaryVideoTrack())&&(e.onended=o),a()})}catch(e){n(e,i)}})},Q.prototype.requestStream=function(t,i,a,e,n,o){var s=this,r=null;this.streams?r=this.streams[t]:this.streams=[],r&&t!=this.type.screen?i():this.isDesktopApp()&&t==this.type.screen?this.getDeskTopScreen(t,i,a,e,n,o):(n=n?navigator.mediaDevices.getDisplayMedia:navigator.mediaDevices.getUserMedia,e=this.getMediaConstraints(t,e),n.call(navigator.mediaDevices,e).then(function(e){s.setType(e,t),s.streams[t]=e,"function"!=typeof o||(e=e._getPrimaryVideoTrack())&&(e.onended=o),i()}).catch(function(e){a(e,t)}))},Q.prototype.getAudioStream=function(e,t,i,a){this.requestStream(this.type.audio,e,t,i,!1,a)},Q.prototype.getVideoStream=function(e,t,i,a){this.requestStream(this.type.video,e,t,i,!1,a)},Q.prototype.getScreenShareStream=function(e,t,i,a){this.displayMediaSupported?this.requestStream(this.type.screen,e,t,i,!0,a):(i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:sourceId}}},this.requestStream(this.type.screen,e,t,i,!1,a))},Q.prototype.getStreamByType=function(e){return this.streams?this.streams[e]:null},Q.prototype.getScreenSharePermissionWithAudio=function(){},Q.prototype.getAudioPermission=function(e,t){this.getPermission(this.type.audio,e,t)},Q.prototype.getVideoPermission=function(e,t){this.getPermission(this.type.video,e,t)},Q.prototype.getPermission=function(e,t,i){navigator.permissions.query({name:e}).then(function(e){"function"==typeof t&&t(e.state)}).catch(function(e){"function"==typeof i&&i(e)})},Q.prototype.setType=function(e,t){var i="";return(i=!e.salesiq?e.salesiq={}:i)._type=t,i},Q.prototype.getTypeFromStream=function(e){return e&&e.salesiq&&e.salesiq._type?e.salesiq._type:null},Q.prototype.closeAllStream=function(){for(var e in this.streams)this.closeStream(e)},Q.prototype.closeStreamByType=function(e){this.closeStream(e)},Q.prototype.closeStream=function(e){var t=this.streams?this.streams[e]:null;if(t){var i,a=t.getTracks();for(i in a)a[i].stop();this.streams[e]=null}},Q.prototype.toggleMute=function(){var e=this.streams[this.type.audio];e.getAudioTracks()[0].enabled=!e.getAudioTracks()[0].enabled,this.container.commonImpl.sendMediaActivity({param:{action_type:e.getAudioTracks()[0].enabled?b.activity.MEDIA_AUDIO_UNMUTE:b.activity.MEDIA_AUDIO_MUTE}})},Q.prototype.screenEndFromBrowserUI=function(e){this.isDesktopApp()||(this.streams[this.type.screen].getVideoTracks()[0].onended=function(){e()})},Q.prototype.getUserMediaDetail=function(){return navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||null},Q.prototype.getTracksId=function(){var e,t={};for(e in this.streams)t[e]=this.streams[e]&&this.streams[e].id;return t},Q.prototype.isDesktopApp=function(){return navigator.userAgent.includes(this.container.constants.Zoho_SalesIQ)};function Z(e){this.container=e,this.userAgent=navigator.userAgent,this.browserName=null,this.browserVersion=null,this.browserSupported=!1,this.browserSupportedForStats=!1,(e.MediaDetails=this).platform=navigator.platform,this.setBrowserName()}Z.prototype.setBrowserName=function(){var e,t,i,a,t=(e=this.userAgent,t="unknown-unknown",-1<(a=(i=e).toLowerCase()).indexOf("msie")?t=(e=i.substring(i.indexOf("MSIE")).split(";")[0]).split(" ")[0].replace("MSIE","IE")+"-"+e.split(" ")[1]:-1<a.indexOf("edge")?t=i.substring(i.indexOf("Edge")).split(" ")[0].replace("/","-"):-1<a.indexOf("safari")&&-1<a.indexOf("version")?t=i.substring(i.indexOf("Safari")).split(" ")[0].split("/")[0]+"-"+i.substring(i.indexOf("Version")).split(" ")[0].split("/")[1]:-1<a.indexOf("opr")||-1<a.indexOf("opera")?-1<a.indexOf("opera")?t=i.substring(i.indexOf("Opera")).split(" ")[0].split("/")[0]+"-"+i.substring(i.indexOf("Version")).split(" ")[0].split("/")[1]:-1<a.indexOf("opr")&&(t=i.substring(i.indexOf("OPR")).split(" ")[0].replace("/","-").replace("OPR","Opera")):-1<a.indexOf("chrome")?t=i.substring(i.indexOf("Chrome")).split(" ")[0].replace("/","-"):-1<a.indexOf("firefox")&&(t=i.substring(i.indexOf("Firefox")).split(" ")[0].replace("/","-")),[t,parseInt(t.split("-")[1])]);this.browserName=t[0],this.browserVersion=t[1]},Z.prototype.getBrowserName=function(){return this.browserName},Z.prototype.getBrowserVersion=function(){return this.browserVersion},Z.prototype.checkBrowserSupported=function(e){var t=this.browserName.split("-")[0].toLowerCase();this.browserSupported=!1;e=!e||e==b.audio?b.audioCallAllowedBrowserVersions:b.screenShareAllowedBrowserVersions;return this.browserSupported=e[t]&&this.browserVersion>=e[t],this.browserSupported},Z.prototype.checkBrowserSupportedForStats=function(){var e=this.browserName.split("-")[0];return this.browserSupportedForStats=!1,"Chrome"!=e&&"Opera"!=e||(this.browserSupportedForStats=!0),this.browserSupportedForStats},Z.prototype.getPlatform=function(){return this.platform},Z.prototype.getClientSupport=function(){var e=this.container.MediaPermission,t={perfect_renegotiation:!0,multi_stream:!0,reconnection_policy:!0};return this.__isChrome()||this.__isSafari()||this.__isOpera()?e.displayMediaSupported||(t={perfect_renegotiation:!1,multi_stream:!1,reconnection_policy:!0}):this.__isFirefox()&&(t.perfect_renegotiation=!1),t},Z.prototype.__isChrome=function(){return"Chrome"==this.browserName.split("-")[0]},Z.prototype.__isFirefox=function(){return"Firefox"==this.browserName.split("-")[0]},Z.prototype.__isSafari=function(){return"Safari"==this.browserName.split("-")[0]},Z.prototype.__isOpera=function(){return"Opera"==this.browserName.split("-")[0]},Z.prototype.isNotebookDSKApp=function(){return this.userAgent.includes("Notebook")},Z.prototype.isSecure=function(){return-1<window.location.protocol.indexOf("https")};function X(e){this.data={},this.container=e,this.unique="SiqMedia_",e.dataHandler=this}X.prototype.get=function(e,t){this.getLocalKey(e);return this.data[e]},X.prototype.set=function(e,t,i){this.getLocalKey(e);this.data[e]=t},X.prototype.remove=function(e,t){this.getLocalKey(e);this.data[e]&&delete this.data[e]},X.prototype.getLocalKey=function(e){return this.unique+e};function Y(e){(e.router=this).container=e,this.init(e)}Y.prototype.init=function(e){this.rtc_router=new W(e),this.event_router=new F,this.media_router=new G(e),this.action_router=new K(e),this.MediaPermission=new Q(e),this.dataHandler=new X(e),this.MediaDetails=new Z(e),this.container.constants=b},Y.prototype.route=function(e){if(!this.validateRouteObject(e))throw"Media Router Schema Mismatch";this.handle(e)},Y.prototype.handle=function(e){try{var t=this[e.type+"_router"];t&&t.handle&&t.handle(e)}catch(e){}},Y.prototype.validateRouteObject=function(t){var i={type:"string",module:"string",useCase:"string",param:"object"},a=!0;return Object.keys(i).forEach(function(e){t[e]&&typeof t[e]==i[e]||(a=!1)}),a};function J(e){(e.LSRouter=this).container=e,this.init()}J.prototype.init=function(){var e=this,t=this;this.routes={0:function(){return e.container.checkDirectCallOnload()},2:t.handleCustomMessage(),29:t.handleAVcall.bind(t),13:t.handleUserStatus.bind(t),113:t.chatEnded.bind(t),35:t.chatEnded.bind(this),114:t.handleInfoMessage.bind(this),14:t.checkForCallIcon.bind(this),15:t.checkForCallIcon.bind(this)}},J.prototype.chatEnded=function(e){var t=e.msg.chid;this.container.detailsHandler.getBody().find(".zsiq_media_headshot_main").remove(),this.container.mediaUIHandler.clearAudioCallInvite(t),this.checkForCallIcon(e),this.container.detailsHandler.clearBusyUI(),"content_moderation_end"==e.msg.msg.action&&this.endSupport(e)},J.prototype.handleMessage=function(e){var t,i,a=this.routes,n=typeof a[e.mtype];try{"function"==n?a[e.mtype].call(this,e):"object"==n&&(t=this.getModuleName(e),"function"==typeof(i=a[e.mtype][t])&&i.call(this,e))}catch(e){}},J.prototype.handleCustomMessage=function(e){return{addvisitor:this.showInvitation,acctranschat:this.endCall,closetransfer:this.checkForCallIcon,pickupsupport:this.handlePicksupport,leavesupport:this.endSupport,missedvisitor:this.missedDirectCall,joinsupport:this.joinsupport}},J.prototype.handlePicksupport=function(e){var t=e.msg,i=LSMessanger.getPrd()+"_"+$Support.getParent().$ZSIQWidget.getEmbedObject().pinfo.soid+"_"+t.attender;try{for(var a in SUPPORT_REPS[t.chid])a!=i&&delete SUPPORT_REPS[t.chid][a]}catch(e){}this.checkForCallIcon(e)},J.prototype.handleAVcall=function(e){e.msg.msg=JSON.parse(e.msg.msg),e.msg.msg.media?(e.msg.msg.media=JSON.parse(e.msg.msg.media),this.container.router.route({type:"rtc",module:e.msg.msg.media.type,useCase:e.msg.msg.cbtype||e.msg.msg.operation,param:e.msg})):this.handleCallConfernce(e)},J.prototype.handleCallConfernce=function(e){e.msg.msg;this.container.router.route({type:"rtc",module:e.msg.msg.type,useCase:e.msg.msg.operation,param:e.msg})},J.prototype.getModuleName=function(t){return{2:"msg > module",114:"msg > msg > mode",700:"msg > msg > module"}[t.mtype].trim().split(/\s*\>\s*/g).forEach(function(e){return t=t[e]}),t},J.prototype.showInvitation=function(e){try{var t=e.msg,i=t.media;if(!i)return;var a,n,o="";for(n in i)o=(a=JSON.parse(i[n])).type;this.container.commonImpl.setWmsPushData(a.id,t),this.container[o+"Impl"].handleApiCallInvitation(a.id)}catch(e){}},J.prototype.missedDirectCall=function(e){var t=this.container,i=t.detailsHandler,a=t.commonImpl,n=e.msg,o=n.media;if(o)for(var s in o){var r=JSON.parse(o[s]),c=r.type,s=r.id,r=i.getChatIdByVisitorId(n.visitorid);a.setWmsPushData(s,{chatid:r,id:s,type:c}),this.container[c+"Impl"].handleCallCancel(s)}},J.prototype.checkForCallIcon=function(e){var t=this.container,e=e.msg,e=e.chatid||e.chid;e==ZSIQConversationManager.getcurrchatwinobj().RCHID&&t.detailsHandler.triggerIconCheck(e),t.detailsHandler.isGroupConversation(e)&&this.container.detailsHandler.clearBusyUI()},J.prototype.endSupport=function(e){var t,i=this.container,a=i.detailsHandler,n=i.commonImpl,o=i.mediaUIHandler,s=i.MediaPermission,r=i.screenShareImpl,c=i.audioImpl,d=i.constants,e=e.msg,l=e.chatid||e.chid,p=n.getCallStatusByChid(l);for(t in p){var u=p[t],h=u.type,m=u.id,u={type:h,chid:l,media_id:m};n.setWmsPushData(m,{chatid:l,type:h}),o.updateCallInvitationState(h,u,d.ended),o.clearAudioCallInvite(h,m),r.handleAudioCallEnd(l),c.handleAudioCallEnd(m),this.container[h+"Impl"].clearData(m)}s.closeAllStream(),a.removeAudioCallIcon(l),n.stopNotificationSound(),n.checkAndPlayNotification()},J.prototype.disableAvIcons=function(){},J.prototype.endCall=function(e){try{var t=this.container,i=e.msg,a=i.chatid||i.chid;t.commonImpl.endCallByChid(a),this.checkForCallIcon(e)}catch(e){}},J.prototype.handleUserStatus=function(e){this.checkForCallIcon(e)},J.prototype.joinsupport=function(e){this.checkForCallIcon(e),this.container.commonImpl.checkOnGoingCall()},J.prototype.handleInfoMessage=function(e){this.checkForCallIcon(e),"acctranschat"==e.msg.module&&this.container.detailsHandler.clearBusyUI()};function ee(e){this.container=e}ee.prototype.handleAudioCallInvite=function(e,t){this.container.uiHandler.handleAudioCallInvite(e,t)},ee.prototype.handleAudioCallInitiate=function(e,t){this.container.uiHandler.handleAudioCallInitiate(e,t)},ee.prototype.clearAudioCallInvite=function(e,t){this.container.uiHandler.clearAudioCallInvite(e,t)},ee.prototype.updateCallInvitationState=function(e,t,i){this.container.uiHandler.updateCallInvitationState(e,t,i)},ee.prototype.mediaPermissionUI=function(e){return this.container.uiHandler.mediaPermissionUI(e)},ee.prototype.mediaPermissionUnlock=function(e){return this.container.uiHandler.mediaPermissionUnlock(e)},ee.prototype.showDialog=function(e){this.container.uiHandler.showDialog(e)},ee.prototype.handleCallClash=function(e,t){this.container.uiHandler.handleCallClash(e,t)},ee.prototype.deleteScreenShareState=function(e){this.container.uiHandler.deleteScreenShareState(e)},ee.prototype.showScreenShareInvitation=function(e){this.container.uiHandler.showScreenShareInvitation(e)},ee.prototype.makeScreenShareConnected=function(e,t){this.container.uiHandler.makeScreenShareConnected(e,t)},ee.prototype.makeScreenShareConnecting=function(e,t){this.container.uiHandler.makeScreenShareConnecting(e,t)},ee.prototype.showScreenShareMaking=function(e,t){this.container.uiHandler.showScreenShareMaking(e,t)},ee.prototype.playScreenShareStream=function(e){this.container.uiHandler.playScreenShareStream(e)},ee.prototype.getCurrentScreenshareType=function(e){return this.container.uiHandler.getCurrentScreenshareType(e)},ee.prototype.stopTimer=function(e){this.container.uiHandler.stopTimer(e)},ee.prototype.clearAllStates=function(e){this.container.uiHandler.clearAllStates(e)},ee.prototype.getUIState=function(){return this.container.uiHandler},ee.prototype.enableOutingCallUI=function(){this.container.uiHandler.enableOutingCallUI()},ee.prototype.deletePlayer=function(e){this.container.uiHandler.deletePlayer(e)},ee.prototype.directCallCancelled=function(){this.container.uiHandler.directCallCancelled()},ee.prototype.getAvailableDevices=function(){return this.container.MediaPermission.getAvailableDevices()},ee.prototype.updateMediaDevices=function(e){this.container.MediaPermission.updateMediaDevices(e)},ee.prototype.startAudioCall=function(e){this.container.audioImpl.startAudioCall(e)},ee.prototype.__isSmartFlow=function(e){var t=this.container,i=t.commonImpl,e=(t.screen_share_smartImpl,t.audioImpl,i.getCallStatusData(e));return!(!e.type.includes("unified")&&!e.type.includes("smart"))},ee.prototype.initCallRequest=function(e){this.__isSmartFlow(e.mid)&&(e.negotiationType==b.screen_share&&(e.negotiationType=b.screen_share_smart),e.negotiationType==b.audio&&(e.negotiationType=b.audio_unified_mix)),this.container.audioImpl.initCallRequest(e)},ee.prototype.addScreenShareTrack=function(e){this.__isSmartFlow(e.id)?this.addScreenTrackInConference():this.container.audioImpl.addScreenShareTrack(e)},ee.prototype.addScreenTrackInConference=function(){this.container.screen_share_smartImpl.addScreenTrackInConference()},ee.prototype.getAudioInputDevice=function(){return this.container.audioImpl.getAudioInputDevice()},ee.prototype.getAudioOutputDevice=function(){return this.container.audioImpl.getAudioOutputDevice()},ee.prototype.changeAudioPlayer=function(e,t){var i=this.container.commonImpl.getActiveMediaID(t);this.__isSmartFlow(i)?this.container.audioImpl.changeUnifiedAudioPlayer(e,i):this.container.audioImpl.changeAudioPlayer(e,t)},ee.prototype.changeAudioInputDevice=function(e,t,i){var a=this.container.commonImpl.getActiveMediaID(t);this.__isSmartFlow(a)?this.container.audioImpl.changeUnifiedAudioInputDevice(e,a,i):this.container.audioImpl.changeAudioInputDevice(e,t,i)},ee.prototype.isWaitingForPermission=function(){return this.container.audioImpl.isWaitingForPermission},ee.prototype.getScreenShareType=function(e,t){return this.container.screenShareImpl.getScreenShareType(e,t)},ee.prototype.handleUIRequestCancel=function(e,t,i){this.container.screenShareImpl.handleUIRequestCancel(e,t,i)},ee.prototype.swapScreenShare=function(e){var t=this.container,i=t.commonImpl,t=t.screenShareImpl,i=i.getCallStatusData(e.id);i.type.includes("unified")||i.type.includes("smart")?t.swapUnifiedScreenShare(e):t.swapScreenShare(e)},ee.prototype.startScreenShare=function(e){this.container.screenShareImpl.startScreenShare(e)},ee.prototype.sendMediaActivity=function(e){this.container.commonImpl.sendMediaActivity(e)},ee.prototype.checkCallHostType=function(e){return this.container.commonImpl.checkCallHostType(e)},ee.prototype.getActiveTab=function(){return this.container.commonImpl.getActiveTab()},ee.prototype.getCallUIPosition=function(){return this.container.commonImpl.getCallUIPosition()},ee.prototype.setCallUIPosition=function(e,t){this.container.commonImpl.setCallUIPosition(e,t)},ee.prototype.removeCallUIPosition=function(){this.container.commonImpl.removeCallUIPosition()},ee.prototype.getActiveMediaID=function(e){return this.container.commonImpl.getActiveMediaID(e)},ee.prototype.getCallStatusByChid=function(e){return this.container.commonImpl.getCallStatusByChid(e)},ee.prototype.getActiveCallData=function(){return this.container.commonImpl.getActiveCallData()},ee.prototype.endCallByChid=function(e){this.container.commonImpl.endCallByChid(e)},ee.prototype.isOldUI=function(){return this.container.detailsHandler.isOldUI()},ee.prototype.isEmbed=function(){return this.container.detailsHandler.isEmbed()},ee.prototype.isAudioCallEnabled=function(){return this.container.detailsHandler.isAudioCallEnabled()},ee.prototype.isScreenShareEnabled=function(){return this.container.detailsHandler.isScreenShareEnabled()},ee.prototype.isScreenShareAllowed=function(){return this.container.detailsHandler.isScreenShareAllowed()},ee.prototype.isCallInitiatedFromOldUI=function(e){return this.container.detailsHandler.isCallInitiatedFromOldUI(e)},ee.prototype.isMobileOperator=function(e){return this.container.detailsHandler.isMobileOperator(e)},ee.prototype.isMobileVisitor=function(e){return this.container.detailsHandler.isMobileVisitor(e)},ee.prototype.getChatWinObjById=function(e){return this.container.detailsHandler.getChatWinObjById(e)},ee.prototype.getDecodedText=function(e){return this.container.detailsHandler.getDecodedText(e)},ee.prototype.getEscapedText=function(e){return this.container.detailsHandler.getEscapedText(e)},ee.prototype.getBody=function(){return this.container.detailsHandler.getBody()},ee.prototype.getMediaActivityAddInfo=function(){return this.container.detailsHandler.getMediaActivityAddInfo()},ee.prototype.clearConformBox=function(){this.container.detailsHandler.clearConformBox()},ee.prototype.initMissedChat=function(e,t,i,a){this.container.detailsHandler.initMissedChat(e,t,i,a)},ee.prototype.isChatExist=function(e){return this.container.detailsHandler.isChatExist(e)},ee.prototype.getAttenderId=function(e){return this.container.detailsHandler.getAttenderId(e)},ee.prototype.getSupportRepCount=function(e){return this.container.detailsHandler.getSupportRepCount(e)},ee.prototype.playNotifSound=function(e){this.container.detailsHandler.playNotifSound(e)},ee.prototype.stopNotifSound=function(){this.container.detailsHandler.stopNotifSound()},ee.prototype.getEncryChid=function(e){return this.container.detailsHandler.getEncryChid(e)},ee.prototype.triggerIconCheck=function(e){this.container.detailsHandler.triggerIconCheck(e)},ee.prototype.getCurrentOpenChat=function(){return this.container.detailsHandler.getCurrentOpenChat()},ee.prototype.focusChatWindow=function(e){this.container.detailsHandler.focusChatWindow(e)},ee.prototype.canShowAudioCallInvitation=function(e){return this.container.detailsHandler.canShowAudioCallInvitation(e)},ee.prototype.joinChat=function(e){this.container.detailsHandler.joinChat(e)},ee.prototype.getVisitorName=function(e){return this.container.detailsHandler.getVisitorName(e)},ee.prototype.getVisitorID=function(e){return this.container.detailsHandler.getVisitorID(e)},ee.prototype.onGoingMediaDetails=function(){return this.container.detailsHandler.onGoingMediaDetails()},ee.prototype.isMediaRecordingEnabledForChat=function(e){return this.container.detailsHandler.isMediaRecordingEnabledForChat(e)},ee.prototype.checkIsChatEndTimerAlive=function(e){return this.container.detailsHandler.checkIsChatEndTimerAlive(e)},ee.prototype.isRecordingON=function(){return this.container.detailsHandler.isRecordingON()},ee.prototype.isSecure=function(){return this.container.MediaDetails.isSecure()},ee.prototype.isVisitorSecure=function(e){return this.container.detailsHandler.isVisitorFromHttps(e)},$(document).ready(function(){var e,a={},t=$Support.getParent();(e=a).commonImpl=new _(e),e.audioImpl=new u(e),e.videoImpl=new m(e),e.screen_shareImpl=new h(e),a.ajaxHandler=new V(a),a.detailsHandler=new z(a),a.mediaUIHandler=new ee(a),a.uiHandler=new B(a),a.logger=LSDebugger.postDebugInfo,a.lsrouter=new J(a),window.SiqAVRouter=new Y(a),window.avUIhandler=a.uiHandler,a.commonImpl.checkOnGoingCall(),a.checkDirectCallOnload=function(){var e,t=a.commonImpl.getMediaCache(a.constants.siq_directcall);t&&t.is_refreshed&&(i=t.chid,e=t.media_id,t.type,"outgoing"==(t=t.status)?($Support.audioid=e,a.detailsHandler.initMissedChat(i,"CALLENDED","2",!0)):"connected"==t&&(a.audioImpl.endOngoingCall(i,e),a.detailsHandler.endSession(i)),a.commonImpl.removeMediaCache(a.constants.siq_directcall));var i=a.commonImpl.getMediaCache(a.constants.siq_unifiedMedia);i&&i.is_refreshed&&(a.commonImpl.handleMediaOnRefresh(i),a.commonImpl.removeMediaCache(a.constants.siq_unifiedMedia))},!$Support.isChatExist()&&t.$zohosq.values.initiatecall&&t.$zohosq.call.start()})}();
